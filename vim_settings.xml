<application>
  <component name="VimSettings">
    <state version="4" enabled="true" />
    <globalmarks />
    <filemarks>
      <file name="/a.dummy" timestamp="1512423956901">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/ObjectVector.java" timestamp="1512565773574" />
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/bhs/trunk/src/main/java/bhs/brobj/BrtemplateSelectionObrObject.java" timestamp="1510838952754">
        <mark key="[" line="12" column="18" />
        <mark key="]" line="12" column="18" />
        <mark key="^" line="12" column="17" />
        <mark key="." line="12" column="18" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/proc/doc/ProcessDocBomMaintain.java" timestamp="1512415487347" />
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/classification.java" timestamp="1512035849941">
        <mark key="[" line="2" column="13" />
        <mark key="]" line="2" column="12" />
        <mark key="." line="2" column="12" />
        <mark key="^" line="2" column="12" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/proc/doc/PlmProcessSingleCheckinCdeskServices.java" timestamp="1512564647200" />
      <file name="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/proc/PLMProcess.java" timestamp="1512504897371" />
      <file name="$USER_HOME$/workspace/sandbox/jaxb-v2/jaxb-ri/pom.xml" timestamp="1511795574035">
        <mark key="[" line="272" column="66" />
        <mark key="]" line="272" column="65" />
        <mark key="." line="272" column="65" />
        <mark key="^" line="272" column="65" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/plmobj/RenkCustomDocument.java" timestamp="1511959615820">
        <mark key="[" line="14" column="33" />
        <mark key="]" line="14" column="13" />
        <mark key="." line="14" column="13" />
        <mark key="^" line="14" column="13" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmClassAllocation.java" timestamp="1512555877024" />
      <file name="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/modules/addons/src/main/java/cadagent/modules/variantconfiguration/proc/PlmProcessCreateVariantAssembly.java" timestamp="1512505368676">
        <mark key="'" line="172" column="0" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/plm++/java/src/plm/sess/PlmSessionManager.java" timestamp="1512481065955" />
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/ClassificationMappingProcess.java" timestamp="1512493344833">
        <mark key="[" line="24" column="0" />
        <mark key="]" line="24" column="0" />
        <mark key="^" line="25" column="53" />
        <mark key="." line="24" column="0" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/parsing/ParsePLMXMLProcess.java" timestamp="1512564719904">
        <mark key="'" line="192" column="0" />
        <mark key="[" line="130" column="10" />
        <mark key="]" line="130" column="10" />
        <mark key="^" line="166" column="7" />
        <mark key="." line="130" column="10" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/parsing/CreateComponentProcess.java" timestamp="1511983170794">
        <mark key="[" line="39" column="29" />
        <mark key="]" line="39" column="48" />
        <mark key="^" line="39" column="48" />
        <mark key="." line="39" column="48" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/parsing/StartImportProcess.java" timestamp="1511981435386">
        <mark key="[" line="33" column="13" />
        <mark key="]" line="33" column="13" />
        <mark key="^" line="33" column="25" />
        <mark key="." line="33" column="13" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/monitoring-base/dashboard/dashboard-frontend/src/app/administration/statistic-settings/statistic-settings.component.ts" timestamp="1511180979370">
        <mark key="[" line="141" column="63" />
        <mark key="]" line="141" column="63" />
        <mark key="^" line="141" column="63" />
        <mark key="." line="141" column="63" />
      </file>
      <file name="$APPLICATION_CONFIG_DIR$/scratches/scratch.java" timestamp="1512253744496">
        <mark key="[" line="4" column="0" />
        <mark key="]" line="38" column="34" />
        <mark key="." line="4" column="0" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/mappingClassification.java" timestamp="1512039552442">
        <mark key="[" line="9" column="13" />
        <mark key="]" line="9" column="13" />
        <mark key="." line="9" column="13" />
        <mark key="^" line="9" column="31" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/bhs/trunk/src/main/java/bhs/omf/OmfBhsInheritFolderTraits.java" timestamp="1512505617423" />
      <file name="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/plm++/java/src/plm/proc/office/PlmProcessTransferDataToDocuments.java" timestamp="1512470462256" />
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/parsing/CreateMaterialProcess.java" timestamp="1511981119765">
        <mark key="[" line="33" column="13" />
        <mark key="]" line="33" column="13" />
        <mark key="." line="33" column="13" />
        <mark key="^" line="137" column="26" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/plm++/java/src/plm/gui/GuiUtils.java" timestamp="1512506101345" />
      <file name="/DummyFile.xpath" timestamp="1511811755798">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/pom2.xml" timestamp="1511357573617">
        <mark key="[" line="19" column="0" />
        <mark key="]" line="19" column="0" />
        <mark key="^" line="12" column="1" />
        <mark key="." line="19" column="0" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/schemas/plmxmlschema/InertiaType.java" timestamp="1511814931179">
        <mark key="[" line="18" column="39" />
        <mark key="]" line="18" column="39" />
        <mark key="." line="18" column="39" />
        <mark key="^" line="18" column="39" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/parsing/ParsingException.java" timestamp="1511813325837">
        <mark key="[" line="17" column="13" />
        <mark key="]" line="17" column="12" />
        <mark key="." line="17" column="12" />
        <mark key="^" line="17" column="12" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/plmobj/RenkCustomMaterial.java" timestamp="1512492980953" />
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/teamcenter-classification-mapper/src/main/java/com/dscsag/projects/renk/teamcenter_classification_mapper/App.java" timestamp="1511810458253">
        <mark key="[" line="30" column="118" />
        <mark key="]" line="31" column="24" />
        <mark key="^" line="31" column="24" />
        <mark key="." line="31" column="24" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/modules/addons/src/main/java/plm/modules/insplan/omf/IRUtils.java" timestamp="1512482209830" />
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/resources/META-INF/services/cadagent.gui.obr.ObrFunctionManagerInterface" timestamp="1511555679798">
        <mark key="[" line="0" column="32" />
        <mark key="]" line="0" column="41" />
        <mark key="." line="0" column="41" />
        <mark key="^" line="0" column="41" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/Beispielwerkzeuge Augsburg/98000147_B_1-Drehwerkzeug.xml" timestamp="1511901966665">
        <mark key="[" line="211" column="104" />
        <mark key="]" line="211" column="103" />
        <mark key="^" line="211" column="103" />
        <mark key="." line="211" column="103" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/Component.java" timestamp="1512565415541">
        <mark key="[" line="125" column="0" />
        <mark key="]" line="125" column="0" />
        <mark key="." line="125" column="0" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/bhs/trunk/src/main/java/bhs/brobj/WaWa.java" timestamp="1510838264631">
        <mark key="[" line="12" column="13" />
        <mark key="]" line="12" column="13" />
        <mark key="." line="12" column="13" />
        <mark key="^" line="107" column="0" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/teamcenter-classification-mapper/pom.xml" timestamp="1512559303961" />
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/parsing/DictionaryAttributeMappingProcess.java" timestamp="1511816341292">
        <mark key="[" line="217" column="33" />
        <mark key="]" line="217" column="38" />
        <mark key="^" line="217" column="38" />
        <mark key="." line="217" column="38" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/OmfFatcDataImport.java" timestamp="1512554473715">
        <mark key="[" line="48" column="33" />
        <mark key="]" line="48" column="33" />
        <mark key="." line="48" column="33" />
        <mark key="^" line="48" column="33" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/utils/JAXBUtils.java" timestamp="1512425213892">
        <mark key="[" line="257" column="40" />
        <mark key="]" line="257" column="40" />
        <mark key="." line="257" column="40" />
        <mark key="^" line="257" column="40" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/plm++/java/src/plm/proc/mat/PlmProcessMaterialCreateMulti.java" timestamp="1512503800004">
        <mark key="'" line="986" column="11" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/plmobj/myMaterial.java" timestamp="1511947676541">
        <mark key="[" line="5" column="1" />
        <mark key="]" line="6" column="1" />
        <mark key="^" line="6" column="1" />
        <mark key="." line="6" column="1" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/plm++/java/src/plm/proc/cad/PlmProcessCadDocumentSaveAs.java" timestamp="1512504512058" />
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/utils/StringUtils.java" timestamp="1511886109237">
        <mark key="[" line="14" column="44" />
        <mark key="]" line="14" column="43" />
        <mark key="." line="14" column="43" />
        <mark key="^" line="14" column="43" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" timestamp="1512565661638">
        <mark key="'" line="4340" column="8" />
        <mark key="[" line="0" column="0" />
        <mark key="]" line="2460" column="59" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/plm++/java/src/plm/brobj/BrFolder.java" timestamp="1512506021863" />
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/OmfFatCDataImport.java" timestamp="1511517323248">
        <mark key="[" line="6" column="30" />
        <mark key="]" line="6" column="20" />
        <mark key="^" line="13" column="3" />
        <mark key="." line="6" column="20" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/plm++/java/src/plm/proc/mat/PlmProcessMaterialCreate.java" timestamp="1512503830903">
        <mark key="'" line="201" column="2" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/App.java" timestamp="1511556249340">
        <mark key="[" line="45" column="15" />
        <mark key="]" line="45" column="21" />
        <mark key="^" line="45" column="21" />
        <mark key="." line="45" column="21" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/bhs/trunk/src/main/java/bhs/brobj/CharacteristicObject.java" timestamp="1510838334545">
        <mark key="[" line="12" column="13" />
        <mark key="]" line="23" column="32" />
        <mark key="^" line="23" column="32" />
        <mark key="." line="23" column="32" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMatAndDocProcess.java" timestamp="1512560803897">
        <mark key="'" line="145" column="62" />
        <mark key="[" line="245" column="7" />
        <mark key="]" line="245" column="7" />
        <mark key="." line="245" column="7" />
        <mark key="^" line="245" column="9" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/bhs/trunk/src/main/java/bhs/brobj/BrBhsTemplateFld.java" timestamp="1511265137000">
        <mark key="[" line="19" column="29" />
        <mark key="]" line="20" column="61" />
        <mark key="." line="20" column="61" />
        <mark key="^" line="20" column="61" />
      </file>
      <file name="/Dummy.txt" timestamp="1512559257593">
        <mark key="[" line="0" column="0" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/proc/doc/PopDocCreate.java" timestamp="1512504378790">
        <mark key="'" line="86" column="13" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/KomplettWerkzeug.java" timestamp="1512255662298">
        <mark key="[" line="23" column="3" />
        <mark key="]" line="24" column="16" />
        <mark key="." line="24" column="16" />
        <mark key="^" line="24" column="16" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/sap/conn/jco/tm/JCOTransaction.java" timestamp="1512484144746" />
      <file name="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/plm++/java/src/plm/utils/PlmDocumentUtils.java" timestamp="1512504124399" />
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/pom.xml" timestamp="1512559312958">
        <mark key="[" line="42" column="21" />
        <mark key="]" line="47" column="20" />
        <mark key="." line="47" column="20" />
        <mark key="^" line="47" column="20" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/serialization/SAPCharGroupDataPackageWriter.java" timestamp="1511816766999">
        <mark key="[" line="42" column="18" />
        <mark key="]" line="42" column="27" />
        <mark key="." line="42" column="27" />
        <mark key="^" line="42" column="27" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/plm++/java/src/plm/proc/doc/create/PlmProcessDocumentCreate.java" timestamp="1512503991113" />
      <file name="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/modules/techdoc/techdoc-main/src/main/java/techdoc/brobj/BrTechDocument.java" timestamp="1512505809365" />
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateComponentProcess.java" timestamp="1511991309153">
        <mark key="[" line="29" column="13" />
        <mark key="]" line="29" column="13" />
        <mark key="." line="29" column="13" />
        <mark key="^" line="41" column="86" />
      </file>
      <file name="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/Tool.java" timestamp="1512493040393">
        <mark key="[" line="12" column="45" />
        <mark key="]" line="12" column="65" />
        <mark key="." line="12" column="65" />
        <mark key="^" line="12" column="65" />
      </file>
      <file name="/fragment.java" timestamp="1512565191628">
        <mark key="[" line="0" column="0" />
        <mark key="]" line="0" column="0" />
        <mark key="^" line="0" column="45" />
        <mark key="." line="0" column="0" />
      </file>
    </filemarks>
    <jumps>
      <jump line="143" column="30" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMaterialProcess.java" />
      <jump line="120" column="0" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMaterialProcess.java" />
      <jump line="154" column="32" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMaterialProcess.java" />
      <jump line="114" column="50" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMaterialProcess.java" />
      <jump line="194" column="0" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/plm++/java/src/plm/proc/mat/PlmProcessMaterialCreateMulti.java" />
      <jump line="122" column="19" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/proc/mat/ProcessMatCreateDark.java" />
      <jump line="225" column="39" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/proc/mat/ProcessMatCreateDark.java" />
      <jump line="222" column="2" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMaterialProcess.java" />
      <jump line="94" column="2" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMaterialProcess.java" />
      <jump line="68" column="64" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMaterialProcess.java" />
      <jump line="140" column="34" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMaterialProcess.java" />
      <jump line="69" column="0" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/parsing/ParsePLMXMLProcess.java" />
      <jump line="152" column="66" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/parsing/ParsePLMXMLProcess.java" />
      <jump line="157" column="0" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/parsing/ParsePLMXMLProcess.java" />
      <jump line="117" column="27" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/parsing/ParsePLMXMLProcess.java" />
      <jump line="131" column="9" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/parsing/ParsePLMXMLProcess.java" />
      <jump line="284" column="4" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/parsing/ParsePLMXMLProcess.java" />
      <jump line="286" column="4" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/parsing/ParsePLMXMLProcess.java" />
      <jump line="291" column="40" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/parsing/ParsePLMXMLProcess.java" />
      <jump line="285" column="32" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/parsing/ParsePLMXMLProcess.java" />
      <jump line="197" column="9" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/plm++/java/src/plm/proc/mat/PlmProcessMaterialCreateMulti.java" />
      <jump line="83" column="2" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMatAndDocProcess.java" />
      <jump line="16" column="25" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/Component.java" />
      <jump line="17" column="70" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/Component.java" />
      <jump line="66" column="26" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/org/plmxml/schemas/plmxmlschema/DataSetType.java" />
      <jump line="67" column="27" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/org/plmxml/schemas/plmxmlschema/DataSetType.java" />
      <jump line="127" column="67" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMatAndDocProcess.java" />
      <jump line="20" column="35" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/Component.java" />
      <jump line="51" column="72" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/Component.java" />
      <jump line="94" column="0" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/Component.java" />
      <jump line="25" column="17" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/Component.java" />
      <jump line="265" column="20" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/parsing/ParsePLMXMLProcess.java" />
      <jump line="112" column="4" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/parsing/ParsePLMXMLProcess.java" />
      <jump line="75" column="3" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMatAndDocProcess.java" />
      <jump line="60" column="44" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMatAndDocProcess.java" />
      <jump line="64" column="44" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMatAndDocProcess.java" />
      <jump line="67" column="82" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMatAndDocProcess.java" />
      <jump line="88" column="15" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMatAndDocProcess.java" />
      <jump line="138" column="93" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/parsing/ParsePLMXMLProcess.java" />
      <jump line="137" column="10" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMatAndDocProcess.java" />
      <jump line="272" column="39" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMatAndDocProcess.java" />
      <jump line="99" column="46" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMatAndDocProcess.java" />
      <jump line="68" column="0" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMatAndDocProcess.java" />
      <jump line="78" column="6" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMatAndDocProcess.java" />
      <jump line="111" column="11" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/Component.java" />
      <jump line="35" column="22" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/Component.java" />
      <jump line="793" column="37" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/plm++/java/src/plm/proc/mat/PlmProcessMaterialCreate.java" />
      <jump line="235" column="5" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMatAndDocProcess.java" />
      <jump line="96" column="0" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMatAndDocProcess.java" />
      <jump line="89" column="6" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMatAndDocProcess.java" />
      <jump line="122" column="0" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMatAndDocProcess.java" />
      <jump line="138" column="0" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMatAndDocProcess.java" />
      <jump line="120" column="55" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMatAndDocProcess.java" />
      <jump line="126" column="36" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/parsing/ParsePLMXMLProcess.java" />
      <jump line="136" column="62" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/CreateMatAndDocProcess.java" />
      <jump line="78" column="66" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/component/Component.java" />
      <jump line="22" column="1" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/utils/TestUtils.java" />
      <jump line="123" column="85" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/proc/doc/PopDocCreate.java" />
      <jump line="180" column="47" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/proc/doc/PopDocCreate.java" />
      <jump line="986" column="11" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/plm++/java/src/plm/proc/mat/PlmProcessMaterialCreateMulti.java" />
      <jump line="201" column="2" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/plm++/java/src/plm/proc/mat/PlmProcessMaterialCreate.java" />
      <jump line="86" column="13" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/proc/doc/PopDocCreate.java" />
      <jump line="172" column="0" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/modules/addons/src/main/java/cadagent/modules/variantconfiguration/proc/PlmProcessCreateVariantAssembly.java" />
      <jump line="192" column="0" filename="C:/ENTWICKLUNG/java/workspaces/customer-projects/renk/ectr-teamcenter-integration/src/main/java/com/dscsag/modules/customer/omf/parsing/ParsePLMXMLProcess.java" />
      <jump line="441" column="61" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="544" column="44" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="554" column="63" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="639" column="63" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="649" column="11" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="922" column="30" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="923" column="20" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="934" column="30" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="935" column="20" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="2036" column="55" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="2417" column="44" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="2874" column="21" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="2876" column="32" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="2884" column="21" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="2886" column="32" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="3393" column="19" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="3395" column="23" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="3496" column="11" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="3497" column="34" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="3542" column="8" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="3778" column="37" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="3882" column="4" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="4230" column="36" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="4245" column="11" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="4260" column="52" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="4262" column="107" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="4268" column="52" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="4270" column="26" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="4278" column="27" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="4288" column="24" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="4291" column="27" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="4298" column="62" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="4305" column="31" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="4332" column="62" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="4336" column="53" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
      <jump line="4340" column="8" filename="C:/ENTWICKLUNG/java/workspaces/ectr-platform-lab/core/sapbase/java/src/cadagent/objmod/PlmDocument.java" />
    </jumps>
    <registers>
      <register name="&quot;" type="2">
        <text encoding="base64">Ly8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgovLwovLyAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3B5cmlnaHQgKGMpIDIwMDEKLy8gICAgICAgICAgICAgICAgICAgIERTQyBTb2Z0d2FyZSBBRywgS2FybHNydWhlLCBHZXJtYW55Ci8vICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFsbCByaWdodHMgcmVzZXJ2ZWQKLy8KLy8gICAgICAgIFRoZSBjb250ZW50cyBvZiB0aGlzIGZpbGUgaXMgYW4gdW5wdWJsaXNoZWQgd29yayBwcm90ZWN0ZWQKLy8gICAgICAgIHVuZGVyIHRoZSBjb3B5cmlnaHQgbGF3IG9mIHRoZSBGZWRlcmFsIFJlcHVibGljIG9mIEdlcm1hbnkKLy8KLy8gICAgICAgIFRoaXMgc29mdHdhcmUgaXMgcHJvcHJpZXRhcnkgdG8gYW5kIGVtYm9kZGllcyBjb25maWRlbnRpYWwKLy8gICAgICAgIHRlY2hub2xvZ3kgb2YgRFNDIFNvZnR3YXJlIEFHLiBQb3NzZXNzaW9uLCB1c2UgYW5kIGNvcHlpbmcKLy8gICAgICAgIG9mIHRoZSBzb2Z0d2FyZSBhbmQgbWVkaWEgaXMgYXV0aG9yaXplZCBvbmx5IHB1cnN1YW50IHRvIGEKLy8gICAgICAgIHZhbGlkIHdyaXR0ZW4gbGljZW5zZSBmcm9tIERTQyBTb2Z0d2FyZSBBRy4gVGhpcyBjb3B5cmlnaHQKLy8gICAgICAgIHN0YXRlbWVudCBtdXN0IGJlIHZpc2libHkgaW5jbHVkZWQgaW4gYWxsIGNvcGllcy4KLy8KLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoKLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgovLwovLyAgJFJldmlzaW9uJCAoJERhdGUkKQovLwovLyAgZmlsZW5hbWUgICAgOiBQbG1Eb2N1bWVudC5qYXZhCi8vCi8vICBjb250ZW50cyAgICA6Ci8vCi8vICBjcmVhdGVkIGF0ICA6IE1heSwgMjguIDIwMDIKLy8gIGNyZWF0ZWQgYnkgIDogU2ViYXN0aWFuIEtpZXNlbCwgRFNDIFNvZnR3YXJlIEFHLCBLYXJsc3J1aGUsIEdlcm1hbnkKLy8KLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoKcGFja2FnZSBjYWRhZ2VudC5vYmptb2Q7CgppbXBvcnQgc3RhdGljIGNhZGFnZW50LmNmYy51dGlsLkNvbnRhaW5lclRvb2wuZmlyc3ROb25OdWxsOwppbXBvcnQgc3RhdGljIGNhZGFnZW50LmNmYy51dGlsLkNvbnRhaW5lclRvb2wuaGFzSXRlbXM7CmltcG9ydCBzdGF0aWMgY2FkYWdlbnQuY2ZjLnV0aWwuQ29udGFpbmVyVG9vbC5oYXNOb0l0ZW1zOwppbXBvcnQgc3RhdGljIGNhZGFnZW50LmNmYy51dGlsLlN0cmluZ1Rvb2wuaGFzQ29udGVudDsKaW1wb3J0IHN0YXRpYyBjYWRhZ2VudC5jZmMudXRpbC5TdHJpbmdUb29sLmludGVybjsKaW1wb3J0IHN0YXRpYyBjYWRhZ2VudC5zYXAuQXBpUGFyYW1ldGVyVG9vbC5hc3NpZ247CgppbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5uZXQuTWFsZm9ybWVkVVJMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5uZXQuVVJMOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkRhdGU7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkhhc2h0YWJsZTsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLk1hcC5FbnRyeTsKaW1wb3J0IGphdmEudXRpbC5PYmplY3RzOwppbXBvcnQgamF2YS51dGlsLlZlY3RvcjsKaW1wb3J0IGphdmEudXRpbC5mdW5jdGlvbi5QcmVkaWNhdGU7CmltcG9ydCBqYXZhLnV0aWwucmVnZXguUGF0dGVyblN5bnRheEV4Y2VwdGlvbjsKCmltcG9ydCBqYXZheC5hbm5vdGF0aW9uLk5vbm51bGw7CmltcG9ydCBqYXZheC5hbm5vdGF0aW9uLk51bGxhYmxlOwoKaW1wb3J0IG9yZy53M2MuZG9tLkVsZW1lbnQ7CgppbXBvcnQgY29tLmRzY3NhZy5wbG0uc3BpLmludGVyZmFjZXMuRG9jdW1lbnRLZXk7CgppbXBvcnQgY2FkYWdlbnQuY2ZjLmRpYy5EaWM7CmltcG9ydCBjYWRhZ2VudC5jZmMubG9nLkRlZmF1bHRMb2dFeGNlcHRpb247CmltcG9ydCBjYWRhZ2VudC5jZmMucHJlZi5QcmVmZXJlbmNlczsKaW1wb3J0IGNhZGFnZW50LmNmYy51dGlsLkNvbnRhaW5lclRvb2w7CmltcG9ydCBjYWRhZ2VudC5jZmMudXRpbC5EYXRlVG9vbDsKaW1wb3J0IGNhZGFnZW50LmNmYy51dGlsLk51bWJlclV0aWxzOwppbXBvcnQgY2FkYWdlbnQuY2ZjLnV0aWwuU3RyaW5nVG9vbDsKaW1wb3J0IGNhZGFnZW50LmNmYy51dGlsLlRyYWNlOwppbXBvcnQgY2FkYWdlbnQuZHR5cGUuRFR5cGU7CmltcG9ydCBjYWRhZ2VudC5kdHlwZS5EVHlwZUNvbnRhaW5lcjsKaW1wb3J0IGNhZGFnZW50LmV4Yy5NaXNzaW5nU2FwS2V5RXhjZXB0aW9uOwppbXBvcnQgY2FkYWdlbnQuZXhjLlByZWZlcmVuY2VOb3RFeGlzdGVudEV4Y2VwdGlvbjsKaW1wb3J0IGNhZGFnZW50LnBsbS5QbG1Db25zdGFudHM7CmltcG9ydCBjYWRhZ2VudC5wbG0uUGxtTG9uZ3RleHRVdGlsczsKaW1wb3J0IGNhZGFnZW50LnBsbS5QbG1TdGF0dXNDb250YWluZXI7CmltcG9ydCBjYWRhZ2VudC5wbG0uUGxtU3RhdHVzVG9vbDsKaW1wb3J0IGNhZGFnZW50LnBsbS5QbG1WZXJzaW9uVG9vbDsKaW1wb3J0IGNhZGFnZW50LnBsbS5udW1jb252ZXJ0ZXIuRG9jdW1lbnROdW1iZXJDb252ZXJ0ZXI7CmltcG9ydCBjYWRhZ2VudC5wcm9jLkRhdGFDb250YWluZXI7CmltcG9ydCBjYWRhZ2VudC5wcm9jLmRvYy5Qcm9jZXNzRG9jU3RydWN0dXJlRXhwbG9kZTQ7CmltcG9ydCBjYWRhZ2VudC5zYXAuQXBpUGFyYW1ldGVyOwppbXBvcnQgY2FkYWdlbnQuc2FwLkFwaVBhcmFtZXRlclRvb2w7CmltcG9ydCBjYWRhZ2VudC5zYXAuQmFwaVJldHVybmVkRXJyb3JFeGNlcHRpb247CmltcG9ydCBjYWRhZ2VudC5zYXAubWFuLlNhcE1hbmFnZXI7CgovKioKICogUGxtIERvY3VtZW50IGZvciB0aGUgb2JqZWN0IG1vZGVsCiAqCiAqIEBhdXRob3IgU2ViYXN0aWFuIEtpZXNlbAogKiBAdmVyc2lvbiAkUmV2aXNpb24kICgkRGF0ZSQpCiAqCiAqLwpwdWJsaWMgY2xhc3MgUGxtRG9jdW1lbnQgZXh0ZW5kcyBQbG1DbGFzc2lmaWVkT2JqZWN0IGltcGxlbWVudHMgUGxtQ2hhbmdlYWJsZU9iamVjdCwgRG9jdW1lbnRLZXkKewogIHB1YmxpYyBmaW5hbCBzdGF0aWMgU3RyaW5nIElEID0gIkAoIykgJElkJCI7CgogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogIC8vCiAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzIHQgYSB0IGkgYyBzCiAgLy8KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgcHVibGljIGZpbmFsIHN0YXRpYyBTdHJpbmcgQ0FESURQQVRURVJOID0gUHJlZmVyZW5jZXMuc3RyaW5nVmFsdWUoInBsbS5jb250cm9sLnVzZXJkZWZpbmVkNC5wYXR0ZXJuIiwgIltBLVpdW0EtWjAtOV1bQS1aMC05XTouKiIpOwoKICAvKiogbmFtZSBvZiBzYXAgdGFibGUgd2hlcmUgZG9jdW1lbnRzIGFyZSBzdG9yZWQgKi8KICBwdWJsaWMgZmluYWwgc3RhdGljIFN0cmluZyBUQUJMRV9UWVBFID0gIkRSQVciOwoKICBwdWJsaWMgZmluYWwgc3RhdGljIFN0cmluZyBNQVNURVIgPSAiTSI7CiAgcHVibGljIGZpbmFsIHN0YXRpYyBTdHJpbmcgTk9OTUFTVEVSID0gIk4iOwoKICAvKioKICAgKiBNYXN0ZXJtb2RlbGwgbWl0IEZhbWlseSBNZW1iZXIgS2VubnVuZywgZGFzcyBwYXJ0bmFtZSBlaW5lIFZlcnNpb24gZW50aGFlbHQKICAgKi8KICBwdWJsaWMgZmluYWwgc3RhdGljIFN0cmluZyBGQU1JTFlfTUVNQkVSX1ZFUlNJT04gPSAiViI7CgogIC8qKgogICAqIE1hc3Rlcm1vZGVsbCBtaXQgRmFtaWx5IE1lbWJlciBLZW5udW5nLCBkYXNzIHBhcnRuYW1lIGtlaW5lIFZlcnNpb24KICAgKiBlbnRoYWVsdAogICAqLwogIHB1YmxpYyBmaW5hbCBzdGF0aWMgU3RyaW5nIEZBTUlMWV9NRU1CRVJfTk9OVkVSU0lPTiA9ICJOViI7CgogIC8qKiBAc2VlICNpc0ZhbWlseU1lbWJlcigpICovCiAgcHJpdmF0ZSBmaW5hbCBzdGF0aWMgU3RyaW5nIEZBTUlMWV9HRU5FUklDID0gIkciOwoKICAvKiogQHNlZSAjaXNGYW1pbHlNZW1iZXIoKSAqLwogIHByaXZhdGUgZmluYWwgc3RhdGljIFN0cmluZyBGQU1JTFlfSU5TVEFOQ0UgPSAiSSI7CgogIC8qKiBAc2VlIGlzRHJhd2luZygpICovCiAgcHJpdmF0ZSBmaW5hbCBzdGF0aWMgU3RyaW5nIERSQVdJTkcgPSAiRCI7CgogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogIC8vCiAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYgYSByIGkgYSBiIGwgZSBzCiAgLy8KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgLyoqIGNhY2hlZCBrZXkgKi8KICBwcml2YXRlIFN0cmluZyBzYXBrZXk7CgogIC8qKiBjYWNoZWQgc2hvcnRudW1iZXIgKi8KICBwcml2YXRlIFN0cmluZyBzaG9ydE51bWJlcjsKCiAgLyoqCiAgICogVGhpcyBudW1iZXIgaXMgdGhlIG1haW4gcGFydCBvZiB0aGUgZG9jdW1lbnQga2V5LCB3aGljaCBpcyB1c2VkIHRvIGlkZW50aWZ5CiAgICogdGhlIGRvY3VtZW50LgogICAqLwogIHByaXZhdGUgU3RyaW5nIG51bWJlcjsKCiAgLyoqCiAgICogVGhlIGRvY3VtZW50IHR5cGUgb2YgdGhlIHN1cGVyaW9yIGRvY3VtZW50IG11c3Qgbm90IGJlIHRoZSBzYW1lIGFzIHRoYXQgb2YKICAgKiB0aGUgZG9jdW1lbnQgeW91IGFyZSBjdXJyZW50bHkgcHJvY2Vzc2luZy4KICAgKi8KICBwcml2YXRlIFN0cmluZyB0eXBlOwoKICAvKiogTnVtYmVyIHdoaWNoIGlkZW50aWZpZXMgdGhlIHZlcnNpb24gb2YgYSBkb2N1bWVudC4gKi8KICBwcml2YXRlIFN0cmluZyB2ZXJzaW9uOwoKICAvKiogU2VjdGlvbiBvZiBhIGRvY3VtZW50IHdoaWNoIGlzIG1haW50YWluZWQgYXMgYW4gaW5kZXBlbmRlbnQgZG9jdW1lbnQuICovCiAgcHJpdmF0ZSBTdHJpbmcgcGFydDsKCiAgLyoqIFNob3J0IHRleHQgZGVzY3JpYmluZyB0aGUgZG9jdW1lbnQuICovCiAgcHJpdmF0ZSBTdHJpbmcgZGVzY3JpcHRpb247CgogIC8qKiBsb25nIHRleHQgZGVzY3JpYmluZyB0aGUgZG9jdW1lbnQuICovCiAgcHJpdmF0ZSBNYXA8U3RyaW5nLCBWZWN0b3I8U3RyaW5nPj4gbUxvbmdUZXh0czsKICBwcml2YXRlIE1hcDxTdHJpbmcsIExpbmtlZExpc3Q8UGxtTG9uZ1RleHRMaW5lPj4gbU5ld0xvbmdUZXh0czsKCiAgLyoqIE5hbWUgb2YgdGhlIHVzZXIgd2hvIGlzIHJlc3BvbnNpYmxlIGZvciB0aGUgZG9jdW1lbnQgaW5mbyByZWNvcmQuICovCiAgcHJpdmF0ZSBTdHJpbmcgdXNlcjsKCiAgLyoqIFRoaXMga2V5IHNob3dzIHRoZSBkb2N1bWVudCBzdGF0dXMuICovCiAgcHJpdmF0ZSBTdHJpbmcgc3RhdHVzOwoKICAvKiogS2V5IGZvciB0aGUgZGVzaWduIG9mZmljZSwgbGFib3JhdG9yeSwgb3IgbGFib3JhdG9yeSB3b3JrZXIgcmVzcG9uc2libGUuICovCiAgcHJpdmF0ZSBTdHJpbmcgb2ZmaWNlOwoKICAvKiogVGhlIGF1dGhvcml6YXRpb24gZ3JvdXAgZW5hYmxlcyB5b3UgcHJvdGVjdCBhY2Nlc3MgdG8gY2VydGFpbiBvYmplY3RzLiAqLwogIHByaXZhdGUgU3RyaW5nIGF1dGhvcml6YXRpb25Hcm91cDsKCiAgLyoqIFRoZSBjb252ZXJzaW9uIHN0YXR1cyBvZiB0aGUgZG9jdW1lbnQgKi8KICBwcml2YXRlIFN0cmluZyBjb252ZXJzaW9uU3RhdHVzOwoKICAvKiogKi8KICBwcml2YXRlIFBsbURvY1N0cnVjdHVyZSBwbG1Eb2NTdHJ1Y3R1cmU7CgogIC8qKgogICAqIE51bWJlciBvZiB0aGUgY2hhbmdlIG1hc3RlciByZWNvcmQgd2hpY2ggZ3JvdXBzIHRvZ2V0aGVyIGxvZ2ljYWxseSBsaW5rZWQKICAgKiBkb2N1bWVudHMgYW5kIGFueSBvdGhlciBTQVAgb2JqZWN0cyAoc3VjaCBhcyBiaWxsIG9mIG1hdGVyaWFsLCByb3V0aW5nLAogICAqIG1hdGVyaWFsKS4KICAgKi8KICBwcml2YXRlIFN0cmluZyBjaGFuZ2VOdW1iZXI7CgogIC8qKiBSZXZpc2lvbiBMZXZlbCAqLwogIHByaXZhdGUgU3RyaW5nIHJldkxldmVsOwoKICAvKiogRGVsZXRlIGZsYWcgKi8KICBwcml2YXRlIGJvb2xlYW4gZGVsZXRlRmxhZzsKCiAgLyoqIFN0cnVjdHVyZSBmbGFnICovCiAgcHJpdmF0ZSBib29sZWFuIHN0cnVjdHVyZUZsYWc7CgogIC8qKiBDQUQgaW5kaWNhdG9yICovCiAgcHJpdmF0ZSBib29sZWFuIGNhZEluZGljYXRvciA9IHRydWU7CgogIC8qKiBVc2VyZGVmaW5lZCAxICovCiAgcHJpdmF0ZSBTdHJpbmcgdXNlckRlZmluZWQxOwoKICAvKiogVXNlcmRlZmluZWQgMiAqLwogIHByaXZhdGUgU3RyaW5nIHVzZXJEZWZpbmVkMjsKCiAgLyoqIFVzZXJkZWZpbmVkIDMgKi8KICBwcml2YXRlIFN0cmluZyB1c2VyRGVmaW5lZDM7CgogIC8qKiBVc2VyZGVmaW5lZCA0LCBzZWUgYWxzbyB1Z1R5cGUgKi8KICBwcml2YXRlIFN0cmluZyB1c2VyRGVmaW5lZDQ7CgogIHByaXZhdGUgRGF0ZSBjcmVhdGVEYXRlOwoKICAvKiogQ29udGFpbnMgdGhlIGxpbmtlZCBGaWxlcyAqLwogIHByaXZhdGUgT2JqZWN0VmVjdG9yPFBsbUZpbGU+IG92UGxtRmlsZXM7CgogIHByaXZhdGUgUGxtT2JqZWN0TGlua0NvbnRhaW5lciBvYmplY3RMaW5rczsKCiAgLyoqIENvbnRhaW5zIHBsbURvY3VtZW50cyB3aGVyZSB0aGlzIGRvY3VtZW50IGlzIHVzZWQgKi8KICBwcml2YXRlIExpc3Q8UGxtV2hlcmV1c2VkRG9jdW1lbnQ+IHZXaGVyZVVzZWQ7CgogIC8qKiBjb250YWlucyB0aGUgc3RhdHVzIGxvZyBlbnRyaWVzIGFzIGluc3RhbmNlcyBvZiBTdGF0dXNMb2dFbnRyeSBjbGFzcyAqICovCiAgcHJpdmF0ZSBTdGF0dXNMb2cgc3RhdHVzTG9nOwoKICAvKioKICAgKiBDaGFuZ2UgZG9jdW1lbnQgd2l0aCBhbGwgZnJvbSB0aGUgdXNlciBwcm9wb3NlZCBjaGFuZ2VzLCBiZWZvcmUgdGhleSBhcmUKICAgKiB0cmFuc2ZlcmVkIHRvIFNBUCBOVUxMIHVudGlsIGNoYW5nZXMgYXJlIGRvbmUgdmlhIHRoZSBzZXQgTWV0aG9kcy4gR2V0CiAgICogTWV0aG9kIHdpbGwgbG9vayBmb3IgdmFsdWVzIGZpcnN0IGluIHRoZSBjaGFuZ2UgZG9jdW1lbnQsIHRoZW4gaW4gdGhlIHJlYWwKICAgKiBvbmUuCiAgICovCiAgcHJpdmF0ZSBQbG1DaGFuZ2VEb2N1bWVudCBvQ2hhbmdlRG9jdW1lbnQgPSBudWxsOwoKICAvKiogYWN0YWwgbGFuZ3VhZ2UgKi8KICBwcml2YXRlIFN0cmluZyBhY3RfbGFuZ3UgPSAiIjsKCiAgcHJpdmF0ZSBQbG1DaGFuZ2VNYXN0ZXJDb250YWluZXIgZWNtUmVzZXJ2YXRpb25zOwoKICAvKiogTWFwLiBrZXkoTEFOR1VBR0VfSVNPKS0+dmFsdWUoZGVzY3JpcHRpb24pKiAqLwogIHByaXZhdGUgTWFwPFN0cmluZywgU3RyaW5nPiBtRGVzY3JpcHRpb25zOwoKICAvKiogRXh0ZW5kZWQgRFJBVyBWYXJpYWJsZXMgKi8KICAvKiBTVUJUWVBFIC0gQ0hBUjEwICovCiAgcHJpdmF0ZSBTdHJpbmcgc3VidHlwZTsKCiAgLyoqIEV4dGVuZGVkIERSQVcgRGF0YTogTUFTVEVSIC0gQ0hBUjEgKi8KICBwcml2YXRlIFN0cmluZyBtYXN0ZXI7CgogIC8qKiBFeHRlbmRlZCBEUkFXIERhdGE6IEZBTUlMWSBDSEFSNCAqLwogIHByaXZhdGUgU3RyaW5nIGZhbWlseTsKCiAgLyoqIEV4dGVuZGVkIERSQVcgRGF0YTogRElSVFkgQ0hBUjEgKi8KICBwcml2YXRlIFN0cmluZyBkaXJ0eTsKCiAgLyoqIEV4dGVuZGVkIERSQVcgRGF0YTogTUFUX0FWQUlMQUJMRSBDSEFSMSAqLwogIHByaXZhdGUgU3RyaW5nIG1hdEF2YWlsYWJsZTsKCiAgLyoqIEV4dGVuZGVkIERSQVcgRGF0YTogTk1fQVZBSUxBQkxFIENIQVIxICovCiAgcHJpdmF0ZSBTdHJpbmcgbm1BdmFpbGFibGU7CgogIC8qKiBFeHRlbmRlZCBEUkFXIERhdGE6IENBRF9WRVJTSU9OIENIQVIyMCAqLwogIHByaXZhdGUgU3RyaW5nIGFwcGxSZWxlYXNlOwoKICAvKiogRXh0ZW5kZWQgRFJBVyBEYXRhOiBFeHBhbmRlZCBDQURfVkVSU0lPTiAqLwogIHByaXZhdGUgU3RyaW5nIGFwcGxSZWxlYXNlRXh0OwoKICAvKiogRXh0ZW5kZWQgRFJBVyBEYXRhOiBDQURfRU5WIENIQVIxMCAqLwogIHByaXZhdGUgU3RyaW5nIGFwcGxFbnZpcm9ubWVudDsKCiAgLyoqIEV4dGVuZGVkIERSQVcgRGF0YTogQ0hFQ0tJTl9EQVRFIENIQVIxNCAqLwogIHByaXZhdGUgU3RyaW5nIGxhc3RNb2RpZmllZERhdGVTdHJpbmc7CgogIHByaXZhdGUgRGF0ZSBsYXN0TW9kaWZpZWREYXRlOwoKICAvKiogRXh0ZW5kZWQgRFJBVyBEYXRhOiBWSUVXQUJMRVNfVVBEIENIQVIxICovCiAgcHJpdmF0ZSBTdHJpbmcgdmlld2FibGVzVXBkOwoKICAvKiogRXh0ZW5kZWQgRFJBVyBEYXRhOiBSRUZTRVRTIENIQVIyNTUgKi8KICBwcml2YXRlIFN0cmluZyByZWZzZXRzOwoKICAvKiogRXh0ZW5kZWQgRFJBVyBEYXRhOiBDT01QU0VUUyBDSEFSMjU1ICovCiAgcHJpdmF0ZSBTdHJpbmcgY29tcHNldHM7CgogIHByaXZhdGUgUGxtQm91bmRpbmdCb3ggYm91bmRpbmdCb3g7CgogIC8qKiBFeHRlbmRlZCBEUkFXIERhdGE6IHNhdmVjb3VudGVyIENIQVIyMCAqLwogIHByaXZhdGUgU3RyaW5nIHNhdmVDb3VudGVyOwoKICAvKiogRXh0ZW5kZWQgRFJBVyBEYXRhOiBSRVM2IENIQVIyMCAqLwogIHByaXZhdGUgU3RyaW5nIHJlczY7CgogIC8qKiBFeHRlbmRlZCBEUkFXIERhdGE6IFJFUzcgQ0hBUjEyOCAqLwogIHByaXZhdGUgU3RyaW5nIHJlczc7CgogIC8qKiBFeHRlbmRlZCBEUkFXIERhdGE6IFJFUzggQ0hBUjEyOCAqLwogIHByaXZhdGUgU3RyaW5nIHJlczg7CgogIC8qKiBFeHRlbmRlZCBEUkFXIERhdGE6IEZMQUcxIENIQVIxICovCiAgcHJpdmF0ZSBTdHJpbmcgZmxhZzE7CgogIC8qKiBFeHRlbmRlZCBEUkFXIERhdGE6IEZMQUcyIENIQVIxICovCiAgcHJpdmF0ZSBTdHJpbmcgZmxhZzI7CgogIC8qKiBFeHRlbmRlZCBEUkFXIERhdGE6IE1PRSBDSEFSMSAqLwogIHByaXZhdGUgU3RyaW5nIG1hc3Rlck9yaWdpbmFsRXhpc3Q7CgogIC8qKiBFeHRlbmRlZCBEUkFXIERhdGE6IE1PQyBDSEFSMSAqLwogIHByaXZhdGUgU3RyaW5nIG1hc3Rlck9yaWdpbmFsQ2hlY2tlZG91dDsKCiAgLyoqIEV4dGVuZGVkIERSQVcgRGF0YTogQU9FIENIQVIxICovCiAgcHJpdmF0ZSBTdHJpbmcgYWRkT3JpZ2luYWxFeGlzdDsKCiAgLyoqIEV4dGVuZGVkIERSQVcgRGF0YTogQU9DIENIQVIxICovCiAgcHJpdmF0ZSBTdHJpbmcgYWRkT3JpZ2luYWxDaGVja2Vkb3V0OwoKICAvKiogRXh0ZW5kZWQgRFJBVyBEYXRhOiBITlYgQ0hBUjEgKi8KICBwcml2YXRlIFN0cmluZyBoYXNOZXdWZXJzaW9uOwoKICAvKiogRXh0ZW5kZWQgRFJBVyBEYXRhOiBIUlYgQ0hBUjEgKi8KICBwcml2YXRlIFN0cmluZyBoYXNSZWxlYXNlZFZlcnNpb247CgogIHByaXZhdGUgYm9vbGVhbiBoYXMyRFByZXZpZXc7CgogIHByaXZhdGUgYm9vbGVhbiBoYXMzRFByZXZpZXc7CgogIHByaXZhdGUgU3RyaW5nIGlzTk1VcFRvRGF0ZTsKCiAgLyoqIG1hc3RlciBvcmlnaW5hbCBzdG9yYWdlIC0gVkFVTFQgaWYgY2hlY2tlZCBpbiwgZmlsZXNlcnZlcmlkIGlmIGNoZWNrZWQgb3V0ICovCiAgcHJpdmF0ZSBTdHJpbmcgbWFzdGVyT3JpZ2luYWxTdG9yYWdlOwoKICAvKiogbWFzdGVyIG9yaWdpbmFsIGZpbGUgbmFtZSAqLwogIHByaXZhdGUgU3RyaW5nIG1hc3Rlck9yaWdpbmFsRmlsZW5hbWU7CgogIHByaXZhdGUgU3RyaW5nIGNsYXNzaWZpY2F0aW9uRmxhZzsKCiAgLyoqIEV4dGVuZGVkIERSQVcgRGF0YTogRkxBRzQgQ0hBUjEgKi8KICBwcml2YXRlIFN0cmluZyBmbGFnNDsKCiAgLyoqIEV4dGVuZGVkIERSQVcgRGF0YTogVkFMSURGUk9NIERBVFMgKi8KICBwcml2YXRlIERhdGUgdmFsaWRGcm9tOwoKICAvKiogRXh0ZW5kZWQgRFJBVyBEYXRhOiBWQUxJRFRPIERBVFMgKi8KICBwcml2YXRlIERhdGUgdmFsaWRUbzsKCiAgLyoqIG1hdGVyaWFsIHR5cGUgTUFUX01UQVJUIENIQVIgKi8KICBwcml2YXRlIFN0cmluZyBtYXRUeXBlOwoKICAvKiogbWF0ZXJpYWwgc3RhdHVzIE1BVF9NU1RBRSBDSEFSICovCiAgcHJpdmF0ZSBTdHJpbmcgbWF0U3RhdHVzOwoKICAvKiogZXh0ZXJuYWwgbnVtYmVyIG9mIGxpbmtlZCBtYXRlcmlhbCBNQVROUl9FWFQgQ0hBUiAqLwogIHByaXZhdGUgU3RyaW5nIG1hdEV4dE51bTsKCiAgLyoqIGludGVybmFsIG51bWJlciBvZiBsaW5rZWQgbWF0ZXJpYWwgTUFUTlJfSU5UIENIQVIgKi8KICBwcml2YXRlIFN0cmluZyBtYXRJbnROdW07CgogIHByaXZhdGUgU3RyaW5nIGhhc01vcmVUaGFuT25lTGlua2VkTWF0ZXJpYWw7CgogIHByaXZhdGUgUGxtTWF0ZXJpYWwgbGlua2VkTWF0SW5zdGFuY2U7CgogIHByaXZhdGUgYm9vbGVhbiBoYXNHb3NOb3RlOwoKICBwcml2YXRlIGxvbmcgY2hlY2tvdXRTaXplID0gLTE7CgogIHByaXZhdGUgU3RyaW5nIGFjbU93bmVkQ29udGV4dDsKCiAgcHJpdmF0ZSBQbG1MaWJyYXJ5SW5mbyBsaWJyYXJ5SW5mbzsKCiAgcHJpdmF0ZSBib29sZWFuIGhhc0F1dGhvcmlzYXRpb24gPSB0cnVlOwoKICBwcml2YXRlIGJvb2xlYW4gaGFzRG93bmxvYWRQZXJtaXNzaW9uID0gdHJ1ZTsKCiAgcHJpdmF0ZSBTdHJpbmcgY2FkVmFyaWFudElkOwoKICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAvLwogIC8vICAgICAgICAgICAgICAgICAgICAgICBwIHUgYiBsIGkgYyAgIG0gZSB0IGggbyBkIHMKICAvLwogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKICAvKioKICAgKiBDb25zdHJ1Y3RvciAxCiAgICovCiAgcHJvdGVjdGVkIFBsbURvY3VtZW50KCkKICB7CiAgICBzdXBlcigpOwogICAgYWN0X2xhbmd1ID0gU2FwTWFuYWdlci5nZXRBY3RpdmVMYW5ndWFnZSgpOwogIH0gLy8gQ29uc3RydWN0b3IKCiAgLyoqCiAgICogQ29uc3RydWN0b3IgMgogICAqCiAgICogQHBhcmFtIGRvY19rZXlzICAgYSBIYXNodGFibGUgZnJvbSB0eXBlIEJBUElfRE9DX0tFWVMKICAgKi8KICBwcm90ZWN0ZWQgUGxtRG9jdW1lbnQoTWFwPFN0cmluZywgPyBleHRlbmRzIE9iamVjdD4gZG9jX2tleXMpCiAgewogICAgbnVtYmVyID0gU3RyaW5nVG9vbC5jdXRUcmFpbGluZyhTdHJpbmcudmFsdWVPZihmaXJzdE5vbk51bGwoZG9jX2tleXMsICJET0NVTUVOVE5VTUJFUiIsICJET0tOUiIsICJET0NVTUVOVCIpKSwgJyAnLCAxLCBmYWxzZSk7CiAgICBudW1iZXIgPSBTdHJpbmdUb29sLnRvVXBwZXJDYXNlKG51bWJlcik7CiAgICB0eXBlID0gU3RyaW5nVG9vbC5jdXRUcmFpbGluZyhTdHJpbmcudmFsdWVPZihmaXJzdE5vbk51bGwoZG9jX2tleXMsICJET0NVTUVOVFRZUEUiLCAiRE9LQVIiLCAiRE9DX1RZUEUiKSksICcgJywgMSk7CiAgICB0eXBlID0gU3RyaW5nVG9vbC50b1VwcGVyQ2FzZSh0eXBlKTsKICAgIHZlcnNpb24gPSBTdHJpbmdUb29sLmN1dFRyYWlsaW5nKFN0cmluZy52YWx1ZU9mKGZpcnN0Tm9uTnVsbChkb2Nfa2V5cywgIkRPQ1VNRU5UVkVSU0lPTiIsICJET0tWUiIsICJET0NfVkVSUyIpKSwgJyAnLCAxKTsKICAgIHZlcnNpb24gPSBTdHJpbmdUb29sLnRvVXBwZXJDYXNlKHZlcnNpb24pOwogICAgcGFydCA9IFN0cmluZ1Rvb2wuY3V0VHJhaWxpbmcoU3RyaW5nLnZhbHVlT2YoZmlyc3ROb25OdWxsKGRvY19rZXlzLCAiRE9DVU1FTlRQQVJUIiwgIkRPS1RMIiwgIkRPQ19QQVJUIikpLCAnICcsIDEpOwogICAgcGFydCA9IFN0cmluZ1Rvb2wudG9VcHBlckNhc2UocGFydCk7CgogICAgLy8gY29udmVydCBudW1iZXIKICAgIG51bWJlciA9IERvY3VtZW50TnVtYmVyQ29udmVydGVyLmdldEluc3QoKS5leHRUb0ludChudW1iZXIpOwoKICAgIGFjdF9sYW5ndSA9IFNhcE1hbmFnZXIuZ2V0QWN0aXZlTGFuZ3VhZ2UoKTsKICAgIHNhcGtleSA9IG51bGw7CiAgICBzaG9ydE51bWJlciA9IG51bGw7CiAgfQoKICAvKioKICAgKiBDb25zdHJ1Y3RvciAzCiAgICoKICAgKiBAcGFyYW0gc2FwX29iamVjdGtleSAgIHVzZWQgaW4gYSBsb3Qgb2YgdGFibGVzIGxpa2UgRFJBRAogICAqLwogIHByb3RlY3RlZCBQbG1Eb2N1bWVudChTdHJpbmcgc2FwX29iamVjdGtleSkKICB7CiAgICAvLyBzcGxpdCBvYmplY3RrZXkKICAgIHNldEtleXNGcm9tT2JqS2V5KHNhcF9vYmplY3RrZXkpOwogIH0KCiAgLyoqCiAgICogQ29uc3RydWt0b3IgNAogICAqLwogIHByb3RlY3RlZCBQbG1Eb2N1bWVudChTdHJpbmcgdHlwZSwgU3RyaW5nIG51bWJlciwgU3RyaW5nIHZlcnNpb24sIFN0cmluZyBwYXJ0KQogIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLnR5cGUgPSBTdHJpbmdUb29sLnRvVXBwZXJDYXNlKHR5cGUpOwogICAgdGhpcy5udW1iZXIgPSBEb2N1bWVudE51bWJlckNvbnZlcnRlci5nZXRJbnN0KCkuZXh0VG9JbnQobnVtYmVyKTsKICAgIHRoaXMudmVyc2lvbiA9IFN0cmluZ1Rvb2wudG9VcHBlckNhc2UodmVyc2lvbik7CiAgICB0aGlzLnBhcnQgPSBTdHJpbmdUb29sLnRvVXBwZXJDYXNlKHBhcnQpOwoKICAgIGFjdF9sYW5ndSA9IFNhcE1hbmFnZXIuZ2V0QWN0aXZlTGFuZ3VhZ2UoKTsKICAgIHNhcGtleSA9IG51bGw7CiAgICBzaG9ydE51bWJlciA9IG51bGw7CiAgfQoKICAvKioKICAgKiBDb25zdHJ1Y3RvciA1CiAgICoKICAgKiBAcGFyYW0gc2FwX29iamVjdGtleSAgIHVzZWQgaW4gYSBsb3Qgb2YgdGFibGVzIGxpa2UgRFJBRAogICAqIEBwYXJhbSB1c2VyX2RlZmluZWQ0ICAgYSBTdHJpbmcgdXNlZCBlLmcuIGluIEJyRG9jdW1lbnQKICAgKi8KICBwcm90ZWN0ZWQgUGxtRG9jdW1lbnQoU3RyaW5nIHNhcF9vYmplY3RrZXksIFN0cmluZyBkdHlwZSwgU3RyaW5nIG1hc3RlciwgU3RyaW5nIGZhbWlseSwgU3RyaW5nIHVzZXJfZGVmaW5lZDQpCiAgewogICAgLy8gc3BsaXQgb2JqZWN0a2V5CiAgICBzZXRLZXlzRnJvbU9iaktleShzYXBfb2JqZWN0a2V5KTsKICAgIGlmIChoYXNDb250ZW50KGR0eXBlKSkKICAgICAgdGhpcy5zdWJ0eXBlID0gZHR5cGU7CiAgICBpZiAoaGFzQ29udGVudChtYXN0ZXIpKQogICAgICB0aGlzLm1hc3RlciA9IG1hc3RlcjsKICAgIGlmIChoYXNDb250ZW50KGZhbWlseSkpCiAgICAgIHRoaXMuZmFtaWx5ID0gZmFtaWx5OwogICAgaWYgKGhhc0NvbnRlbnQodXNlcl9kZWZpbmVkNCkpCiAgICAgIHRoaXMudXNlckRlZmluZWQ0ID0gdXNlcl9kZWZpbmVkNDsKICB9CgogIC8qKgogICAqIE1ldGhvZCBjbGVhckxvbmdUZXh0CiAgICoKICAgKi8KICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBjbGVhckxvbmdUZXh0KCkKICB7CiAgICBpZiAobUxvbmdUZXh0cyAhPSBudWxsKQogICAgICBtTG9uZ1RleHRzLmNsZWFyKCk7CgogICAgaWYgKG1OZXdMb25nVGV4dHMgIT0gbnVsbCkKICAgICAgbU5ld0xvbmdUZXh0cy5jbGVhcigpOwogIH0KCiAgcHJvdGVjdGVkIHZvaWQgY2xlYXJEZXNjcmlwdGlvbnMoKQogIHsKICAgIGlmIChtRGVzY3JpcHRpb25zICE9IG51bGwpCiAgICAgIG1EZXNjcmlwdGlvbnMuY2xlYXIoKTsKICB9CgogIC8qKgogICAqIE1ldGhvZCBjbGVhclN0YXR1c0xvZwogICAqCiAgICovCiAgcHJvdGVjdGVkIHZvaWQgY2xlYXJTdGF0dXNMb2coKQogIHsKICAgIHN0YXR1c0xvZyA9IG51bGw7CiAgfQoKICAvKioKICAgKiBNZXRob2Qgc2V0TGFzdE1vZGlmaWVkRGF0ZQogICAqCiAgICogQHBhcmFtIGxhc3RfbW9kaWZpZWRfZGF0ZQogICAqICAgICAgICAgIGEgRGF0ZQogICAqCiAgICovCiAgcHVibGljIHZvaWQgc2V0TGFzdE1vZGlmaWVkRGF0ZShEYXRlIGxhc3RfbW9kaWZpZWRfZGF0ZSkKICB7CiAgICBpZiAobGFzdF9tb2RpZmllZF9kYXRlID09IG51bGwpCiAgICAgIHRoaXMubGFzdE1vZGlmaWVkRGF0ZVN0cmluZyA9IG51bGw7CiAgICBlbHNlCiAgICAgIHRoaXMubGFzdE1vZGlmaWVkRGF0ZVN0cmluZyA9IERhdGVUb29sLmRhdGVUb1NhcChsYXN0X21vZGlmaWVkX2RhdGUpOwoKICAgIHRoaXMubGFzdE1vZGlmaWVkRGF0ZSA9IGxhc3RfbW9kaWZpZWRfZGF0ZTsKICB9CgogIC8qKgogICAqIE1ldGhvZCBzZXRMYXN0TW9kaWZpZWREYXRlU3RyaW5nCiAgICoKICAgKiBAcGFyYW0gbGFzdE1vZGlmaWVkRGF0ZVN0cmluZwogICAqICAgICAgICAgIGEgU3RyaW5nCiAgICoKICAgKi8KICBwdWJsaWMgdm9pZCBzZXRMYXN0TW9kaWZpZWREYXRlU3RyaW5nKFN0cmluZyBsYXN0TW9kaWZpZWREYXRlU3RyaW5nKQogIHsKICAgIHRyeQogICAgewogICAgICBEYXRlIGRhdGUgPSBEYXRlVG9vbC5zYXBUb0RhdGUobGFzdE1vZGlmaWVkRGF0ZVN0cmluZyk7CiAgICAgIHRoaXMubGFzdE1vZGlmaWVkRGF0ZVN0cmluZyA9IGxhc3RNb2RpZmllZERhdGVTdHJpbmc7CiAgICAgIHRoaXMubGFzdE1vZGlmaWVkRGF0ZSA9IGRhdGU7CiAgICB9CiAgICBjYXRjaCAoRXhjZXB0aW9uIGUpCiAgICB7CiAgICAgIFRyYWNlLnByaW50bG4oVHJhY2UuSEVBRCwgIkludmFsaWQgZGF0ZTogPCIgKyBsYXN0TW9kaWZpZWREYXRlU3RyaW5nICsgIj4gYXQgIiArIHRoaXMudG9TdHJpbmcoKSk7CiAgICAgIFRyYWNlLnByaW50bG5TdGFja1RyYWNlKFRyYWNlLkRFQlVHLCBlKTsKICAgIH0KICB9CgogIC8qKgogICAqIHNldCB0aGUga2V5IHZhbHVlcyBvZiB0aGUgZG9jdW1lbnQuIE9ubHkgYWxsb3dlZCBpZiBkb2N1bWVudCBkb2Vzbid0IGV4aXN0CiAgICogaW4gU0FQCiAgICoKICAgKiBAcmV0dXJuIHRydWUgaWYgY2hhbmdlIHdhcyBzdWNjZXNzZnVsIGZhbHNlIGlmIGNoYW5nZSBmYWlsZWQKICAgKi8KICBwdWJsaWMgYm9vbGVhbiBzZXRLZXkoU3RyaW5nIHR5cGUsIFN0cmluZyBudW1iZXIsIFN0cmluZyB2ZXJzaW9uLCBTdHJpbmcgcGFydCkKICB7CiAgICBpZiAoZXhpc3RzSW5TYXApCiAgICB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgc2Fwa2V5ID0gbnVsbDsKICAgICAgc2hvcnROdW1iZXIgPSBudWxsOwogICAgICB0aGlzLm51bWJlciA9IERvY3VtZW50TnVtYmVyQ29udmVydGVyLmdldEluc3QoKS5leHRUb0ludChudW1iZXIpOwoKICAgICAgdGhpcy50eXBlID0gU3RyaW5nVG9vbC50b1VwcGVyQ2FzZSh0eXBlKTsKICAgICAgdGhpcy52ZXJzaW9uID0gU3RyaW5nVG9vbC50b1VwcGVyQ2FzZSh2ZXJzaW9uKTsKICAgICAgdGhpcy5wYXJ0ID0gU3RyaW5nVG9vbC50b1VwcGVyQ2FzZShwYXJ0KTsKCiAgICAgIHNldE9iamVjdElkKGdldFNhcEtleSgpKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgfQoKICAvKioKICAgKiBNZXRob2QgZnJvbUNoZWNrb3V0SW5mbwogICAqCiAgICogQHBhcmFtIGNvaQogICAqICAgICAgICAgIGEgQ2hlY2tvdXRJbmZvCiAgICoKICAgKiBAcmV0dXJuIGEgUGxtRG9jdW1lbnQKICAgKgogICAqLwogIHB1YmxpYyBzdGF0aWMgUGxtRG9jdW1lbnQgZnJvbUNoZWNrb3V0SW5mbyhDaGVja291dEluZm8gY29pKQogIHsKICAgIFBsbURvY3VtZW50IGRvYyA9IG5ldyBQbG1Eb2N1bWVudChjb2kuZ2V0U2FwS2V5KCksIGNvaS5zdWJ0eXBlLCBjb2kubWFzdGVyLCBjb2kuZmFtaWx5LCBjb2kucmVzNCk7CiAgICBkb2Muc2V0U3RhdHVzKGNvaS5kb2tzdCk7CiAgICBkb2Muc2V0VXNlcihjb2kudXNlcik7CiAgICBkb2Muc2V0U3VidHlwZShjb2kuc3VidHlwZSk7CiAgICBkb2Muc2V0TWFzdGVyKGNvaS5tYXN0ZXIpOwogICAgZG9jLnNldEZhbWlseShjb2kuZmFtaWx5KTsKICAgIGRvYy5zZXREaXJ0eShjb2kuZGlydHkpOwogICAgZG9jLnNldEFwcGxWZXJzaW9uKGNvaS5hcHBsVmVyc2lvbik7CiAgICBkb2Muc2V0QXBwbFZlcnNpb25FeHQoY29pLmFwcGxWZXJzaW9uRXh0KTsKICAgIGRvYy5zZXRBcHBsRW52aXJvbm1lbnQoY29pLmFwcGxFbnZpcm9ubWVudCk7CiAgICBkb2Muc2V0TGFzdE1vZGlmaWVkRGF0ZVN0cmluZyhjb2kubGFzdE1vZGlmaWVkRGF0ZVN0cmluZyk7CiAgICBkb2Muc2V0U2F2ZUNvdW50ZXIoY29pLnNhdmVDb3VudGVyKTsKICAgIGRvYy5zZXRNYXN0ZXJGaWxlbmFtZShjb2kubWFzdGVyRmlsZU5hbWUpOwogICAgcmV0dXJuIGRvYzsKICB9CgogIC8qKgogICAqIENoZWNrcyB0aGUgZXhpc3RlbmNlIGluIFNBUCB0aHJvdWdoIEJBUElfRE9DVU1FTlRfRVhJU1RFTkNFQ0hFQ0sgUGVyZm9ybXMKICAgKiBBTFdBWVMgYSBCQVBJX0RPQ1VNRU5UX0VYSVNURU5DRUNIRUNLCiAgICovCiAgcHVibGljIGJvb2xlYW4gZXhpc3RlbmNlQ2hlY2soKQogIHsKICAgIHJldHVybiBleGlzdGVuY2VDaGVjayh0cnVlKTsKICB9CgogIC8qKgogICAqIENoZWNrcyB0aGUgZXhpc3RlbmNlIGluIFNBUCB0aHJvdWdoIEJBUElfRE9DVU1FTlRfRVhJU1RFTkNFQ0hFQ0sKICAgKgogICAqIEBwYXJhbSBiYXBpCiAgICogICAgICAgICAgdHJ1ZSB1c2UgQkFQSV9ET0NVTUVOVF9FWElTVEVOQ0VDSEVDSyB0byBkZXRlcm1pbmUgaWYgdGhlIGRvY3VtZW50CiAgICogICAgICAgICAgZXhpc3QuIGZhbHNlIGNoZWNrIGludGVybmFsIGZsYWcKICAgKi8KICBwdWJsaWMgYm9vbGVhbiBleGlzdGVuY2VDaGVjayhib29sZWFuIGJhcGkpCiAgewogICAgaWYgKGNoZWNrSW50ZXJuYWxGbGFncyhiYXBpKSkKICAgICAgcmV0dXJuIHRydWU7CgogICAgLy8gcGVyZm9ybSBjaGVjayB2aWEgQkFQSSBjYWxsCiAgICBBcGlQYXJhbWV0ZXIgYXBpX3BhcmFtcyA9IG5ldyBBcGlQYXJhbWV0ZXIoKTsKICAgIGV4cG9ydEtleXMoYXBpX3BhcmFtcyk7CiAgICBleGVjdXRlQXBpKCJCQVBJX0RPQ1VNRU5UX0VYSVNURU5DRUNIRUNLIiwgYXBpX3BhcmFtcyk7CiAgICBTdHJpbmcgZXhpc3RzRmxhZyA9IGFwaV9wYXJhbXMuZ2V0U2NhbGFyRXhwb3J0KCJET0NVTUVOVEVYSVNUUyIpOwogICAgYm9vbGVhbiBleGlzdHMgPSAiWCIuZXF1YWxzSWdub3JlQ2FzZShleGlzdHNGbGFnKTsKICAgIHNldEV4aXN0c0luU2FwKGV4aXN0cyk7CiAgICByZXR1cm4gZXhpc3RzOwogIH0KCiAgcHJpdmF0ZSBib29sZWFuIGNoZWNrSW50ZXJuYWxGbGFncyhib29sZWFuIGJhcGkpCiAgewogICAgaWYgKCFiYXBpICYmIGV4aXN0c0luU2FwKQogICAgewogICAgICAvLyBkb2N1bWVudCBleGlzdHMgaW4gU0FQIC0gb25lIGV4aXN0ZW5jZUNoZWNrKCkgZWFybGllciBtYXliZSBoYXMgc2V0IHRoZSBmbGFnIGFscmVhZHkuCiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgLyoqCiAgICogZ2lidCBkaWUgRG9rdW1lbnRudW1tZXIgb2huZSBm/GhyZW5kZSBOdWxsZW4genVydWVjawogICAqLwogIHB1YmxpYyBTdHJpbmcgZ2V0RXh0TnVtYmVyKCkKICB7CiAgICBpZiAoc2hvcnROdW1iZXIgPT0gbnVsbCkKICAgICAgc2hvcnROdW1iZXIgPSBEb2N1bWVudE51bWJlckNvbnZlcnRlci5nZXRJbnN0KCkuaW50VG9FeHQobnVtYmVyKTsKICAgIHJldHVybiBzaG9ydE51bWJlcjsKICB9CgogIC8qKgogICAqIGdpYnQgZGllIERva3VtZW50bnVtbWVyIHp1cnVlY2sKICAgKi8KICBAT3ZlcnJpZGUKICBwdWJsaWMgU3RyaW5nIGdldE51bWJlcigpCiAgewogICAgcmV0dXJuIG51bWJlcjsKICB9CgogIC8qKgogICAqIGdpYnQgZGVuIERva3VtZW50ZW50eXAgenVydWVjawogICAqLwogIEBPdmVycmlkZQogIHB1YmxpYyBTdHJpbmcgZ2V0VHlwZSgpCiAgewogICAgcmV0dXJuIHR5cGU7CiAgfQoKICAvKioKICAgKiBnaWJ0IGRlbiBEb2t1bWVudGVucGFydCB6dXJ1ZWNrCiAgICovCiAgQE92ZXJyaWRlCiAgcHVibGljIFN0cmluZyBnZXRQYXJ0KCkKICB7CiAgICByZXR1cm4gcGFydDsKICB9CgogIC8qKgogICAqIGdpYnQgZGllIERva3VtZW50ZW52ZXJzaW9uIHp1cnVlY2sKICAgKi8KICBAT3ZlcnJpZGUKICBwdWJsaWMgU3RyaW5nIGdldFZlcnNpb24oKQogIHsKICAgIHJldHVybiB2ZXJzaW9uOwogIH0KCiAgLyoqCiAgICogZ2lidCBkaWUgRG9rdW1lbnRkZXNjcmlwdGlvbiB6dXJ1ZWNrCiAgICovCiAgcHVibGljIFN0cmluZyBnZXREZXNjcmlwdGlvbigpCiAgewogICAgaWYgKG1vZGlmaWVkICYmIHZhbEF2YWlsKG9DaGFuZ2VEb2N1bWVudC5jaERlc2NyaXB0aW9uKSkKICAgICAgcmV0dXJuIG9DaGFuZ2VEb2N1bWVudC5jaERlc2NyaXB0aW9uOwogICAgZWxzZQogICAgICByZXR1cm4gZGVzY3JpcHRpb247CiAgfQoKICAvKioKICAgKiBNZXRob2QgZ2V0RGVzY3JpcHRpb24KICAgKgogICAqIEBwYXJhbSBsYW5ndWFnZV9pc28KICAgKiAgICAgICAgICBhIFN0cmluZwogICAqCiAgICogQHJldHVybiBhIFN0cmluZyAtIGRlc2NyaXB0aW9uIGZvciB0aGUgbGFuZ3VhZ2UoSVNPKSBvciBudWxsIGlmIGRlc2NyaXB0aW9uCiAgICogICAgICAgICBpcyBub3QgYXZhaWxhYmxlCiAgICoKICAgKi8KICBwdWJsaWMgU3RyaW5nIGdldERlc2NyaXB0aW9uKFN0cmluZyBsYW5ndWFnZV9pc28pIC8vVE9ETyB2YWxBdmFpbCguLi4pIORuZGVybiB6dSBvQ2hhbmdlRG91Y21lbnQuY2hEZXNjcmlwdGlvbi5jb250YWluc0tleShsYW5ndWFnZV9pc28pCiAgewogICAgU3RyaW5nIHJldCA9IG51bGw7CiAgICBpZiAobW9kaWZpZWQgJiYgdmFsQXZhaWwob0NoYW5nZURvY3VtZW50Lm1DaERlc2NyKSkKICAgIHsKICAgICAgcmV0ID0gb0NoYW5nZURvY3VtZW50Lm1DaERlc2NyLmdldChsYW5ndWFnZV9pc28pOwogICAgfQogICAgZWxzZQogICAgewogICAgICBpZiAobURlc2NyaXB0aW9ucyAhPSBudWxsKQogICAgICAgIHJldCA9IG1EZXNjcmlwdGlvbnMuZ2V0KGxhbmd1YWdlX2lzbyk7CiAgICB9CiAgICByZXR1cm4gcmV0OwogIH0KCiAgcHVibGljIFN0cmluZyBnZXRPcmlnaW5hbERlc2NyaXB0aW9uKFN0cmluZyBsYW5ndWFnZV9pc28pCiAgewogICAgU3RyaW5nIHJldCA9IG51bGw7CiAgICBpZiAobURlc2NyaXB0aW9ucyAhPSBudWxsKQogICAgICByZXQgPSBtRGVzY3JpcHRpb25zLmdldChsYW5ndWFnZV9pc28pOwogICAgcmV0dXJuIHJldDsKICB9CgogIC8qKgogICAqIE1ldGhvZCBnZXREZXNjTGFuZ3VhZ2VzCiAgICoKICAgKiBAcmV0dXJuIGEgQ29sbGVjdGlvbiB3aXRoIGFsbCBsYW5ndWFnZXMoSVNPKSBmb3Igd2hpY2ggYSBkZXNjcmlwdGlvbiBpcwogICAqICAgICAgICAgbWFpbnRhaW5lZCBvciBudWxsCiAgICoKICAgKi8KICBwdWJsaWMgQ29sbGVjdGlvbjxTdHJpbmc+IGdldERlc2NMYW5ndWFnZXMoKQogIHsKICAgIENvbGxlY3Rpb248U3RyaW5nPiByZXQgPSBudWxsOwogICAgaWYgKG1vZGlmaWVkICYmIHZhbEF2YWlsKG9DaGFuZ2VEb2N1bWVudC5tQ2hEZXNjcikpCiAgICAgIHJldCA9IG9DaGFuZ2VEb2N1bWVudC5tQ2hEZXNjci5rZXlTZXQoKTsKICAgIGVsc2UgaWYgKG1EZXNjcmlwdGlvbnMgIT0gbnVsbCkKICAgICAgcmV0ID0gbURlc2NyaXB0aW9ucy5rZXlTZXQoKTsKICAgIHJldHVybiByZXQ7CiAgfQoKICBATm9ubnVsbAogIHB1YmxpYyBDb2xsZWN0aW9uPFN0cmluZz4gZ2V0QWxsTWFpbnRhaW5lZExhbmd1YWdlcygpCiAgewogICAgQ29sbGVjdGlvbjxTdHJpbmc+IGNfbF9kZXNjcyA9IGdldERlc2NMYW5ndWFnZXMoKTsKICAgIENvbGxlY3Rpb248U3RyaW5nPiBjX2xfbHRleHRzID0gZ2V0TmV3TG9uZ1RleHRMYW5ndWFnZXMoKTsKICAgIExpc3Q8U3RyaW5nPiBsX2FsbF9sYW5ncyA9IG5ldyBBcnJheUxpc3Q8PigpOwoKICAgIGlmIChjX2xfZGVzY3MgIT0gbnVsbCkKICAgICAgbF9hbGxfbGFuZ3MuYWRkQWxsKGNfbF9kZXNjcyk7CgogICAgaWYgKCFsX2FsbF9sYW5ncy5jb250YWlucyhhY3RfbGFuZ3UpKQogICAgICBsX2FsbF9sYW5ncy5hZGQoYWN0X2xhbmd1KTsKCiAgICBmb3IgKEl0ZXJhdG9yPFN0cmluZz4gaXQgPSBjX2xfbHRleHRzLml0ZXJhdG9yKCk7IGl0Lmhhc05leHQoKTspCiAgICB7CiAgICAgIFN0cmluZyBvID0gaXQubmV4dCgpOwogICAgICBpZiAoIWxfYWxsX2xhbmdzLmNvbnRhaW5zKG8pKQogICAgICB7CiAgICAgICAgbF9hbGxfbGFuZ3MuYWRkKG8pOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gKGxfYWxsX2xhbmdzKTsKICB9CgogIC8qKgogICAqIE1ldGhvZCBnZXREZXNjcmlwdGlvbnMKICAgKgogICAqIEByZXR1cm4gYSBDb2xsZWN0aW9uIHdpdGggYWxsIG1haW50YWluZWQgZGVzY3JpcHRpb25zIG9yIG51bGwKICAgKgogICAqLwogIHB1YmxpYyBDb2xsZWN0aW9uPFN0cmluZz4gZ2V0RGVzY3JpcHRpb25zKCkKICB7CiAgICBDb2xsZWN0aW9uPFN0cmluZz4gcmV0ID0gbnVsbDsKICAgIGlmIChtb2RpZmllZCAmJiB2YWxBdmFpbChvQ2hhbmdlRG9jdW1lbnQubUNoRGVzY3IpKQogICAgewogICAgICByZXQgPSBvQ2hhbmdlRG9jdW1lbnQubUNoRGVzY3IudmFsdWVzKCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIGlmIChtRGVzY3JpcHRpb25zICE9IG51bGwpCiAgICAgIHsKICAgICAgICByZXQgPSBtRGVzY3JpcHRpb25zLnZhbHVlcygpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmV0OwogIH0KCiAgLyoqCiAgICogc2V0enQgZGllIERva3VtZW50ZGVzY3JpcHRpb24KICAgKgogICAqIEBwYXJhbSBkZXNjcmlwdGlvbgogICAqLwogIHB1YmxpYyB2b2lkIHNldERlc2NyaXB0aW9uKFN0cmluZyBkZXNjcmlwdGlvbikKICB7CiAgICBpbml0Q2hhbmdlRG9jKCk7CiAgICBvQ2hhbmdlRG9jdW1lbnQuY2hEZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uOwogICAgb0NoYW5nZURvY3VtZW50Lm1DaERlc2NyLnB1dChhY3RfbGFuZ3UsIGRlc2NyaXB0aW9uKTsKICB9CgogIHB1YmxpYyB2b2lkIHNldERlc2NyaXB0aW9uKFN0cmluZyBsYW5nLCBTdHJpbmcgZGVzY3JpcHRpb24pCiAgewogICAgaW5pdENoYW5nZURvYygpOwogICAgaWYgKGFjdF9sYW5ndS5lcXVhbHNJZ25vcmVDYXNlKGxhbmcpKQogICAgICBvQ2hhbmdlRG9jdW1lbnQuY2hEZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uOwogICAgb0NoYW5nZURvY3VtZW50Lm1DaERlc2NyLnB1dChsYW5nLCBkZXNjcmlwdGlvbik7CiAgfQoKICBATnVsbGFibGUKICBwdWJsaWMgTGlua2VkTGlzdDxQbG1Mb25nVGV4dExpbmU+IGdldE5ld0xvbmdUZXh0KFN0cmluZyBsYW5nKQogIHsKICAgIExpbmtlZExpc3Q8UGxtTG9uZ1RleHRMaW5lPiBsUmV0ID0gbnVsbDsKICAgIGlmIChtb2RpZmllZCAmJiBvQ2hhbmdlRG9jdW1lbnQgIT0gbnVsbCAmJiB2YWxBdmFpbChvQ2hhbmdlRG9jdW1lbnQubUNoTmV3TG9uZ1RleHQpKQogICAgewogICAgICBsUmV0ID0gb0NoYW5nZURvY3VtZW50Lm1DaE5ld0xvbmdUZXh0LmdldChsYW5nKTsKICAgIH0KICAgIGVsc2UgaWYgKG1OZXdMb25nVGV4dHMgIT0gbnVsbCkKICAgIHsKICAgICAgbFJldCA9IG1OZXdMb25nVGV4dHMuZ2V0KGxhbmcpOwogICAgfQoKICAgIHJldHVybiBsUmV0OwogIH0KCiAgcHVibGljIHZvaWQgcmVtb3ZlVW51c2VkTmV3TG9uZ1RleHRzKCkKICB7CiAgICBpZiAob0NoYW5nZURvY3VtZW50ICE9IG51bGwpCiAgICB7CiAgICAgIFByZWRpY2F0ZTxATnVsbGFibGUgTGlua2VkTGlzdDxQbG1Mb25nVGV4dExpbmU+PiBpc0VtcHR5VGV4dCA9IHRleHQgLT4gdGV4dCA9PSBudWxsIHx8IHRleHQuaXNFbXB0eSgpCiAgICAgICAgICB8fCAodGV4dC5zaXplKCkgPT0gMSB8fCB0ZXh0LmdldCgwKS5nZXRUZXh0KCkuaXNFbXB0eSgpKTsKCiAgICAgIEl0ZXJhdG9yPEVudHJ5PFN0cmluZywgTGlua2VkTGlzdDxQbG1Mb25nVGV4dExpbmU+Pj4gYWxsTGFuZ3MgPSBvQ2hhbmdlRG9jdW1lbnQubUNoTmV3TG9uZ1RleHQuZW50cnlTZXQoKS5pdGVyYXRvcigpOwogICAgICB3aGlsZSAoYWxsTGFuZ3MuaGFzTmV4dCgpKQogICAgICB7CiAgICAgICAgRW50cnk8U3RyaW5nLCBMaW5rZWRMaXN0PFBsbUxvbmdUZXh0TGluZT4+IGxhbmcgPSBhbGxMYW5ncy5uZXh0KCk7CiAgICAgICAgaWYgKGlzRW1wdHlUZXh0LnRlc3QobGFuZy5nZXRWYWx1ZSgpKSkKICAgICAgICAgIGFsbExhbmdzLnJlbW92ZSgpOwogICAgICB9CiAgICB9CiAgfQoKICBATm9ubnVsbAogIHB1YmxpYyBDb2xsZWN0aW9uPFN0cmluZz4gZ2V0TmV3TG9uZ1RleHRMYW5ndWFnZXMoKQogIHsKICAgIENvbGxlY3Rpb248U3RyaW5nPiBjTGFuZyA9IG51bGw7CiAgICBpZiAobW9kaWZpZWQgJiYgb0NoYW5nZURvY3VtZW50ICE9IG51bGwgJiYgdmFsQXZhaWwob0NoYW5nZURvY3VtZW50Lm1DaE5ld0xvbmdUZXh0KSkKICAgIHsKICAgICAgY0xhbmcgPSBvQ2hhbmdlRG9jdW1lbnQubUNoTmV3TG9uZ1RleHQua2V5U2V0KCk7CiAgICB9CiAgICBlbHNlIGlmIChtTmV3TG9uZ1RleHRzICE9IG51bGwpCiAgICB7CiAgICAgIGNMYW5nID0gbU5ld0xvbmdUZXh0cy5rZXlTZXQoKTsKICAgIH0KCiAgICByZXR1cm4gY0xhbmcgIT0gbnVsbCA/IGNMYW5nIDogbmV3IEhhc2hTZXQ8PigpOwogIH0KCiAgcHVibGljIHZvaWQgc2V0TmV3TG9uZ1RleHQoU3RyaW5nIGxhbmcsIExpbmtlZExpc3Q8UGxtTG9uZ1RleHRMaW5lPiB0ZXh0cykKICB7CiAgICBpbml0Q2hhbmdlRG9jKCk7CiAgICBpZiAob0NoYW5nZURvY3VtZW50Lm1DaE5ld0xvbmdUZXh0ID09IG51bGwpCiAgICAgIG9DaGFuZ2VEb2N1bWVudC5tQ2hOZXdMb25nVGV4dCA9IG5ldyBIYXNoTWFwPFN0cmluZywgTGlua2VkTGlzdDxQbG1Mb25nVGV4dExpbmU+PigpOwoKICAgIG9DaGFuZ2VEb2N1bWVudC5tQ2hOZXdMb25nVGV4dC5wdXQobGFuZywgdGV4dHMpOwogIH0KCiAgLyoqCiAgICogZnVlZ3QgZGVuIHVlYmVyZ2ViZW5lbiBTdHJpbmcgZGVtIExhbmd0ZXh0IGhpbnp1CiAgICoKICAgKiBAcGFyYW0gcwogICAqLwogIHB1YmxpYyB2b2lkIGFkZHRMb25nVGV4dChTdHJpbmcgcykKICB7CiAgICBpbml0Q2hhbmdlRG9jKCk7CiAgICBWZWN0b3I8U3RyaW5nPiB2ID0gb0NoYW5nZURvY3VtZW50Lm1DaExvbmdUZXh0LmdldChhY3RfbGFuZ3UpOwogICAgaWYgKHYgPT0gbnVsbCkKICAgIHsKICAgICAgdiA9IG5ldyBWZWN0b3I8U3RyaW5nPigpOwogICAgICBvQ2hhbmdlRG9jdW1lbnQubUNoTG9uZ1RleHQucHV0KGFjdF9sYW5ndSwgdik7CiAgICB9CiAgICB2LmFkZChzKTsKICB9CgogIC8qKgogICAqIGZ1ZWd0IGRpZSB1ZWJlcmdlYmViZW4gWmVpbGVuIGRlcyBWZWN0b3JzIGRlbSBMYW5ndGV4dCBoaW56dQogICAqCiAgICogQHBhcmFtIHYKICAgKiAgICAgICAgICBsb25nIHRleHQKICAgKi8KICBwdWJsaWMgdm9pZCBhZGR0TG9uZ1RleHQoVmVjdG9yPFN0cmluZz4gdikKICB7CiAgICBpbml0Q2hhbmdlRG9jKCk7CiAgICBWZWN0b3I8U3RyaW5nPiB2X29sZCA9IG9DaGFuZ2VEb2N1bWVudC5tQ2hMb25nVGV4dC5nZXQoYWN0X2xhbmd1KTsKICAgIGlmICh2X29sZCA9PSBudWxsKQogICAgewogICAgICB2X29sZCA9IG5ldyBWZWN0b3I8U3RyaW5nPih2LnNpemUoKSk7CiAgICAgIG9DaGFuZ2VEb2N1bWVudC5tQ2hMb25nVGV4dC5wdXQoYWN0X2xhbmd1LCB2X29sZCk7CiAgICB9CiAgICB2X29sZC5hZGRBbGwodik7CiAgfQoKICAvKioKICAgKiBNZXRob2QgZ2V0U3RhdHVzTG9nCiAgICoKICAgKiBAcmV0dXJuIGEgU3RhdHVzTG9nIC0gc3RhdHVzIGxvZyBhc3NvY2l0YXRlZCB3aXRoIHRoaXMgZG9jIG9yIG51bGwgaWYgaXQgaXMKICAgKiAgICAgICAgIG5vdCByZWFkCiAgICoKICAgKi8KICBwdWJsaWMgU3RhdHVzTG9nIGdldFN0YXR1c0xvZygpCiAgewogICAgcmV0dXJuIHN0YXR1c0xvZzsKICB9CgogIC8qKgogICAqIGdpYnQgZGllIENoYW5nZW51bWJlciB6dXJ1ZWNrCiAgICovCiAgcHVibGljIFN0cmluZyBnZXRDaGFuZ2VOdW1iZXIoKQogIHsKICAgIHJldHVybiBjaGFuZ2VOdW1iZXI7CiAgfQoKICAvKioKICAgKiBzZXR6dCBkaWUgQ2hhbmdlbnVtYmVyIE9uY2UgeW91IHNhdmUgdGhlIGRvY3VtZW50IGluZm8gcmVjb3JkLCB5b3UgY2FuIG5vCiAgICogbG9uZ2VyIGNoYW5nZSB0aGUgY2hhbmdlIG51bWJlci4gSWYgeW91IHdhbnQgdG8gcHJvY2VzcyB0aGUgZG9jdW1lbnQgd2l0aAogICAqIGFub3RoZXIgY2hhbmdlIG51bWJlciwgeW91IGhhdmUgdG8gY3JlYXRlIGEgbmV3IHZlcnNpb24uCiAgICoKICAgKi8KICBwdWJsaWMgdm9pZCBzZXRDaGFuZ2VOdW1iZXIoU3RyaW5nIGNoYW5nZU51bWJlcikKICB7CiAgICB0aGlzLmNoYW5nZU51bWJlciA9IFBsbUNoYW5nZU9iamVjdC5nZXROZXdWYWx1ZUlmQ2hhbmdlZCh0aGlzLmNoYW5nZU51bWJlciwKICAgICAgICBTdHJpbmdUb29sLmlzTnVtZXJpYyhjaGFuZ2VOdW1iZXIpID8gU3RyaW5nVG9vbC5zZXRMZWFkaW5nKGNoYW5nZU51bWJlciwgJzAnLCAxMikgOiBjaGFuZ2VOdW1iZXIsIHRoaXMsICJFQ05VTUJFUiIpOwogIH0KCiAgLyoqCiAgICogTWV0aG9kIHNldENoYW5nZU1hc3RlciBPbmNlIHlvdSBzYXZlIHRoZSBkb2N1bWVudCBpbmZvIHJlY29yZCwgeW91IGNhbiBubwogICAqIGxvbmdlciBjaGFuZ2UgdGhlIGNoYW5nZSBudW1iZXIuIElmIHlvdSB3YW50IHRvIHByb2Nlc3MgdGhlIGRvY3VtZW50IHdpdGgKICAgKiBhbm90aGVyIGNoYW5nZSBudW1iZXIsIHlvdSBoYXZlIHRvIGNyZWF0ZSBhIG5ldyB2ZXJzaW9uLgogICAqCiAgICogQHBhcmFtIGNoYW5nZU1hc3RlcgogICAqICAgICAgICAgIGEgUGxtQ2hhbmdlTWFzdGVyCiAgICoKICAgKi8KICBwdWJsaWMgdm9pZCBzZXRDaGFuZ2VNYXN0ZXIoUGxtQ2hhbmdlTWFzdGVyIGNoYW5nZU1hc3RlcikKICB7CiAgICBzZXRDaGFuZ2VOdW1iZXIoY2hhbmdlTWFzdGVyLmdldENoYW5nZU5vKCkpOwogIH0KCiAgLyoqCiAgICogZ2lidCBkZW4gRG9rdW1lbnQgU2FjaGJlYXJiZWl0ZXIgenVydWVjawogICAqLwogIHB1YmxpYyBTdHJpbmcgZ2V0VXNlcigpCiAgewogICAgcmV0dXJuIHVzZXI7CiAgfQoKICAvKioKICAgKiBzZXR6dCBkZW4gU2FjaGJlYXJiZWl0ZXIKICAgKgogICAqIEBwYXJhbSB1c2VyCiAgICovCiAgcHVibGljIHZvaWQgc2V0VXNlcihTdHJpbmcgdXNlcikKICB7CiAgICB0aGlzLnVzZXIgPSBQbG1DaGFuZ2VPYmplY3QuZ2V0TmV3VmFsdWVJZkNoYW5nZWQodGhpcy51c2VyLCB1c2VyLCB0aGlzLCAiVVNFUk5BTUUiKTsKICB9CgogIC8qKgogICAqIHNldHp0IGRlbiBVc2VyZGVmaW5lZDIgZmxhZyAoWmVpdHN0ZW1wZWwpCiAgICoKICAgKiBAcGFyYW0gcmVzMQogICAqLwogIHB1YmxpYyB2b2lkIHNldFVzZXJEZWZpbmVkMShTdHJpbmcgcmVzMSkKICB7CiAgICB0aGlzLnVzZXJEZWZpbmVkMSA9IFBsbUNoYW5nZU9iamVjdC5nZXROZXdWYWx1ZUlmQ2hhbmdlZCh0aGlzLnVzZXJEZWZpbmVkMSwgcmVzMSwgdGhpcywgIlVTRVJERUZJTkVEMSIpOwogIH0KCiAgLyoqCiAgICogc2V0enQgZGVuIFVzZXJkZWZpbmVkMiBmbGFnIChaZWl0c3RlbXBlbCkKICAgKgogICAqLwogIHB1YmxpYyB2b2lkIHNldFVzZXJEZWZpbmVkMihTdHJpbmcgY2hhbmdlZEF0KQogIHsKICAgIHRoaXMudXNlckRlZmluZWQyID0gUGxtQ2hhbmdlT2JqZWN0LmdldE5ld1ZhbHVlSWZDaGFuZ2VkKHRoaXMudXNlckRlZmluZWQyLCBjaGFuZ2VkQXQsIHRoaXMsICJVU0VSREVGSU5FRDIiKTsKICB9CgogIC8qKgogICAqIHNldHp0IGRlbiBVc2VyZGVmaW5lZDMgZmxhZwogICAqCiAgICovCiAgcHVibGljIHZvaWQgc2V0VXNlckRlZmluZWQzKFN0cmluZyByZXMzKQogIHsKICAgIHRoaXMudXNlckRlZmluZWQzID0gUGxtQ2hhbmdlT2JqZWN0LmdldE5ld1ZhbHVlSWZDaGFuZ2VkKHRoaXMudXNlckRlZmluZWQzLCByZXMzLCB0aGlzLCAiVVNFUkRFRklORUQzIik7CiAgfQoKICAvKioKICAgKiBzZXR6dCBkZW4gVXNlcmRlZmluZWQ0IGZsYWcKICAgKgogICAqLwogIHB1YmxpYyB2b2lkIHNldFVzZXJEZWZpbmVkNChTdHJpbmcgcmVzNCkKICB7CiAgICB0aGlzLnVzZXJEZWZpbmVkNCA9IFBsbUNoYW5nZU9iamVjdC5nZXROZXdWYWx1ZUlmQ2hhbmdlZCh0aGlzLnVzZXJEZWZpbmVkNCwgcmVzNCwgdGhpcywgIlVTRVJERUZJTkVENCIpOwogIH0KCiAgLyoqCiAgICogZ2lidCBkZW4gRG9rdW1lbnRzdGF0dXMgenVydWVjawogICAqLwogIHB1YmxpYyBTdHJpbmcgZ2V0U3RhdHVzKCkKICB7CiAgICByZXR1cm4gc3RhdHVzOwogIH0KCiAgLyoqCiAgICogQHJldHVybiB0cnVlIGlmIHRoZSBkb2N1bWVudCBpcyBpbiBjaGVja291dCBzdGF0dXMKICAgKi8KICBwdWJsaWMgYm9vbGVhbiBoYXNDaGVja291dFN0YXR1cygpCiAgewogICAgcmV0dXJuIChpc0NoZWNrb3V0U3RhdHVzKGdldFN0YXR1cygpLCBnZXRUeXBlKCkpKTsKICB9CgogIC8qKgogICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgZG9jdW1lbnQgaXMgaW4gbG9jayBzdGF0dXMKICAgKi8KICBwdWJsaWMgYm9vbGVhbiBoYXNMb2NrZWRTdGF0dXMoKQogIHsKICAgIFBsbVN0YXR1c0NvbnRhaW5lciBwbG1fc3RhdF9jb250ID0gUGxtU3RhdHVzVG9vbC5nZXREb2NTdGF0dXMoZ2V0VHlwZSgpLCBnZXRTdGF0dXMoKSk7CiAgICBpZiAocGxtX3N0YXRfY29udCA9PSBudWxsKQogICAgewogICAgICAvLyAyNS4wMS4yMDA2IHd0IC0gZXMgZ2lidCBEb2t1bWVudGFydGVuIGRpZSBrZWluIFN0YXR1c25ldHp3ZXJrIGhhYmVuIC0+CiAgICAgIC8vIGRpZSBEb2t1bWVudGUgaGFiZW4gZGFubiBhdWNoIGtlaW4gU3RhdHVzIC0tPgogICAgICAvLyBlcyBtdXNzIGFiZXIgaW1tZXIgbm9jaCBtb2VnbGljaCBzZWluIHouYi4gRG9rdW1lbnRiZXNjaHJlaWJ1bmcgenUKICAgICAgLy8gYWVuZGVybi4KICAgICAgLy8gYWxzbyBrZWluIHN0YXR1cyBkZWZpbmllcnQgaGVpc3N0IGF1Y2ggZXMgaXN0IGtlaW4gbG9ja3N0YXR1cyAtIHJldAogICAgICAvLyBmYWxzZQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICByZXR1cm4gcGxtX3N0YXRfY29udC5pc0xvY2tlZFN0YXR1cygpOwogIH0KCiAgLyoqCiAgICogTWV0aG9kIHNldFN0YXR1cyBzZXR6dCBkZW4gRG9rdW1lbnRzdGF0dXMKICAgKgogICAqIEBwYXJhbSBzdGF0dXMKICAgKiAgICAgICAgICBhIFN0cmluZwogICAqCiAgICovCiAgcHVibGljIHZvaWQgc2V0U3RhdHVzKFN0cmluZyBzdGF0dXMpCiAgewogICAgc2V0U3RhdHVzKHN0YXR1cywgbnVsbCk7CiAgfQoKICAvKioKICAgKiBNZXRob2Qgc2V0U3RhdHVzIHNldHp0IGRlbiBEb2t1bWVudHN0YXR1cyB1bmQgZGF6dSBlaW5lbiBFaW50cmFnIGluIGRhcwogICAqIFN0YXR1c2xvZwogICAqCiAgICogQHBhcmFtIHN0YXR1cwogICAqICAgICAgICAgIGEgU3RyaW5nCiAgICogQHBhcmFtIHN0YXR1c19sb2cKICAgKiAgICAgICAgICBhIFN0cmluZwogICAqCiAgICovCiAgcHVibGljIHZvaWQgc2V0U3RhdHVzKFN0cmluZyBzdGF0dXMsIFN0cmluZyBzdGF0dXNfbG9nKQogIHsKICAgIHRoaXMuc3RhdHVzID0gUGxtQ2hhbmdlT2JqZWN0LmdldE5ld1ZhbHVlSWZDaGFuZ2VkKHRoaXMuc3RhdHVzLCBzdGF0dXMsIHRoaXMsIG5ldyBTdHJpbmdbXSB7IlNUQVRVU0VYVEVSTiIsICJTVEFUVVNJTlRFUk4ifSk7CgogICAgaWYgKGhhc0NvbnRlbnQoc3RhdHVzX2xvZykpCiAgICB7CiAgICAgIC8vQXZvaWQgTnVsbFBvaW50ZXIgd2hpY2ggY2FuIG9jY3VyIGlmIHRoZSBzdGF0dXMgaGFzIG5vdCBjaGFuZ2VkID0+IG9DaGFuZ2VPYmplY3QgaXMgbnVsbCBpbiB0aGlzIGNhc2UuCiAgICAgIFBsbUNoYW5nZURvY3VtZW50IGNoYW5nZURvY3VtZW50ID0gKFBsbUNoYW5nZURvY3VtZW50KSBnZXRDaGFuZ2VPYmplY3QoKTsKICAgICAgY2hhbmdlRG9jdW1lbnQuY2hTdGF0dXNMb2cgPSBzdGF0dXNfbG9nOwogICAgfQogIH0KCiAgLyoqCiAgICogZ2lidCBkYXMgTGFib3JhdG9yeS9PZmZpY2UgenVydWVjawogICAqLwogIHB1YmxpYyBTdHJpbmcgZ2V0T2ZmaWNlKCkKICB7CiAgICByZXR1cm4gb2ZmaWNlOwogIH0KCiAgLyoqCiAgICogc2V0enQgZGFzIERva3VtZW50IExhYm9yYXRvcnkvT2ZmaWNlCiAgICoKICAgKi8KICBwdWJsaWMgdm9pZCBzZXRPZmZpY2UoU3RyaW5nIG9mZmljZSkKICB7CiAgICB0aGlzLm9mZmljZSA9IFBsbUNoYW5nZU9iamVjdC5nZXROZXdWYWx1ZUlmQ2hhbmdlZCh0aGlzLm9mZmljZSwgb2ZmaWNlLCB0aGlzLCAiTEFCT1JBVE9SWSIpOwogIH0KCiAgLyoqCiAgICogUmV2aXNpb25MZXZlbCBvZiB0aGUgZG9jdW1lbnQKICAgKi8KICBwdWJsaWMgU3RyaW5nIGdldFJldkxldmVsKCkKICB7CiAgICByZXR1cm4gcmV2TGV2ZWw7CiAgfQoKICAvKioKICAgKiBSZXZpc2lvbkxldmVsIG9mIHRoZSBkb2N1bWVudAogICAqLwogIHB1YmxpYyB2b2lkIHNldFJldkxldmVsKFN0cmluZyB2YWwpCiAgewogICAgdGhpcy5yZXZMZXZlbCA9IFBsbUNoYW5nZU9iamVjdC5nZXROZXdWYWx1ZUlmQ2hhbmdlZCh0aGlzLnJldkxldmVsLCB2YWwsIHRoaXMsICJSRVZMRVZFTCIpOwogIH0KCiAgcHVibGljIFN0cmluZyBnZXRDbGFzc2lmaWNhdGlvbkZsYWcoKQogIHsKICAgIHJldHVybiBjbGFzc2lmaWNhdGlvbkZsYWc7CiAgfQoKICAvKioKICAgKiBHZXQgdGhlIEFwcGxpY2F0aW9uIHR5cGUuIExvb2tzIGluIFVzZXJkZWZpbmVkNCBmaWVsZCBhbmQgdGFrZXMgYWxsIGNoYXJzCiAgICogdW50aWwgdGhlIGNoYXIgJzonLgogICAqCiAgICogQHJldHVybiBhcHBsaWNhdGlvbiB0eXBlIGZvciB0aGUgZG9jdW1lbnQgb3IgZW1wdHkgaWYgbm90IHNldCAvIHZhbGlkCiAgICovCiAgcHVibGljIFN0cmluZyBnZXRBcHBsaWNhdGlvblR5cGUoKQogIHsKICAgIC8vIGdldCB0aGUgYXBwbGljYXRpb24gdHlwZSBmcm9tIHRoZSByZXM0IGZpZWxkIC0gZS5nLiBVR1M6UAogICAgU3RyaW5nIHJlczQgPSBnZXRVc2VyRGVmaW5lZDQoKTsKICAgIHJldHVybiAoZ2V0QXBwbGljYXRpb25UeXBlKHJlczQsIGdldFR5cGUoKSkpOwogIH0KCiAgLyoqCiAgICogR2V0IHRoZSBBcHBsaWNhdGlvbiB0eXBlLiBMb29rcyBpbiB1c2VyZGVmaW5lZDQgZmllbGQgYW5kIHRha2VzIGFsbCBjaGFycwogICAqIHVudGlsIHRoZSBjaGFyICc6Jy4KICAgKgogICAqIEByZXR1cm4gYXBwbGljYXRpb24gdHlwZSBmb3IgdGhlIGdpdmVuIHVzZXJkZWZpbmVkNAogICAqLwogIHB1YmxpYyBzdGF0aWMgU3RyaW5nIGdldEFwcGxpY2F0aW9uVHlwZShTdHJpbmcgdXNlcmRlZmluZWQ0LCBTdHJpbmcgZG9jdW1lbnRfdHlwZSkKICB7CiAgICBpZiAoaGFzQ29udGVudCh1c2VyZGVmaW5lZDQpKQogICAgewogICAgICBpbnQgaW5kID0gdXNlcmRlZmluZWQ0LmluZGV4T2YoIjoiKTsKCiAgICAgIGlmIChpbmQgPiAtMSkKICAgICAgewogICAgICAgIFN0cmluZyBhcHBsdHlwZSA9IHVzZXJkZWZpbmVkNC5zdWJzdHJpbmcoMCwgaW5kKTsKICAgICAgICByZXR1cm4gYXBwbHR5cGU7CiAgICAgIH0KICAgICAgZWxzZQogICAgICAgIHJldHVybiAiIjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgLy8gY2hlY2sgaWYgdGhlcmUgYXJlIGRlZmF1bHQgc2V0dGluZ3MgZm9yIHRoZSBkb2N1bWVudCB0eXBlIGluIHRoZQogICAgICAvLyBwcmVmZXJlbmVjZXMKICAgICAgU3RyaW5nIHJlczRfcHJlZiA9IGdldFByZWZlcmVuY2UoInBsbS5jb250cm9sLmVtcHR5LnVzZXJkZWZpbmVkNC4iICsgZG9jdW1lbnRfdHlwZSwgInBsbS5jb250cm9sLmVtcHR5LnVzZXJkZWZpbmVkNC5kZWZhdWx0Iik7CiAgICAgIGlmIChoYXNDb250ZW50KHJlczRfcHJlZikpCiAgICAgICAgcmV0dXJuIGdldEFwcGxpY2F0aW9uVHlwZShyZXM0X3ByZWYsIGRvY3VtZW50X3R5cGUpOwogICAgICBlbHNlCiAgICAgICAgcmV0dXJuICIiOwogICAgfQogIH0KCiAgLyoqCiAgICogRXh0cmFjdHMgdGhlIG9iamVjdCB0eXBlIG91dCBvZiB1c2VyZGVmaW5lZDQgZmllbGQsIGUuZy4gIlVHUzpQIiAtLT4gIlAiCiAgICoKICAgKiBAcmV0dXJuIG9iamVjdCB0eXBlLCBlLmcuICJBIiwgIlAiLCAiRCIKICAgKi8KICBwdWJsaWMgU3RyaW5nIGdldFVzZXJEZWZpbmVkNE9iamVjdFR5cGUoKQogIHsKICAgIHJldHVybiBnZXRVc2VyRGVmaW5lZDRPYmplY3RUeXBlKGdldFVzZXJEZWZpbmVkNCgpKTsKICB9CgogIHB1YmxpYyBzdGF0aWMgU3RyaW5nIGdldFVzZXJEZWZpbmVkNE9iamVjdFR5cGUoU3RyaW5nIHJlczQpCiAgewogICAgU3RyaW5nIHJlc3VsdCA9ICIiOwogICAgaWYgKGhhc0NvbnRlbnQocmVzNCkpCiAgICB7CiAgICAgIGludCBpbmQgPSByZXM0LmluZGV4T2YoIjoiKTsKCiAgICAgIGlmIChpbmQgPiAtMSkKICAgICAgewogICAgICAgIHRyeQogICAgICAgIHsKICAgICAgICAgIHJlc3VsdCA9IHJlczQuc3Vic3RyaW5nKGluZCArIDEpOwogICAgICAgIH0KICAgICAgICBjYXRjaCAoSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiBlKQogICAgICAgIHsKICAgICAgICAgIC8qdGhlbiB0aGUgcmVzdWx0IGlzIGxlZnQgYXMgaXQgaXMgLSBlbXB0eSBzdHJpbmcuKi8KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICBwdWJsaWMgYm9vbGVhbiBoYXNWZXJzaW9uKCkKICB7CiAgICBpZiAoaXNGYW1pbHlNZW1iZXIoKSkKICAgIHsKICAgICAgaWYgKGdldEZhbWlseSgpLmVxdWFscyhQbG1Eb2N1bWVudC5GQU1JTFlfTUVNQkVSX1ZFUlNJT04pKQogICAgICAgIHJldHVybiB0cnVlOwogICAgICBlbHNlCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKgogICAqIEByZXR1cm4gY2hlY2tvdXQgc2l6ZSBhcyBkZXRlcm1pbmVkIGluIEFCQVAKICAgKi8KICBwdWJsaWMgbG9uZyBnZXRDaGVja291dFNpemUoKQogIHsKICAgIHJldHVybiBjaGVja291dFNpemU7CiAgfQoKICAvKioKICAgKiBSZXR1cm5zIHRoZSBtYXN0ZXIgd29ya3N0YXR0aW9uIGFwcGxpY2F0aW9uIGZvciB0aGlzIGRvY3VtZW50LCBtYXBwZWQgdGhyb3VnaAogICAqIGR0eXBlCiAgICogQHJldHVybiB0aGUgd29ya3N0YXRpb24gYXBwbGljYXRpb24gb3IgbnVsbCBpZiBub3Qgc2V0CiAgICovCiAgcHVibGljIFN0cmluZyBnZXRNYXN0ZXJXb3Jrc3RhdGlvbkFwcGxpY2F0aW9uKCkKICB7CiAgICBTdHJpbmcgd3NhcHBsID0gbnVsbDsKICAgIHRyeQogICAgewogICAgICB3c2FwcGwgPSBnZXRNYXN0ZXJXb3Jrc3RhdGlvbkFwcGxpY2F0aW9uKGdldERUeXBlSWQoKSk7CiAgICB9CiAgICBjYXRjaCAoRGVmYXVsdExvZ0V4Y2VwdGlvbiBkbGUpCiAgICB7CiAgICAgIFRyYWNlLnByaW50bG5TdGFja1RyYWNlKFRyYWNlLlRSQUNFLCBkbGUpOwogICAgfQogICAgcmV0dXJuIHdzYXBwbDsKICB9CgogIC8qKgogICAqIEdldCB0aGUgb3JpZ2luYWwgZmlsZSBmcm9tIGEgRG9jdW1lbnQuPGJyPgogICAqIDwvYnI+IFVzZXMgZ2V0QXBwbGljYXRpb25UeXBlKCkgYW5kIGdldFdzQXBwbCgpLiBJZiBubyBtYXN0ZXIgb3JpZ2luYWwgaXMKICAgKiBhdmFpbGFibGUsIHRoZW4gaXQgd2lsbCBiZSBsb29rZWQgaW50byB0aGUgQ2hlY2tpbi9jaGVja291dCBpbmZvcyBpZiB0aGVyZQogICAqIGlzIG9uZSBkZWZpbmVkLgogICAqCiAgICogQHJldHVybiBQbG1GaWxlIHJlcHJlc2VudGluZyB0aGUgb3JpZ2luYWwgYXBwbGljYXRpb24gZmlsZSwgbnVsbCBpZiBubwogICAqICAgICAgICAgbWF0Y2hpbmcgT3JpZ2luYWwgd2FzIGZvdW5kCiAgICovCiAgcHVibGljIFBsbUZpbGUgZ2V0TWFzdGVyT3JpZ2luYWwoKQogIHsKICAgIFN0cmluZyB3c2FwcGwgPSBnZXRNYXN0ZXJXb3Jrc3RhdGlvbkFwcGxpY2F0aW9uKCk7CgogICAgLy8gZ2V0IHRoZSBmaWxlcyAod3NhcHBsIGNhbiBiZSBudWxsIGlmIHRoZXJlIGlzIG5vIHZhbGlkIHJlczQgaW5mbyBvcgogICAgLy8gbm8gZmlsZSB3aXRoIHRoYXQgd3NhcHBsIGluIHRlaCBrcHJvCiAgICBWZWN0b3I8UGxtRmlsZT4gb3JpZ2luYWxzID0gZ2V0RmlsZXMod3NhcHBsKTsKICAgIGlmIChoYXNOb0l0ZW1zKG9yaWdpbmFscykpCiAgICB7CiAgICAgIFRyYWNlLnByaW50bG4oVHJhY2UuTU9SRV9ERUJVRywgIk5vIG9yaWdpbmFscyB3aXRoIG1hc3RlciB3b3Jrc3RhdGlvbiBhcHBsaWNhdGlvbi4gRGV0ZXJtaW5lIHZpYSBDaGVja2luL291dCBpbmZvcm1hdGlvbiBvYmplY3QuIik7CiAgICAgIC8vIHRoZXJlIGlzIG5vIG1hc3RlciBmaWxlIGF2YWlsYWJsZSB3aXRoIHRoZSBkZWZpbmVkIG1hc3RlciB3c2FwcGwKICAgICAgLy8gKGZyb20gdGhlIHByZWZlcmVuY2VzKS4gVHJ5IHRvIGRldGVybWluZSB0aGUgbWFzdGVyIGZpbGUgdmlhIHRoZQogICAgICAvLyBjaGVja2luIGluZm9ybWF0aW9uCiAgICAgIEl0ZXJhdG9yPFBsbUZpbGU+IGl0ID0gZ2V0RmlsZXMoKS5nZXRQbG1PYmplY3RzKCkuaXRlcmF0b3IoKTsKICAgICAgd2hpbGUgKGl0Lmhhc05leHQoKSkKICAgICAgewogICAgICAgIFBsbUZpbGUgZmlsZSA9IGl0Lm5leHQoKTsKICAgICAgICBUcmFjZS5wcmludGxuKFRyYWNlLk1PUkVfREVCVUcsICJGaWxlICIgKyBmaWxlKTsKICAgICAgICBpZiAoZmlsZS5nZXRDaGVja0luSW5mb3JtYXRpb24oKS5pc01hc3RlckZpbGUoKSB8fCBmaWxlLmdldENoZWNrT3V0SW5mb3JtYXRpb24oKS5pc01hc3RlckZpbGUoKSkKICAgICAgICB7CiAgICAgICAgICBUcmFjZS5wcmludGxuKFRyYWNlLk1PUkVfREVCVUcsICIgIGlzTWFzdGVyOiB0cnVlIik7CiAgICAgICAgICByZXR1cm4gZmlsZTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgIFRyYWNlLnByaW50bG4oVHJhY2UuTU9SRV9ERUJVRywgIiAgaXNNYXN0ZXI6IGZhbHNlIik7CiAgICAgICAgfQogICAgICB9CiAgICAgIC8vIG5vdCBldmVuIGEgbWFzdGVyIGZpbGUgaXMgZGVmaW5lZCBpbiB0aGUgY2hlY2tpbiBpbmZvCiAgICAgIFRyYWNlLnByaW50bG4oVHJhY2UuSU1QT1JUQU5ULAogICAgICAgICAgIk5vIE9yaWdpbmFsIGZvciBEb2N1bWVudDogIiArIGdldFNhcEtleSgpICsgIiB3aXRoIFdTQVBQTCA9ICIgKyBnZXRNYXN0ZXJXb3Jrc3RhdGlvbkFwcGxpY2F0aW9uKCkgKyAiIGZvdW5kLiIpOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgaW50IHNpemUgPSBvcmlnaW5hbHMuc2l6ZSgpOwogICAgICBpZiAoc2l6ZSA9PSAxKQogICAgICB7CiAgICAgICAgLy8gdGhlcmUgc2hvdWxkIGJlIG9ubHkgb25lIG9yaWdpbmFsIGZpbGUgIQogICAgICAgIFBsbUZpbGUgZmlsZSA9IG9yaWdpbmFscy5maXJzdEVsZW1lbnQoKTsKICAgICAgICByZXR1cm4gZmlsZTsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICAvLyBzb21laG93IHdlIGhhdmUgbW9yZSB0aGFuIE9ORSBNYXN0ZXIgT3JpZ2luYWwgISEgVGhpcyBiYXNpY2FsbHkKICAgICAgICAvLyBzaG91bGRuJ3QgaGFwcGVuLCBidXQgZHVyaW5nIHRoZSBjaGVja2luIHByb2Nlc3MgaXQgaXMgcG9zc2libGUuCiAgICAgICAgLy8gRm9sbG93aW5nIHNjZW5hcmlvOgogICAgICAgIC8vIENyZWF0ZSBhIFBhcnQgQS4gQWRkIGEgY29tcG9uZW50IEIgdG8gdGhhdCBwYXJ0LgogICAgICAgIC8vIC0gUGFydCBBIGlzIGNyZWF0ZWQgKGZpbGVuYW1lIGluIEtwcm8gd2lsbCBiZSB0ZW1wbGF0ZS5wcnQhKQogICAgICAgIC8vIC0gUGFydCBBIG11c3QgYmUgc2F2ZWQuIFRoZSBkb2N1bWVudCBzdHJ1Y3R1cmUgd2lsbCBiZSB1cGRhdGVkCiAgICAgICAgLy8gLSBldmVyeXRoaW5nIG9rIHRpbGwgaGVyZQogICAgICAgIC8vIC0gdGhlIHJlczQgbXVzdCBiZSBjaGFuZ2VkIGZyb20gVUdTOlAgdG8gVUdTOkEgKGRvbmUgdmlhIGRvYy5mbHVzaCgpKQogICAgICAgIC8vIC0gbm93IGEgQkFQSV9HRVRfREVUQUlMIGlzIGNhbGxlZAogICAgICAgIC8vIC0gdGhlIGRvY3VtZW50IHdpbGwgYmUgdXBkYXRlZCB3aXRoIHRoZSBpbmZvcyBmcm9tIHRoZSBkZXRhaWwKICAgICAgICAvLyAtIGhlcmUgd2UgZG9uJ3QgZmluZCB0aGUgb2xkIG9yaWdpbmFsIChiZWNhdXNlIGl0IGhhcyBhCiAgICAgICAgLy8gZGlmZmVyZW50IGFwcGxpZCAvIGZpbGVpZCAtIGFuZCBldmVuIHRoZSByZWwgbmFtZXMgYXJlIG5vdCB0aGUgc2FtZQogICAgICAgIC8vIChyZWxfbmFtZSBpbiBkb2MgPSB0ZW1wbGF0ZS5wcnQsIHJldHVybmVkIGZyb20gQkFQSSA9CiAgICAgICAgLy8gMTUwN3VtazAwMF8wMC5wcnQpCiAgICAgICAgLy8gLSBub3cgYSAybmQgb3JpZ2luYWwgZmlsZSBpcyBhZGRlZAoKICAgICAgICAvLyBob3cgdG8gc29sdmUgdGhpcyA/CiAgICAgICAgLy8gaSByZWFkIHRoZSBjaGVja2luaW5mb3JtYXRpb24gZnJvbSBib3RoIGZpbGVzIGFuZCBjaGVjayB3aGljaCBvZgogICAgICAgIC8vIHRoZW0gaXMgaW5pdGlhbGl6ZWQgKGhhcyBzZXQgdmFsdWVzKS4gSSB3aWxsIHJldHVybiB0aGUgUGxtRmlsZQogICAgICAgIC8vIHdoZXJlIHRoZSBDaGVja2luaW5mbyBpcyB2YWxpZCAhIQoKICAgICAgICAvLyB0YWtlIHRoZSBmaXJzdCBmaWxlIGFzIGRlZmF1bHQKICAgICAgICBQbG1GaWxlIHBmX3JldCA9IG9yaWdpbmFscy5maXJzdEVsZW1lbnQoKTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzaXplOyBpKyspCiAgICAgICAgewogICAgICAgICAgUGxtRmlsZSBwZiA9IG9yaWdpbmFscy5lbGVtZW50QXQoaSk7CgogICAgICAgICAgLy8gaSB3aWxsIEFMV0FZUyBnZXQgYSBvYmplY3QgYmFjayBmcm9tIHRoaXMgbWV0aG9kLgogICAgICAgICAgUGxtQ2hlY2tJbkluZm9ybWF0aW9uIGNpaSA9IHBmLmdldENoZWNrSW5JbmZvcm1hdGlvbigpOwoKICAgICAgICAgIC8vIHRoZSBwYXJ0aGFuZGxlciBtb2RlIG11c3QgYmUgZ3JlYXRlciB0aGFuIC0xICwgdGhlbiB0aGUKICAgICAgICAgIC8vIGNoZWNraW5pbmZvcm1hdGlvbiBpIGdvdCB3YXMgaW5pdGlhbGl6ZWQgYnkgdGhlIHByb2Nlc3MKICAgICAgICAgIC8vIHByZXZpb3VzbHkKICAgICAgICAgIGlmIChjaWkuZ2V0UGFydEhhbmRsZXJNb2RlKCkgIT0gLTEpCiAgICAgICAgICB7CiAgICAgICAgICAgIHBmX3JldCA9IHBmOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHBmX3JldDsKICAgICAgfQogICAgfQogIH0KCiAgLyoqCiAgICogR2V0IHRoZSBjaGVja2luIGluZm9ybWF0aW9uIG9iamVjdCBmb3IgdGhlIE1hc3RlciBGaWxlIG9mIHRoaXMgZG9jdW1lbnQuCiAgICogPGJyPgogICAqIDwvYnI+VGhpcyBvYmplY3QgaXMgZmlsbGVkIHdpdGggaW5mb3JtYXRpb25zIGR1cmluZyB0aGUgd2hvbGUgY2hlY2sgaW4KICAgKiBwcm9jZXNzLiBJdCBhbHNvIGNvbnRyb2xzIHdoYXQgd2lsbCBiZSBkb25lIC8gaGFzIHRvIGJlIGRvbmUgd2l0aCB0aGlzCiAgICogUGxtRmlsZSBpbiB0aGUgZnV0dXJlLgogICAqCiAgICogQHJldHVybiBDaGVja0luSW5mb3JtYXRpb24gLSBmb3IgbWFzdGVyIG9yaWdpbmFsCiAgICovCiAgcHVibGljIFBsbUNoZWNrSW5JbmZvcm1hdGlvbiBnZXRNYXN0ZXJDaGVja0luSW5mb3JtYXRpb24oKQogIHsKICAgIFBsbUZpbGUgZm1hc3RlciA9IGdldE1hc3Rlck9yaWdpbmFsKCk7CiAgICBpZiAoZm1hc3RlciAhPSBudWxsKQogICAgICByZXR1cm4gZm1hc3Rlci5nZXRDaGVja0luSW5mb3JtYXRpb24oKTsKICAgIGVsc2UKICAgICAgcmV0dXJuIG51bGw7CiAgfQoKICAvKioKICAgKiBHZXQgdGhlIGNoZWNrb3V0IGluZm9ybWF0aW9uIG9iamVjdCBmb3IgdGhlIE1hc3RlciBGaWxlIG9mIHRoaXMgZG9jdW1lbnQuCiAgICogPGJyPgogICAqIDwvYnI+VGhpcyBvYmplY3QgaXMgZmlsbGVkIHdpdGggaW5mb3JtYXRpb25zIGR1cmluZyB0aGUgd2hvbGUgY2hlY2sgb3V0CiAgICogcHJvY2Vzcy4gSXQgYWxzbyBjb250cm9scyB3aGF0IHdpbGwgYmUgZG9uZSAvIGhhcyB0byBiZSBkb25lIHdpdGggdGhpcwogICAqIFBsbUZpbGUgaW4gdGhlIGZ1dHVyZS4KICAgKgogICAqIEByZXR1cm4gQ2hlY2tPdXRJbmZvcm1hdGlvbiAtIGZvciBtYXN0ZXIgb3JpZ2luYWwKICAgKi8KICBwdWJsaWMgUGxtRmlsZS5DaGVja091dEluZm9ybWF0aW9uIGdldE1hc3RlckNoZWNrT3V0SW5mb3JtYXRpb24oKQogIHsKICAgIFBsbUZpbGUgZm1hc3RlciA9IGdldE1hc3Rlck9yaWdpbmFsKCk7CiAgICBpZiAoZm1hc3RlciAhPSBudWxsKQogICAgICByZXR1cm4gZm1hc3Rlci5nZXRDaGVja091dEluZm9ybWF0aW9uKCk7CiAgICBlbHNlCiAgICAgIHJldHVybiBudWxsOwogIH0KCiAgLyoqCiAgICogUmVzZXQgYWxsIENoZWNrT3V0SW5mb3JtYXRpb24gb2JqZWN0cy4gQWxsIHN0b3JlZCB2YWx1ZXMgd2lsbCBiZSBzZXQgYmFjawogICAqIHRvIGRlZmF1bHQuCiAgICovCiAgcHVibGljIHZvaWQgcmVzZXRBbGxDaGVja091dEluZm9ybWF0aW9uKCkKICB7CiAgICBDb2xsZWN0aW9uPFBsbUZpbGU+IGNvbCA9IGdldEZpbGVzKCkuZ2V0UGxtT2JqZWN0cygpOwogICAgaWYgKGhhc0l0ZW1zKGNvbCkpCiAgICB7CiAgICAgIGZvciAoUGxtRmlsZSBwZmlsZSA6IGNvbCkKICAgICAgewogICAgICAgIHBmaWxlLnJlc2V0Q2hlY2tPdXRJbmZvcm1hdGlvbigpOwogICAgICB9CiAgICB9CiAgfQoKICAvKioKICAgKiBSZXNldCBhbGwgQ2hlY2tPdXRJbmZvcm1hdGlvbiBvYmplY3RzLiBBbGwgc3RvcmVkIHZhbHVlcyB3aWxsIGJlIHNldCBiYWNrCiAgICogdG8gZGVmYXVsdC4KICAgKi8KICBwdWJsaWMgdm9pZCByZXNldEFsbENoZWNrSW5JbmZvcm1hdGlvbigpCiAgewogICAgQ29sbGVjdGlvbjxQbG1GaWxlPiBjb2wgPSBnZXRGaWxlcygpLmdldFBsbU9iamVjdHMoKTsKICAgIGlmIChoYXNJdGVtcyhjb2wpKQogICAgewogICAgICBmb3IgKFBsbUZpbGUgcGZpbGUgOiBjb2wpCiAgICAgIHsKICAgICAgICBwZmlsZS5yZXNldENoZWNrSW5JbmZvcm1hdGlvbigpOwogICAgICB9CiAgICB9CiAgfQoKICAvKioKICAgKiBNZXRob2QgZ2V0QWRkaXRpb25hbEZpbGVzIGdldCBhbGwgRmlsZXMgZXhjbHVkZWQgdGhlIG1hc3RlciBmaWxlCiAgICoKICAgKiBAcmV0dXJuIGEgVmVjdG9yIG9mIFBsbUZpbGVzCiAgICoKICAgKi8KICBwdWJsaWMgVmVjdG9yPFBsbUZpbGU+IGdldEFkZGl0aW9uYWxGaWxlcygpCiAgewogICAgVmVjdG9yPFBsbUZpbGU+IHJldHVybl92ZWMgPSBuZXcgVmVjdG9yPFBsbUZpbGU+KCk7CiAgICBTdHJpbmcgd3NhcHBsID0gZ2V0TWFzdGVyV29ya3N0YXRpb25BcHBsaWNhdGlvbigpOwogICAgaWYgKHdzYXBwbCA9PSBudWxsKQogICAgICByZXR1cm4gcmV0dXJuX3ZlYzsKCiAgICAvLyBnZXQgdGhlIGZpbGVzCiAgICBJdGVyYXRvcjxQbG1GaWxlPiBpdGVyID0gZ2V0RmlsZXMoKS5nZXRQbG1PYmplY3RzKCkuaXRlcmF0b3IoKTsKICAgIHdoaWxlIChpdGVyLmhhc05leHQoKSkKICAgIHsKICAgICAgUGxtRmlsZSBwbG1fZmlsZSA9IGl0ZXIubmV4dCgpOwogICAgICBpZiAocGxtX2ZpbGUgIT0gbnVsbCAmJiAhd3NhcHBsLmVxdWFscyhwbG1fZmlsZS5nZXRXb3Jrc3RhdGlvbkFwcGxpY2F0aW9uKCkpKQogICAgICAgIHJldHVybl92ZWMuYWRkKHBsbV9maWxlKTsKICAgIH0KICAgIHJldHVybiByZXR1cm5fdmVjOwogIH0KCiAgLyoqCiAgICogZ2lidCBkaWUgQmVyZWNodGlndW5nc2dydXBwZSB6dXJ1ZWNrCiAgICovCiAgcHVibGljIFN0cmluZyBnZXRBdXRob3JpemF0aW9uR3JvdXAoKQogIHsKICAgIHJldHVybiBhdXRob3JpemF0aW9uR3JvdXA7CiAgfQoKICAvKioKICAgKiBEZWxldGUgRmxhZwogICAqLwogIHB1YmxpYyBib29sZWFuIGdldERlbGV0ZUZsYWcoKQogIHsKICAgIHJldHVybiBkZWxldGVGbGFnOwogIH0KCiAgLyoqCiAgICogRGVsZXRlIEZsYWcKICAgKi8KICBwdWJsaWMgdm9pZCBzZXREZWxldGVGbGFnKGJvb2xlYW4gdmFsKQogIHsKICAgIHRoaXMuZGVsZXRlRmxhZyA9IFBsbUNoYW5nZU9iamVjdC5nZXROZXdWYWx1ZUlmQ2hhbmdlZCh0aGlzLmRlbGV0ZUZsYWcsIHZhbCwgdGhpcywgIkRFTEVURUlORElDQVRPUiIpOwogIH0KCiAgcHVibGljIGJvb2xlYW4gZ2V0U3RydWN0dXJlRmxhZygpCiAgewogICAgcmV0dXJuIHN0cnVjdHVyZUZsYWc7CiAgfQoKICAvKioKICAgKiBDQUQgRmxhZwogICAqLwogIHB1YmxpYyBib29sZWFuIGdldENhZEluZGljYXRvcigpCiAgewogICAgcmV0dXJuIGNhZEluZGljYXRvcjsKICB9CgogIC8qKgogICAqIHNldCBDQUQgRmxhZwogICAqLwogIHB1YmxpYyB2b2lkIHNldENhZEluZGljYXRvcihib29sZWFuIHZhbCkKICB7CiAgICB0aGlzLmNhZEluZGljYXRvciA9IFBsbUNoYW5nZU9iamVjdC5nZXROZXdWYWx1ZUlmQ2hhbmdlZCh0aGlzLmNhZEluZGljYXRvciwgdmFsLCB0aGlzLCAiQ0FESU5ESUNBVE9SIik7CiAgfQoKICAvKioKICAgKiBzZXQgYXV0aG9yaXphdGlvbiBncm91cAogICAqLwogIHB1YmxpYyB2b2lkIHNldEF1dGhvcml0eUdyb3VwKFN0cmluZyBzKQogIHsKICAgIFN0cmluZyB0bXAgPSBzOwogICAgaWYgKHRtcCA9PSBudWxsKQogICAgICB0bXAgPSAiIjsKCiAgICB0aGlzLmF1dGhvcml6YXRpb25Hcm91cCA9IFBsbUNoYW5nZU9iamVjdC5nZXROZXdWYWx1ZUlmQ2hhbmdlZCh0aGlzLmF1dGhvcml6YXRpb25Hcm91cCwgdG1wLCB0aGlzLCAiQVVUSE9SSVRZR1JPVVAiKTsKICB9CgogIC8qKgogICAqIEByZXR1cm4gdHJ1ZSBpZiBkb2MgaGFzIG1vcmUgdGhhbiBvbmUgbWF0bGluawogICAqLwogIHB1YmxpYyBib29sZWFuIGhhc01vcmVUaGFuT25lTWF0ZXJpYWxMaW5rKCkKICB7CiAgICByZXR1cm4gIVN0cmluZ1Rvb2wuZ2V0U3RyaW5nT3JFbXB0eShoYXNNb3JlVGhhbk9uZUxpbmtlZE1hdGVyaWFsKS50cmltKCkuaXNFbXB0eSgpOwogIH0KCiAgLyoqCiAgICogQHJldHVybiB0cnVlIGlmIHRoZXJlIGlzIG1vcmUgdGhhbiBvbmUgbWF0bGluayBidXQgbm9uZSBvZiB0aGVtIGlzIHNpZ25lZAogICAqLwogIHB1YmxpYyBib29sZWFuIGhhc0FtYmlndW91c011bHRpTWF0bGlua3MoKQogIHsKICAgIHJldHVybiAiWCIuZXF1YWxzKGhhc01vcmVUaGFuT25lTGlua2VkTWF0ZXJpYWwpOwogIH0KCiAgLyoqCiAgICogQHJldHVybiB0cnVlIGlmIHRoZXJlIGlzIG1vcmUgdGhhbiBvbmUgbWF0bGluayBhbmQgb25lIG9mIHRoZW0gaXMgc2lnbmVkCiAgICovCiAgcHVibGljIGJvb2xlYW4gaGFzU2lnbmVkTXVsdGlNYXRsaW5rcygpCiAgewogICAgcmV0dXJuICJTIi5lcXVhbHMoaGFzTW9yZVRoYW5PbmVMaW5rZWRNYXRlcmlhbCk7CiAgfQoKICBwdWJsaWMgU3RyaW5nIGdldENvbnZlcnNpb25TdGF0dXMoKQogIHsKICAgIHJldHVybiBjb252ZXJzaW9uU3RhdHVzOwogIH0KCiAgLyoqCiAgICogRnVuY3Rpb24gb25seSBwcm92aWRlZCB0byByZWFkLiBUaGUgY29udHJvbCBvZiB0aGlzIGZpZWxkIGJlbG9uZ3MgdG8gdGhpcwogICAqIGNsYXNzIGFuZCBzaG91bGQgbmV2ZXIgYmUgbW9kaWZpZWQgZnJvbSB0aGUgb3V0c2lkZS4KICAgKi8KICBwdWJsaWMgU3RyaW5nIGdldFVzZXJEZWZpbmVkMSgpCiAgewogICAgcmV0dXJuIHVzZXJEZWZpbmVkMTsKICB9CgogIC8qKgogICAqIEZ1bmN0aW9uIG9ubHkgcHJvdmlkZWQgdG8gcmVhZC4gVGhlIGNvbnRyb2wgb2YgdGhpcyBmaWVsZCBiZWxvbmdzIHRvIHRoaXMKICAgKiBjbGFzcyBhbmQgc2hvdWxkIG5ldmVyIGJlIG1vZGlmaWVkIGZyb20gdGhlIG91dHNpZGUuCiAgICovCiAgcHVibGljIFN0cmluZyBnZXRVc2VyRGVmaW5lZDIoKQogIHsKICAgIHJldHVybiB1c2VyRGVmaW5lZDI7CiAgfQoKICAvKioKICAgKiBGdW5jdGlvbiBvbmx5IHByb3ZpZGVkIHRvIHJlYWQuIFRoZSBjb250cm9sIG9mIHRoaXMgZmllbGQgYmVsb25ncyB0byB0aGlzCiAgICogY2xhc3MgYW5kIHNob3VsZCBuZXZlciBiZSBtb2RpZmllZCBmcm9tIHRoZSBvdXRzaWRlLgogICAqLwogIHB1YmxpYyBTdHJpbmcgZ2V0VXNlckRlZmluZWQzKCkKICB7CiAgICByZXR1cm4gdXNlckRlZmluZWQzOwogIH0KCiAgLyoqCiAgICogVXNlIGdldFVnVHlwZSgpIHRoZSBnZXQgVW5pZ3JhcGhpY3MgcGFydCB0eXBlLiBGdW5jdGlvbiBvbmx5IHByb3ZpZGVkIHRvCiAgICogcmVhZC4gVGhlIGNvbnRyb2wgb2YgdGhpcyBmaWVsZCBiZWxvbmdzIHRvIHRoaXMgY2xhc3MgYW5kIHNob3VsZCBuZXZlciBiZQogICAqIG1vZGlmaWVkIGZyb20gdGhlIG91dHNpZGUuCiAgICovCiAgcHVibGljIFN0cmluZyBnZXRVc2VyRGVmaW5lZDQoKQogIHsKICAgIFN0cmluZyByZXM0ID0gdXNlckRlZmluZWQ0OwoKICAgIGlmICghaGFzQ29udGVudChyZXM0KSkKICAgIHsKICAgICAgLy8gY2hlY2sgaWYgdGhlcmUgYXJlIGRlZmF1bHQgc2V0dGluZ3MgZm9yIHRoZSBkb2N1bWVudCB0eXBlIGluIHRoZQogICAgICAvLyBwcmVmZXJlbmVjZXMKICAgICAgU3RyaW5nIHByZWZfcmVzNCA9IGdldFByZWZlcmVuY2UoInBsbS5jb250cm9sLmVtcHR5LnVzZXJkZWZpbmVkNC4iICsgZ2V0VHlwZSgpLCAicGxtLmNvbnRyb2wuZW1wdHkudXNlcmRlZmluZWQ0LmRlZmF1bHQiKTsKICAgICAgaWYgKGhhc0NvbnRlbnQocHJlZl9yZXM0KSkKICAgICAgICByZXM0ID0gU3RyaW5nVG9vbC50b1VwcGVyQ2FzZShwcmVmX3JlczQpOwogICAgfQogICAgcmV0dXJuIHJlczQ7CiAgfQoKICAvKioKICAgKiBNZXRob2QgaXNWYWxpZFBsbURvY3VtZW50IEVzIHdpcmQgZGFzIFJFUzQsIGRlciBNYXN0ZXIgdW5kIGRlciBTdXB0eXBlCiAgICogZ2VwcnVlZnQsIG9iIG51bGwgb2RlciBsZWVyLgogICAqCiAgICogQHJldHVybiBhIGJvb2xlYW4KICAgKgogICAqLwogIHB1YmxpYyBib29sZWFuIGlzVmFsaWRQbG1Eb2N1bWVudCgpCiAgewogICAgYm9vbGVhbiB2YWxpZCA9IGhhc0NvbnRlbnQoZ2V0VXNlckRlZmluZWQ0KCkpICYmIGhhc0NvbnRlbnQoZ2V0TWFzdGVyKCkpICYmIGhhc0NvbnRlbnQoZ2V0U3VidHlwZSgpKTsKICAgIHJldHVybiB2YWxpZDsKICB9CgogIC8qKgogICAqIGdldCB0aGUgSUQgb2YgdGhlIHJlbGF0ZWQgRFR5cGUgZW50cnkKICAgKgogICAqIEByZXR1cm4gZS5nLiAiRUlOWkUiIG9yICJGRVJUSSIgb3IgIkRSQVciIC4uLgogICAqIEB0aHJvdyBEZWZhdWx0TG9nRXhjZXB0aW9uIEUwMjAwMiAtIFJlczMgbm90IHNldAogICAqIEB0aHJvdyBEZWZhdWx0TG9nRXhjZXB0aW9uIEUwMjAwMyAtIFJlczMgY29udGFpbnMgaW52YWxpZCB2YWx1ZQogICAqLwogIHB1YmxpYyBTdHJpbmcgZ2V0RFR5cGVJZCgpCiAgewogICAgcmV0dXJuIGdldFN1YnR5cGUoKTsKICB9CgogIC8qKgogICAqIFNldCB0aGUgUExNKysgRFR5cGUgRGVmaW5pdGlvbiBJZGVudGlmaWVyLiAobWF4IDUgY2hhcnMpCiAgICovCiAgcHVibGljIHZvaWQgc2V0RFR5cGVJZChTdHJpbmcgaWQpCiAgewogICAgaWYgKGlkLmxlbmd0aCgpIDw9IDUpCiAgICB7CiAgICAgIGluaXRDaGFuZ2VEb2MoKTsKICAgICAgc2V0U3VidHlwZShpZCk7CiAgICB9CiAgfQoKICAvKioKICAgKiBTZXQgaWYgdGhlIERvY3VtZW50IGlzIGEgTWFzdGVyIG1vZGVsIG9yIGEgTm9uIE1hc3RlciBtb2RlbAogICAqCiAgICogQHBhcmFtIGIKICAgKiAgICAgICAgICB0cnVlIGlmIGl0IGlzIGEgbWFzdGVyIG1vZGVsLCBmYWxzZSBpZiBpdCBpcyBhIE5vbiBtYXN0ZXIgbW9kZWwKICAgKgogICAqLwogIHB1YmxpYyB2b2lkIHNldE1hc3Rlcihib29sZWFuIGIpCiAgewogICAgc2V0TWFzdGVyKGIgPyBNQVNURVIgOiBOT05NQVNURVIpOwogIH0KCiAgLyoqCiAgICogU2V0IHRoZSBDYWREZXNrdG9wIGlkZW50aWZpZXIgZGVmaW5pbmcgdGhlIHR5cGUgb2YgdGhlIGRvY3VtZW50LiBlLmcuIFVHUzpQCiAgICogVGhlIGlkIE1VU1QgYmUgaW4gdGhlIGZvcm0gW0EtWl1bQS1aXVtBLVpdOi4qCiAgICovCiAgcHVibGljIHZvaWQgc2V0Q2FkRGVza3RvcElEKFN0cmluZyBpZCkgdGhyb3dzIFBhdHRlcm5TeW50YXhFeGNlcHRpb24KICB7CiAgICBib29sZWFuIG1hdGNoID0gaWQgIT0gbnVsbCAmJiBpZC5tYXRjaGVzKENBRElEUEFUVEVSTik7CiAgICBpZiAobWF0Y2gpCiAgICB7CiAgICAgIHRoaXMudXNlckRlZmluZWQ0ID0gUGxtQ2hhbmdlT2JqZWN0LmdldE5ld1ZhbHVlSWZDaGFuZ2VkKHRoaXMudXNlckRlZmluZWQ0LCBpZCwgdGhpcywgIlVTRVJERUZJTkVENCIpOwogICAgfQogICAgZWxzZQogICAgICBUcmFjZS5wcmludGxuKFRyYWNlLkhFQUQsCiAgICAgICAgICAiUGxtRG9jdW1lbnQuc2V0Q2FkRGVza3RvcElEKCIgKyBpZCArICIpOiB0aGUgZ2l2ZW4gaWQgZG9lcyBub3QgbWF0Y2ggdGhlIHBhdHRlcm4gIiArIENBRElEUEFUVEVSTiArICIgLCBpZ25vcmVkLiIpOwoKICB9CgogIC8qKgogICAqIE1ldGhvZCBjaGFuZ2VDYWREZXNrdG9wSUR0b0Fzc2VtYmx5IG1ha2VzIGEgIlVHUzpBIiBvdXQgb2YgYSAiVUdTOlAiCiAgICovCiAgcHVibGljIHZvaWQgY2hhbmdlQ2FkRGVza3RvcElEdG9Bc3NlbWJseSgpCiAgewogICAgU3RyaW5nIGlkX2Z1bGwgPSBnZXRVc2VyRGVmaW5lZDQoKTsKICAgIGlmIChpZF9mdWxsID09IG51bGwgfHwgIiIuZXF1YWxzKGlkX2Z1bGwpKQogICAgICByZXR1cm47CiAgICAvLyBVR1M6UAogICAgU3RyaW5nIGlkX2VuZCA9IGlkX2Z1bGwuc3Vic3RyaW5nKGlkX2Z1bGwuaW5kZXhPZignOicpKTsKICAgIFN0cmluZyBpZF9zdGFydCA9IGlkX2Z1bGwuc3Vic3RyaW5nKDAsIGlkX2Z1bGwuaW5kZXhPZignOicpKTsKICAgIFN0cmluZyBpZF90ZW1wID0gaWRfZW5kOwogICAgaWRfZW5kID0gaWRfZW5kLnJlcGxhY2UoJ1AnLCAnQScpOwogICAgaWYgKGlkX2VuZC5lcXVhbHMoaWRfdGVtcCkpCiAgICAgIGlkX2VuZCA9IGlkX2VuZCArICJBIjsKICAgIHNldENhZERlc2t0b3BJRChpZF9zdGFydCArIGlkX2VuZCk7CiAgfQoKICAvKioKICAgKiBNZXRob2QgY2hhbmdlQ2FkRGVza3RvcElEdG9QYXJ0IG1ha2VzIGEgIlVHUzpQIiBvdXQgb2YgYSAiVUdTOkEiCiAgICovCiAgcHVibGljIHZvaWQgY2hhbmdlQ2FkRGVza3RvcElEdG9QYXJ0KCkgdGhyb3dzIERlZmF1bHRMb2dFeGNlcHRpb24KICB7CiAgICBTdHJpbmcgaWRfZnVsbCA9IGdldFVzZXJEZWZpbmVkNCgpOwogICAgaWYgKGlkX2Z1bGwgPT0gbnVsbCB8fCAiIi5lcXVhbHMoaWRfZnVsbCkgfHwgaXNEcmF3aW5nKCkpCiAgICAgIHJldHVybjsKICAgIC8vIFVHUzpQCiAgICBTdHJpbmcgaWRfZW5kID0gaWRfZnVsbC5zdWJzdHJpbmcoaWRfZnVsbC5pbmRleE9mKCc6JykpOwogICAgU3RyaW5nIGlkX3N0YXJ0ID0gaWRfZnVsbC5zdWJzdHJpbmcoMCwgaWRfZnVsbC5pbmRleE9mKCc6JykpOwogICAgU3RyaW5nIGlkX3RlbXAgPSBpZF9lbmQ7CiAgICBpZF9lbmQgPSBpZF9lbmQucmVwbGFjZSgnQScsICdQJyk7CiAgICBpZiAoaWRfZW5kLmVxdWFscyhpZF90ZW1wKSkKICAgICAgaWRfZW5kID0gaWRfZW5kICsgIlAiOwogICAgc2V0Q2FkRGVza3RvcElEKGlkX3N0YXJ0ICsgaWRfZW5kKTsKICB9CgogIC8qKgogICAqIG1ha2VzIGEgIlVHUzpQRyIgb3V0IG9mIGEgIlVHUzpQIgogICAqLwogIHB1YmxpYyB2b2lkIGNoYW5nZUNhZERlc2t0b3BJRHRvR2VuZXJpYygpCiAgewogICAgU3RyaW5nIGlkX2Z1bGwgPSBnZXRVc2VyRGVmaW5lZDQoKTsKICAgIGlmIChpZF9mdWxsID09IG51bGwgfHwgIiIuZXF1YWxzKGlkX2Z1bGwpKQogICAgICByZXR1cm47CgogICAgaW50IGluZGV4ID0gaWRfZnVsbC5pbmRleE9mKCc6Jyk7CiAgICBpZiAoaW5kZXggIT0gLTEpCiAgICB7CiAgICAgIFN0cmluZyBpZF9lbmQgPSBpZF9mdWxsLnN1YnN0cmluZyhpbmRleCk7CiAgICAgIFN0cmluZyBpZF9zdGFydCA9IGlkX2Z1bGwuc3Vic3RyaW5nKDAsIGlkX2Z1bGwuaW5kZXhPZignOicpKTsKICAgICAgaWYgKGlkX2VuZC5pbmRleE9mKCdnJykgPT0gLTEgJiYgaWRfZW5kLmluZGV4T2YoJ0cnKSA9PSAtMSkKICAgICAgewogICAgICAgIGlkX2VuZCA9IGlkX2VuZCArICJHIjsKICAgICAgICBzZXRDYWREZXNrdG9wSUQoaWRfc3RhcnQgKyBpZF9lbmQpOwogICAgICB9CiAgICB9CiAgfQoKICAvKioKICAgKiBtYWtlcyBhICJVR1M6UCIgb3V0IG9mIGEgIlVHUzpQRyIKICAgKi8KICBwdWJsaWMgdm9pZCByZW1vdmVHZW5lcmljRnJvbUNhZERlc2t0b3BJRCgpCiAgewogICAgU3RyaW5nIGlkX2Z1bGwgPSBnZXRVc2VyRGVmaW5lZDQoKTsKICAgIGlmIChpZF9mdWxsID09IG51bGwgfHwgIiIuZXF1YWxzKGlkX2Z1bGwpKQogICAgICByZXR1cm47CgogICAgaW50IGluZGV4ID0gaWRfZnVsbC5pbmRleE9mKCc6Jyk7CiAgICBpZiAoaW5kZXggIT0gLTEpCiAgICB7CiAgICAgIFN0cmluZyBpZF9zdGFydCA9IGlkX2Z1bGwuc3Vic3RyaW5nKDAsIGluZGV4KTsKICAgICAgU3RyaW5nIGlkX2VuZCA9IGlkX2Z1bGwuc3Vic3RyaW5nKGluZGV4ICsgMSk7CiAgICAgIGlkX2VuZCA9IGlkX2VuZC5yZXBsYWNlKCdHJywgJyAnKTsKICAgICAgaWRfZW5kID0gaWRfZW5kLnJlcGxhY2UoJ2cnLCAnICcpOwogICAgICBzZXRDYWREZXNrdG9wSUQoaWRfc3RhcnQgKyAiOiIgKyBpZF9lbmQudHJpbSgpKTsKICAgIH0KICB9CgogIC8qKgogICAqIERldGVybWluZSBpZiB0aGUgZG9jdW1lbnQgaXMgYSBtYXN0ZXIgbW9kZWwgb3IgYSBub24gbWFzdGVyIG1vZGVsCiAgICoKICAgKiBAcmV0dXJuIHRydWUgaWYgaXRzIGEgbm9uIG1hc3RlciBtb2RlbCwgZmFsc2UgaWYgaXQgaXMgYSBtYXN0ZXIKICAgKi8KICBwdWJsaWMgYm9vbGVhbiBpc05vbk1hc3RlcigpCiAgewogICAgcmV0dXJuIGlzTm9uTWFzdGVyKGdldE1hc3RlcigpKTsKICB9CgogIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBpc05vbk1hc3RlcihTdHJpbmcgbWFzdGVyRmxhZykKICB7CiAgICByZXR1cm4gTk9OTUFTVEVSLmVxdWFscyhtYXN0ZXJGbGFnKTsKICB9CgogIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBpc01hc3RlcihTdHJpbmcgbWFzdGVyRmxhZykKICB7CiAgICByZXR1cm4gIWlzTm9uTWFzdGVyKG1hc3RlckZsYWcpOwogIH0KCiAgLyoqCiAgICogRGV0ZXJtaW5lIGlmIHRoZSBkb2N1bWVudCBpcyBhIG1hc3RlciBtb2RlbCBvciBhIG5vbiBtYXN0ZXIgbW9kZWwKICAgKgogICAqIEByZXR1cm4gdHJ1ZSBpZiBpdHMgYSBtYXN0ZXIgbW9kZWwsIGZhbHNlIGlmIGl0IGlzIGEgbm9uIG1hc3RlcgogICAqLwogIHB1YmxpYyBib29sZWFuIGlzTWFzdGVyKCkKICB7CiAgICByZXR1cm4gIWlzTm9uTWFzdGVyKCk7CiAgfQoKICAvKioKICAgKiBBbnkgaW5mb3JtYXRpb24gYWJvdXQgdGhlIG9yaWdpbmFscyBhdmFpbGFibGUgZnJvbSB0aGUgQ0hFQ0tFRElOIEZsYWcKICAgKgogICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgdmFsdWUgd2FzIHNldCBhbmQgcGFyc2VkIGNvcnJlY3RseQogICAqLwogIHB1YmxpYyBib29sZWFuIGlzRmxhZ0NoZWNrZWRJbkF2YWlsYWJsZSgpCiAgewogICAgLy8gYXQgbGVhc3QgdGhlIHZhbHVlcyBmb3IgbWFzdGVyIG11c3QgYmUgc2V0ICEKICAgIHJldHVybiBpc01hc3Rlck9yaWdpbmFsRXhpc3QoKSAhPSBudWxsICYmIGlzTWFzdGVyT3JpZ2luYWxDaGVja2Vkb3V0KCkgIT0gbnVsbDsKICB9CgogIC8qKgogICAqIG1ha2Ugc3VyZSB0byBjaGVjayBpc0ZsYWdDaGVja2VkSW5BdmFpbGFibGUoKSBmaXJzdCB0byBzZWUgaWYgdGhlIHZhbHVlIGlzIHZhbGlkCiAgICogQHJldHVybiBib29sZWFuCiAgICovCiAgcHVibGljIGJvb2xlYW4gaXNGbGFnTWFzdGVyT3JpZ2luYWxDaGVja2VkT3V0KCkKICB7CiAgICByZXR1cm4gIjEiLmVxdWFsc0lnbm9yZUNhc2UoaXNNYXN0ZXJPcmlnaW5hbENoZWNrZWRvdXQoKSk7CiAgfQoKICAvKioKICAgKiBtYWtlIHN1cmUgdG8gY2hlY2sgaXNGbGFnQ2hlY2tlZEluQXZhaWxhYmxlKCkgZmlyc3QgdG8gc2VlIGlmIHRoZSB2YWx1ZSBpcyB2YWxpZAogICAqIEByZXR1cm4gYm9vbGVhbgogICAqLwogIHB1YmxpYyBib29sZWFuIGlzRmxhZ0FkZGl0aW9uYWxPcmlnaW5hbENoZWNrZWRPdXQoKQogIHsKICAgIHJldHVybiAiMSIuZXF1YWxzSWdub3JlQ2FzZShpc0FkZE9yaWdpbmFsQ2hlY2tlZG91dCgpKTsKICB9CgogIC8qKgogICAqIG1ha2Ugc3VyZSB0byBjaGVjayBpc0ZsYWdDaGVja2VkSW5BdmFpbGFibGUoKSBmaXJzdCB0byBzZWUgaWYgdGhlIHZhbHVlIGlzIHZhbGlkCiAgICogQHJldHVybiBib29sZWFuCiAgICovCiAgcHVibGljIGJvb2xlYW4gaXNGbGFnTWFzdGVyT3JpZ2luYWxFeGlzdCgpCiAgewogICAgcmV0dXJuICIxIi5lcXVhbHNJZ25vcmVDYXNlKGlzTWFzdGVyT3JpZ2luYWxFeGlzdCgpKTsKICB9CgogIC8qKgogICAqIG1ha2Ugc3VyZSB0byBjaGVjayBpc0ZsYWdDaGVja2VkSW5BdmFpbGFibGUoKSBmaXJzdCB0byBzZWUgaWYgdGhlIHZhbHVlIGlzIHZhbGlkCiAgICogQHJldHVybiBib29sZWFuCiAgICovCiAgcHVibGljIGJvb2xlYW4gaXNGbGFnQWRkaXRpb25hbE9yaWdpbmFsRXhpc3QoKQogIHsKICAgIHJldHVybiAiMSIuZXF1YWxzSWdub3JlQ2FzZShpc0FkZE9yaWdpbmFsRXhpc3QoKSk7CiAgfQoKICAvKioKICAgKiBtYWtlIHN1cmUgdG8gY2hlY2sgaXNGbGFnQ2hlY2tlZEluQXZhaWxhYmxlKCkgZmlyc3QgdG8gc2VlIGlmIHRoZSB2YWx1ZSBpcyB2YWxpZAogICAqIEByZXR1cm4gYm9vbGVhbgogICAqLwogIHB1YmxpYyBib29sZWFuIGlzRmxhZ0FueU9yaWdpbmFsQ2hlY2tlZE91dCgpCiAgewogICAgcmV0dXJuIGlzRmxhZ01hc3Rlck9yaWdpbmFsQ2hlY2tlZE91dCgpIHx8IGlzRmxhZ0FkZGl0aW9uYWxPcmlnaW5hbENoZWNrZWRPdXQoKTsKICB9CgogIC8qKgogICAqIG1ha2Ugc3VyZSB0byBjaGVjayBpc0ZsYWdDaGVja2VkSW5BdmFpbGFibGUoKSBmaXJzdCB0byBzZWUgaWYgdGhlIHZhbHVlIGlzIHZhbGlkCiAgICogQHJldHVybiBib29sZWFuCiAgICovCiAgcHVibGljIGJvb2xlYW4gaXNGbGFnTm9PcmlnaW5hbEF2YWlsYWJsZSgpCiAgewogICAgcmV0dXJuICFpc0ZsYWdNYXN0ZXJPcmlnaW5hbEV4aXN0KCkgJiYgIWlzRmxhZ0FkZGl0aW9uYWxPcmlnaW5hbEV4aXN0KCk7CiAgfQoKICAvKioKICAgKgogICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgc3RhdHVzIGlzIGEgY2hlY2tvdXQgc3RhdHVzLCBmYWxzZSBpZiBub3Qgb3IKICAgKiAgICAgICAgIHByZWZlcmVuY3hlcyBub3Qgc2V0LgogICAqLwogIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBpc0NoZWNrb3V0U3RhdHVzKFN0cmluZyBzdGF0dXMsIFN0cmluZyB0eXBlKQogIHsKICAgIGJvb2xlYW4gcmV0ID0gZmFsc2U7CiAgICBQbG1TdGF0dXNDb250YWluZXIgcG9zX3N0YXR1cyA9IFBsbVN0YXR1c1Rvb2wuZ2V0RG9jU3RhdHVzKHR5cGUsIHN0YXR1cyk7CgogICAgaWYgKHBvc19zdGF0dXMgPT0gbnVsbCkKICAgICAgcmV0ID0gZmFsc2U7CiAgICBlbHNlCiAgICAgIHJldCA9IHBvc19zdGF0dXMuaXNDaGVja291dFN0YXR1cygpOwoKICAgIHJldHVybiByZXQ7CiAgfQoKICAvKioKICAgKiB3b3JrcyBhY2NvcmRpbmcgdG8gdGhlIHJ1bGVzIGRlZmluZWQgaGVyZTogaHR0cDovL3dpa2kuZHNjLm5ldC9pbmRleC5waHAvRUNUUl9TQVBfU3RhdHVza29uemVwdAogICAqIGl0IG1lYW5zOiByZXR1cm5zIHRydWUgaWYgMS4gdGhlIHN0YXR1cyBpdHNlbGYgaXMgY2hlY2tvdXQgc3RhdHVzIChoYXMgIk8iIGZsYWcpIE9SIDIuIG9uZSBvZiBjaGlsZCBzdGF0dXMgaXMgYSBjaGVja291dCBzdGF0dXMuCiAgICovCiAgcHVibGljIGJvb2xlYW4gaXNBbGxvd2VkVG9DaGVja091dEVkaXQoKQogIHsKICAgIGJvb2xlYW4gcmV0ID0gaXNBbGxvd2VkVG9DaGVja091dEVkaXQoZ2V0U3RhdHVzKCksIGdldFR5cGUoKSk7CiAgICBpZiAoIXJldCkKICAgIHsKICAgICAgLy9mYWxsYmFjazogY2hlY2sgZHR5cGUgc2V0dGluZ3MsIG1heSBiZSB0aGlzIHN0YXR1cyBpcyBhbGxvd2VkIGZvciBjaGVja291dCB0aGVyZSEKICAgICAgdHJ5CiAgICAgIHsKICAgICAgICBEVHlwZSBkdHlwZSA9IERUeXBlQ29udGFpbmVyLmdldEluc3QoKS5nZXREVHlwZShnZXREVHlwZUlkKCkpOwogICAgICAgIGlmICghZHR5cGUuaXNSZXF1aXJlU3RhdHVzV2l0aE9GbGFnKCkpCiAgICAgICAgewogICAgICAgICAgcmV0ID0gZHR5cGUuZ2V0Q2hlY2tvdXRDaGFuZ2VTdGF0dXNNYXAoKS52YWx1ZXMoKS5jb250YWlucyhnZXRTdGF0dXMoKSk7CiAgICAgICAgICBpZiAoIXJldCkKICAgICAgICAgIHsKICAgICAgICAgICAgLy9kYXMgaXN0IGFsc28gc2VsYnN0IG5pY2h0IGRlciBjaGVja291dCBzdGF0dXMuCiAgICAgICAgICAgIC8vZGFubiBtdWVzc2VuIHdpciBzY2hhdWVuLCBvYiB3aXIgYXVzIGRpZXNlbSBzdGF0dXMgaW4gZWluZW4gY2hlY2tvdXQgc3RhdHVzIGtvbW1lbgogICAgICAgICAgICAvL2tvZW5uZW4gLSBkLmguIGluIGRlbSBmYWxsLCBvYiBlcyBpbiBkdHlwZSBlaW4gcGFzc2VuZGVyIHN0YXR1c3VlYmVyZ2FuZyBhbmdlZ2ViZW4gaXN0CiAgICAgICAgICAgIHJldCA9IGR0eXBlLmdldENoZWNrb3V0Q2hhbmdlU3RhdHVzTWFwKCkua2V5U2V0KCkuY29udGFpbnMoZ2V0U3RhdHVzKCkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBjYXRjaCAoRGVmYXVsdExvZ0V4Y2VwdGlvbiBkbGUpCiAgICAgIHsKICAgICAgICBUcmFjZS5wcmludGxuKFRyYWNlLkRFQlVHLCAiUGxtRG9jdW1lbnQoIiArIHRvU3RyaW5nKCkgKyAiKTogY2FuJ3QgZGV0ZXJtaW5lIGR0eXBlIGZvciBpZCAnIiArIGdldERUeXBlSWQoKSArICInIik7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXQ7CiAgfQoKICAvKioKICAgKiB3b3JrcyBhY2NvcmRpbmcgdG8gdGhlIHJ1bGVzIGRlZmluZWQgaGVyZTogaHR0cDovL3dpa2kuZHNjLm5ldC9pbmRleC5waHAvRUNUUl9TQVBfU3RhdHVza29uemVwdAogICAqIGl0IG1lYW5zOiByZXR1cm5zIHRydWUgaWYgMS4gdGhlIHN0YXR1cyBpdHNlbGYgaXMgY2hlY2tvdXQgc3RhdHVzIChoYXMgIk8iIGZsYWcpIE9SIDIuIG9uZSBvZiBjaGlsZCBzdGF0dXMgaXMgYSBjaGVja291dCBzdGF0dXMuCiAgICovCiAgcHVibGljIHN0YXRpYyBib29sZWFuIGlzQWxsb3dlZFRvQ2hlY2tPdXRFZGl0KFN0cmluZyBzdGF0dXMsIFN0cmluZyB0eXBlKQogIHsKICAgIGJvb2xlYW4gYWxsb3dlZCA9IGZhbHNlOwogICAgaWYgKFN0cmluZ1Rvb2wuaGFzQ29udGVudChzdGF0dXMpKQogICAgewogICAgICBQbG1TdGF0dXNDb250YWluZXIgcHNjID0gUGxtU3RhdHVzVG9vbC5nZXREb2NTdGF0dXModHlwZSwgc3RhdHVzKTsKICAgICAgaWYgKHBzYyA9PSBudWxsKQogICAgICB7CiAgICAgICAgVHJhY2UucHJpbnRsbihUcmFjZS5ERUJVRywgImlzQWxsb3dlZFRvQ2hlY2tPdXRFZGl0OiB1bmtub3duIHN0YXR1cy90eXBlOiAnIiArIHN0YXR1cyArICIvIiArIHR5cGUgKyAiJyIpOwogICAgICAgIGFsbG93ZWQgPSB0cnVlOyAvL3d0IC0gaWYgdGhlIGRvY3VtZW50IHR5cGUgaGFzIG5vIHN0YXR1cyBhc3NpZ25lZCwgdGhlbiB0aGVyZSBpcyBubyByZWFzb24gdG8gcHJldmVudCBjaGVja291dC4KICAgICAgfQogICAgICBlbHNlCiAgICAgICAgYWxsb3dlZCA9IHBzYy5pc0NoZWNrb3V0QWxsb3dlZCgpOwogICAgfQogICAgZWxzZQogICAgICBhbGxvd2VkID0gdHJ1ZTsKCiAgICByZXR1cm4gYWxsb3dlZDsKICB9CgogIC8qKgogICAqIEdldCB0aGUgbGFzdCBtb2RpZmllZCB0aW1lIGZyb20gdGhlIGRvY3VtZW50LiBUbyBkZXRlcm1pbmUgdGhpcyB0aW1lLCB0aGUKICAgKiBVc2VyZGVmaW5lZDIgZmllbGQgaXMgcmVhZCBhbmQgdGhlIHZhbHVlIChpdHMgaW4gZm9ybSB5eXl5TU1kZEhIU1MpIGlzCiAgICogcmVwYXJzZWQgdG8gYSB2YWxpZCBsb25nIHZhbHVlIHdpdGggdGhlIERhdGVUb29sIHV0aWxpdHkuCiAgICoKICAgKiBAcmV0dXJuIGxvbmcgbGFzdCBtb2RpZmllZCBkYXRlIGluIG1pbGxpc2Vjb25kcyBzaW5jZSAxOTcwIG9yIC0xIGlmCiAgICogICAgICAgICB1c2VyZGVmaW5lZDIgbm90IHNldAogICAqLwogIHB1YmxpYyBsb25nIGxhc3RNb2RpZmllZCgpCiAgewogICAgbG9uZyBsYXN0X21vZCA9IC0xOwoKICAgIERhdGUgZGF0ZSA9IGdldExhc3RNb2RpZmllZERhdGUoKTsKICAgIGlmIChkYXRlICE9IG51bGwpCiAgICAgIGxhc3RfbW9kID0gZGF0ZS5nZXRUaW1lKCk7CgogICAgcmV0dXJuIGxhc3RfbW9kOwogIH0KCiAgLyoqCiAgICogTWV0aG9kIGlzQXNzZW1ibHkKICAgKgogICAqLwogIHB1YmxpYyBib29sZWFuIGlzQXNzZW1ibHkoKQogIHsKICAgIFN0cmluZyBvYmpfdHlwZSA9IGdldFVzZXJEZWZpbmVkNE9iamVjdFR5cGUoKTsKICAgIHJldHVybiBvYmpfdHlwZS5pbmRleE9mKCdBJykgIT0gLTE7CiAgfQoKICBwdWJsaWMgYm9vbGVhbiBpc05vcm1Eb2N1bWVudCgpCiAgewogICAgU3RyaW5nIG9ial90eXBlID0gZ2V0VXNlckRlZmluZWQ0T2JqZWN0VHlwZSgpOwogICAgcmV0dXJuIG9ial90eXBlLmluZGV4T2YoJ04nKSAhPSAtMTsKICB9CgogIC8qKgogICAqIENoZWNrIGlmIGRvY3VtZW50IGlzIGEgZHJhd2luZyAoUmVzMzpOLCBSZXM0OkQpCiAgICoKICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGRvY3VtZW50IGlzIGEgZHJhd2luZwogICAqLwogIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBpc0RyYXdpbmcoU3RyaW5nIG1hc3RlckZsYWcsIFN0cmluZyByZXM0KSB0aHJvd3MgRGVmYXVsdExvZ0V4Y2VwdGlvbgogIHsKICAgIGlmIChpc05vbk1hc3RlcihtYXN0ZXJGbGFnKSkKICAgIHsKICAgICAgLy8gYSBkcmF3aW5nIGlzIGRlZmluZWQgYnkgcmVzMyArIHJlczQuCiAgICAgIC8vIFJlczM9RUlOWkU6TiBvciBSZXMzPUVJTlpFOk0KICAgICAgLy8gUmVzND1VR1M6RCBvciBSZXM0PVVHUzpQCiAgICAgIC8vIC0tPiBhIGRyYXdpbmcgLS0+IGEgbWFzdGVybW9kZWwKCiAgICAgIGludCBpbmRleCA9IHJlczQuaW5kZXhPZigiOiIpOwogICAgICBpZiAoaW5kZXggPiAtMSkKICAgICAgewogICAgICAgIFN0cmluZyBmbGFnID0gcmVzNC5zdWJzdHJpbmcoaW5kZXggKyAxKTsKICAgICAgICByZXR1cm4gZmxhZy5lcXVhbHNJZ25vcmVDYXNlKERSQVdJTkcpOwogICAgICB9CiAgICAgIGVsc2UKICAgICAgICB0aHJvdyBuZXcgRGVmYXVsdExvZ0V4Y2VwdGlvbigiRTEwMjA1IiwgIlVzZXJkZWZpbmVkNCBmaWVsZCBub3Qgc2V0LiBDYW4ndCBkZXRlcm1pbmUgaWYgZG9jdW1lbnQgaXMgYSBkcmF3aW5nIG9yIG5vdC4iKTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CgogIC8qKgogICAqIENoZWNrIGlmIGRvY3VtZW50IGlzIGEgZHJhd2luZyAoUmVzMzpOLCBSZXM0OkQpCiAgICoKICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGRvY3VtZW50IGlzIGEgZHJhd2luZwogICAqIEB0aHJvdyBEZWZhdWx0TG9nRXhjZXB0aW9uIEUxMDIwMCAtIFJlczMgbm90IHNldAogICAqIEB0aHJvdyBEZWZhdWx0TG9nRXhjZXB0aW9uIEUxMDIwMSAtIFJlczMgY29udGFpbnMgaW52YWxpZCB2YWx1ZQogICAqIEB0aHJvdyBEZWZhdWx0TG9nRXhjZXB0aW9uIEUxMDIwNSAtIFJlczQgbm90IHNldAogICAqLwogIHB1YmxpYyBib29sZWFuIGlzRHJhd2luZygpIHRocm93cyBEZWZhdWx0TG9nRXhjZXB0aW9uCiAgewogICAgcmV0dXJuIChpc0RyYXdpbmcoZ2V0TWFzdGVyKCksIGdldFVzZXJEZWZpbmVkNCgpKSk7CiAgfQoKICAvKioKICAgKiBDaGVjayBpZiBkb2N1bWVudCBpcyBhIGZhbWlseSBtZW1iZXIgKFVzZXJkZWZpbmVkNDogQUkgb3IgUEkpCiAgICoKICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGRvY3VtZW50IGlzIGEgcGFydCBmYW1pbHkgbWVtYmVyCiAgICovCiAgcHVibGljIGJvb2xlYW4gaXNGYW1pbHlNZW1iZXIoKQogIHsKICAgIHJldHVybiBpc0ZhbWlseU1lbWJlcihnZXRVc2VyRGVmaW5lZDQoKSk7CiAgfQoKICAvKioKICAgKiBDaGVjayBpZiBkb2N1bWVudCBpcyBhIGZhbWlseSBtZW1iZXIgKFVzZXJkZWZpbmVkNDogQUkgb3IgUEkpCiAgICoKICAgKiBAcGFyYW0gcmVzNCAtCiAgICogICAgICAgICAgdGhlIGRvY3VtZW50J3MgdXNlcmRlZmluZWQ0IGZpZWxkCiAgICogQHJldHVybiB0cnVlIGlmIGRvY3VtZW50IGlzIGEgcGFydCBmYW1pbHkgbWVtYmVyCiAgICovCiAgcHVibGljIHN0YXRpYyBib29sZWFuIGlzRmFtaWx5TWVtYmVyKFN0cmluZyByZXM0KQogIHsKICAgIGJvb2xlYW4gcmVzdWx0ID0gZmFsc2U7CgogICAgdHJ5CiAgICB7CiAgICAgIGludCBpbmRleCA9IHJlczQuaW5kZXhPZigiOiIpOwogICAgICBTdHJpbmcgcmVzNG9ial90eXBlID0gcmVzNC5zdWJzdHJpbmcoaW5kZXggKyAxKTsKCiAgICAgIGlmIChyZXM0b2JqX3R5cGUuaW5kZXhPZihGQU1JTFlfSU5TVEFOQ0UpID4gLTEpCiAgICAgIHsKICAgICAgICAvLyB3ZSBoYXZlIGEgZmFtaWx5IG1lbWJlciBpbiBhbnkgZm9ybQogICAgICAgIHJlc3VsdCA9IHRydWU7CiAgICAgIH0KICAgIH0KICAgIGNhdGNoIChFeGNlcHRpb24gZSkKICAgIHsKICAgICAgLy8gdGhlIHJlczQgZmllbGQgd2FzIG51bGwgb3Igbm90IHZhbGlkIChubyAnOicpCiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogUmV0dXJucyB0cnVlIGlmIHRoaXMgZG9jdW1lbnQgaXMgYSBmYW1pbHkgdGVtcGxhdGUKICAgKgogICAqIEByZXR1cm4gdHJ1ZSBpZiBpdCBpcyBhIGZhbWlseSB0ZW1wbGF0ZQogICAqLwogIHB1YmxpYyBib29sZWFuIGlzRmFtaWx5VGVtcGxhdGUoKQogIHsKICAgIHJldHVybiBpc0ZhbWlseVRlbXBsYXRlKGdldE1hc3RlcigpLCBnZXRVc2VyRGVmaW5lZDQoKSk7CiAgfQoKICAvKioKICAgKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBkb2N1bWVudCBpcyBhIGZhbWlseSB0ZW1wbGF0ZQogICAqCiAgICogQHJldHVybiB0cnVlIGlmIGl0IGlzIGEgRmFtaWx5IFRlbXBsYXRlCiAgICovCiAgcHVibGljIHN0YXRpYyBib29sZWFuIGlzRmFtaWx5VGVtcGxhdGUoU3RyaW5nIG1hc3RlckZsYWcsIFN0cmluZyByZXM0KQogIHsKICAgIGJvb2xlYW4gaXNGYW1pbHlUZW1wbGF0ZSA9IGZhbHNlOwogICAgdHJ5CiAgICB7CiAgICAgIGlmIChyZXM0ICE9IG51bGwpCiAgICAgIHsKICAgICAgICAvLyBpbnQgaW5kZXggPSByZXMzLmluZGV4T2YoIjoiKTsKICAgICAgICBpbnQgaW5kZXgyID0gcmVzNC5pbmRleE9mKCI6Iik7CgogICAgICAgIC8vIFN0cmluZyByb2xlID0gcmVzMy5zdWJzdHJpbmcoaW5kZXgrMSk7CiAgICAgICAgU3RyaW5nIHJlczRvYmpfdHlwZSA9IHJlczQuc3Vic3RyaW5nKGluZGV4MiArIDEpOwoKICAgICAgICBpZiAoaXNNYXN0ZXIobWFzdGVyRmxhZykpCiAgICAgICAgICBpc0ZhbWlseVRlbXBsYXRlID0gcmVzNG9ial90eXBlLmluZGV4T2YoRkFNSUxZX0dFTkVSSUMpID4gLTE7CiAgICAgIH0KICAgIH0KICAgIGNhdGNoIChFeGNlcHRpb24gZSkKICAgIHsKICAgICAgLy8gb25lIG9mIHRoZSByZXMgZmllbGRzIHdhcyBudWxsIG9yIG5vdCB2YWxpZCAobm8gJzonKQogICAgICBUcmFjZS5wcmludGxuU3RhY2tUcmFjZShUcmFjZS5ERUJVRywgZSk7CiAgICB9CiAgICByZXR1cm4gaXNGYW1pbHlUZW1wbGF0ZTsKICB9CgogIHB1YmxpYyB2b2lkIHNldExpbmtlZE1hdGVyaWFsQWxsb2NzSW5zdGFuY2UoUGxtTWF0ZXJpYWwgbWF0KQogIHsKICAgIHRoaXMubGlua2VkTWF0SW5zdGFuY2UgPSBtYXQ7CiAgfQoKICBwdWJsaWMgUGxtTWF0ZXJpYWwgZ2V0TGlua2VkTWF0ZXJpYWxBbGxvY3NJbnN0YW5jZSgpCiAgewogICAgcmV0dXJuIHRoaXMubGlua2VkTWF0SW5zdGFuY2U7CiAgfQoKICAvKioKICAgKiBAcmV0dXJuIFBsbURvY3VtZW50IGxhdGVzdCBQbG1Eb2N1bWVudCBhY2NvcmRpbmcgdG8gUGxtVmVyc2lvblRvb2wsIG51bGwgaWYKICAgKiAgICAgICAgIGRvY3VtZW50IGRvZXMgbm90IGV4aXN0cyBpbiBTQVAKICAgKi8KICBwdWJsaWMgUGxtRG9jdW1lbnQgYWN0dWFsVmVyc2lvbigpIHRocm93cyBEZWZhdWx0TG9nRXhjZXB0aW9uCiAgewogICAgaWYgKGV4aXN0c0luU2FwKQogICAgewogICAgICB0cnkKICAgICAgewogICAgICAgIFN0cmluZyBsYXRlc3QgPSBQbG1WZXJzaW9uVG9vbC5nZXRJbnN0YW5jZSgpLmdldExhdGVzdFZlcnNpb24odGhpcyk7CiAgICAgICAgUGxtRG9jdW1lbnQgbGF0ZXN0X2RvYyA9IG5ldyBQbG1Eb2N1bWVudCh0eXBlLCBudW1iZXIsIGxhdGVzdCwgcGFydCk7CiAgICAgICAgbGF0ZXN0X2RvYy5zZXRFeGlzdHNJblNhcCh0cnVlKTsKICAgICAgICByZXR1cm4gbGF0ZXN0X2RvYzsKICAgICAgfQogICAgICBjYXRjaCAoRGVmYXVsdExvZ0V4Y2VwdGlvbiBkbGUpCiAgICAgIHsKICAgICAgICB0aHJvdyBuZXcgRGVmYXVsdExvZ0V4Y2VwdGlvbihEaWMuZ2V0VGV4dCgiRTAxNzUwIiwgIkxhdGVzdCB2ZXJzaW9uIGNvdWxkIG5vdCBiZSBkZXRlcm1pbmVkLiIpLCBkbGUpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CgogIC8qKgogICAqIE1ldGhvZCBnZXRWV2hlcmVVc2VkIFJldHVybnMgdGhlIHdoZXJldXNlZCBsaXN0IG9mIHRoaXMgZG9jdW1lbnQKICAgKgogICAqIEByZXR1cm4gYSBWZWN0b3Igb2YgUGxtRG9jdW1lbnRzCiAgICoKICAgKi8KICBwdWJsaWMgTGlzdDxQbG1XaGVyZXVzZWREb2N1bWVudD4gZ2V0V2hlcmVVc2VkKCkKICB7CiAgICBpZiAodldoZXJlVXNlZCA9PSBudWxsKQogICAgICB2V2hlcmVVc2VkID0gbmV3IEFycmF5TGlzdDxQbG1XaGVyZXVzZWREb2N1bWVudD4oKTsKICAgIHJldHVybiB2V2hlcmVVc2VkOwogIH0KCiAgLyoqCiAgICogTWV0aG9kIGFkZFdoZXJlVXNlZAogICAqIGFkZHMgYSB3aGVyZXVzZWQgZG9jdW1lbnQgdG8gdGhlIHdoZXJldXNlZCBsaXN0IG9mIHRoaXMgZG9jdW1lbnQKICAgKgogICAqLwogIHByb3RlY3RlZCB2b2lkIGFkZFdoZXJlVXNlZChQbG1XaGVyZXVzZWREb2N1bWVudCB1c2VkX2RvYykKICB7CiAgICBpZiAodldoZXJlVXNlZCA9PSBudWxsKQogICAgICB2V2hlcmVVc2VkID0gbmV3IEFycmF5TGlzdDxQbG1XaGVyZXVzZWREb2N1bWVudD4oKTsKICAgIHZXaGVyZVVzZWQuYWRkKHVzZWRfZG9jKTsKICB9CgogIC8qKgogICAqIE1ldGhvZCBnZXRNYXN0ZXJNb2RlbGwgTWFrZXMgYSBTdHJ1Y3R1cmVFeHBsb2RlIHRvIGdldCBhbGwgcmVmZXJlbmNlZAogICAqIERvY3VtZW50cyBFcyBrYW5uIGxhdXQgRGF0ZW5tb2RlbGwgbnVyIEVJTiBNYXN0ZXJtb2RlbGwgenUgZWluZW0gTm9ubWFzdGVyCiAgICogZ2ViZW4uIERhcyBpc3QgZWluZSAxIC0gbiBCZXppZWh1bmcgdW5kIGtlaW5lIG4gLSBuIEJlemllaHVuZy4gV2VubiBlaW4KICAgKiBOb25tYXN0ZXIgbm9jaCBlaW4gIk1hc3Rlcm1vZGVsbCIgaW4gc2VpbmVyIFN0dWVja2xpc3RlIGhhdCwgZGFzIGFiZXIgaW0KICAgKiBTb3J0c3RyaW5nIGtlaW4gIkQiIGhhdCwgaXN0IGRhcyB6LkIuIFVtZ2VidW5nc2dlb21ldHJpZSB1bmQgbmljaHQgbm9jaCBlaW4KICAgKiBNYXN0ZXJtb2RlbGwhCiAgICoKICAgKiBAcmV0dXJuIHRoZSBQbG1Eb2N1bWVudCwgbWF0Y2hpbmcgdG8gVEhJUyBub25tYXN0ZXIhIQogICAqCiAgICogQHRocm93cyBEZWZhdWx0TG9nRXhjZXB0aW9uCiAgICoKICAgKi8KICBwdWJsaWMgUGxtRG9jdW1lbnQgZ2V0TWFzdGVyTW9kZWwoKSB0aHJvd3MgRGVmYXVsdExvZ0V4Y2VwdGlvbgogIHsKICAgIENvbGxlY3Rpb248UGxtRG9jdW1lbnQ+IGNfbWFzdGVyID0gZ2V0TWFzdGVyTW9kZWwoZmFsc2UpOwogICAgUGxtRG9jdW1lbnQgZm1hc3RlciA9IG51bGw7CiAgICBpZiAoaGFzSXRlbXMoY19tYXN0ZXIpKQogICAgewogICAgICBJdGVyYXRvcjxQbG1Eb2N1bWVudD4gaXRlciA9IGNfbWFzdGVyLml0ZXJhdG9yKCk7CiAgICAgIHdoaWxlIChpdGVyLmhhc05leHQoKSkKICAgICAgewogICAgICAgIGZtYXN0ZXIgPSBpdGVyLm5leHQoKTsKICAgICAgfQogICAgICByZXR1cm4gZm1hc3RlcjsKICAgIH0KICAgIGVsc2UKICAgICAgcmV0dXJuIG51bGw7CiAgfQoKICAvKioKICAgKgogICAqIEBwYXJhbSBnZXRBbGxNYXN0ZXJzCiAgICogICAgICAgICAgYSBib29sZWFuIC0gYmVpIHRydWUgd2VyZGVuIGF1Y2ggZGllIE1hc3RlcnMgZGVyCiAgICogICAgICAgICAgVW1nZWJ1bmdzZ2VvbWV0cmllIHp1cvxja2dlZ2ViZW4sIGRpZSBLRUlOICJEIiBpbSBTb3J0aWVyZmVsZAogICAqICAgICAgICAgIGhhYmVuLgogICAqCiAgICogQHJldHVybiBhIFBsbURvY3VtZW50CiAgICoKICAgKiBAZXhjZXB0aW9uIERlZmF1bHRMb2dFeGNlcHRpb24KICAgKgogICAqLwogIHB1YmxpYyBDb2xsZWN0aW9uPFBsbURvY3VtZW50PiBnZXRNYXN0ZXJNb2RlbChib29sZWFuIGdldEFsbE1hc3RlcnMpIHRocm93cyBEZWZhdWx0TG9nRXhjZXB0aW9uCiAgewogICAgaWYgKHRoaXMuaXNOb25NYXN0ZXIoKSkKICAgIHsKICAgICAgVmVjdG9yPFBsbURvY3VtZW50PiB2X21hc3RlcnMgPSBuZXcgVmVjdG9yPFBsbURvY3VtZW50PigpOwogICAgICAvLyByZWFkIHRoZSBEb2N1bWVudHN0cnVjdHVyZSBzYXZlZCBpbiBTQVAKICAgICAgUHJvY2Vzc0RvY1N0cnVjdHVyZUV4cGxvZGU0IHByb2MgPSBuZXcgUHJvY2Vzc0RvY1N0cnVjdHVyZUV4cGxvZGU0KCk7CiAgICAgIERhdGFDb250YWluZXIgZGMgPSBuZXcgRGF0YUNvbnRhaW5lcigpOwogICAgICBkYy5hZGRPYmplY3QoUHJvY2Vzc0RvY1N0cnVjdHVyZUV4cGxvZGU0LklOT1VUX1BMTV9ET0NVTUVOVCwgdGhpcyk7CiAgICAgIGRjLmFkZEJvb2woUHJvY2Vzc0RvY1N0cnVjdHVyZUV4cGxvZGU0LklOX1NFQVJDSF9NQUlOX0RPQywgZmFsc2UpOwogICAgICBkYy5hZGRPYmplY3QoUHJvY2Vzc0RvY1N0cnVjdHVyZUV4cGxvZGU0LklOX0xPQURPUFQsIFBsbUNvbnN0YW50cy5MT0FEX09QVF9BU19TQVZFRCk7CiAgICAgIGRjLmFkZEJvb2woUHJvY2Vzc0RvY1N0cnVjdHVyZUV4cGxvZGU0LklOX01VTFRJTEVWRUxfRVhQTCwgZmFsc2UpOwogICAgICBkYy5hZGRPYmplY3QoUHJvY2Vzc0RvY1N0cnVjdHVyZUV4cGxvZGU0LklOX0VYUExPU0lPTl9TQ0VOQVJJTywgIiIpOwogICAgICBwcm9jLnNldERhdGEoZGMpOwogICAgICBwcm9jLmV4ZWN1dGUoKTsKICAgICAgUGxtRG9jU3RydWN0dXJlIHBsbV9kb2Nfc3RydWMgPSB0aGlzLmdldERvY1N0cnVjdHVyZSgpOwogICAgICBpZiAocGxtX2RvY19zdHJ1YyAhPSBudWxsICYmICFwbG1fZG9jX3N0cnVjLmlzRW1wdHkoKSkKICAgICAgewogICAgICAgIENvbGxlY3Rpb248UGxtRG9jdW1lbnQ+IHZfZG9jc193X2RldGFpbCA9IGRjLmdldE9iamVjdChQcm9jZXNzRG9jU3RydWN0dXJlRXhwbG9kZTQuT1VUX0FMTF9ET0NVTUVOVFMpOwogICAgICAgIFBsbURvY3VtZW50Q29udGFpbmVyIHBkY19kZXRhaWwgPSBuZXcgUGxtRG9jdW1lbnRDb250YWluZXIodl9kb2NzX3dfZGV0YWlsKTsKCiAgICAgICAgSXRlcmF0b3I8UGxtRG9jQm9tSXRlbT4gaXRlciA9IHBsbV9kb2Nfc3RydWMuZ2V0UGxtRG9jQm9tSXRlbXMoKS5pdGVyYXRvcigpOwogICAgICAgIHdoaWxlIChpdGVyLmhhc05leHQoKSkKICAgICAgICB7CiAgICAgICAgICBQbG1Eb2NCb21JdGVtIGVsZW1lbnQgPSBpdGVyLm5leHQoKTsKICAgICAgICAgIC8vIERhcyB6dSBkaWVzZXIgRHJhd2luZyBnZWj2cmVuZGUgTWFzdGVyTW9kZWxsIG11c3Mgdm9tIFR5cAogICAgICAgICAgLy8gTWF0ZXJtb2RlbGwgc2VpbiEKICAgICAgICAgIC8vIGdldCB0aGUgZG9jdW1lbnQgd2l0aCBkZXRhaWxzIHJldHVybmVkIGZyb20gdGhlIHN0cnVjdHVyZSBleHBsb2RlCiAgICAgICAgICAvLyBwcm9jZXNzCiAgICAgICAgICBQbG1Eb2N1bWVudCBkb2MgPSBlbGVtZW50LmdldERvY3VtZW50KCk7CiAgICAgICAgICBQbG1Eb2N1bWVudCBkb2NfZCA9IHBkY19kZXRhaWwuZ2V0RG9jdW1lbnQoZG9jLmdldFNhcEtleSgpKTsKICAgICAgICAgIGlmIChkb2NfZCAhPSBudWxsKQogICAgICAgICAgICBkb2MgPSBkb2NfZDsKCiAgICAgICAgICBpZiAoZG9jLmlzTWFzdGVyKCkpCiAgICAgICAgICB7CiAgICAgICAgICAgIFN0cmluZyBzb3J0U3RyaW5nID0gZWxlbWVudC5nZXRTb3J0U3RyaW5nKCk7CiAgICAgICAgICAgIGlmIChzb3J0U3RyaW5nICE9IG51bGwpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAvLyB3aXIgbfxzc2VuIGRlbiBTb3J0c3RyaW5nIHBy/GZlbiB1bmQgendhciBuYWNoIGRlbSBVR1M6CiAgICAgICAgICAgICAgaW50IGluZGV4ID0gc29ydFN0cmluZy5pbmRleE9mKCI6Iik7CiAgICAgICAgICAgICAgaWYgKGluZGV4ID4gLTEpCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKFBsbURvY0JvbUl0ZW0uaXNNYXN0ZXIoc29ydFN0cmluZykpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIHZfbWFzdGVycy5pbnNlcnRFbGVtZW50QXQoZG9jX2QsIDApOwogICAgICAgICAgICAgICAgICBpZiAoIWdldEFsbE1hc3RlcnMpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZfbWFzdGVyczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGdldEFsbE1hc3RlcnMpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIHZfbWFzdGVycy5hZGQoZG9jX2QpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdl9tYXN0ZXJzOwogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgZWxzZQogICAgICByZXR1cm4gbnVsbDsKICB9CgogIC8qKgogICAqIE1ldGhvZCBnZXROb25NYXN0ZXJzIENoZWNrIGlmIHRoaXMgaXMgYSBtYXN0ZXIuIFRoZW4gZ2V0cyB0aGUgV2hlcmUgVXNlZAogICAqIExpc3QgYW5kIGZpbHRlciBvdXQgYWxsIGRvY3VtZW50cyB3aGljaCBhcmVuJ3Qgbm9ubWFzdGVycyAobGlrZSBhc3NlbWJseQogICAqIHBhcmVudHMsIGxhc3QgdXNlZCBkb2N1bWVudHMsIC4uLikKICAgKgogICAqIEByZXR1cm4gYSBDb2xsZWN0aW9uIG9mIFBsbURvY3VtZW50cwogICAqCiAgICovCiAgcHVibGljIEBOb25udWxsIENvbGxlY3Rpb248UGxtV2hlcmV1c2VkRG9jdW1lbnQ+IGdldE5vbk1hc3RlcnMoKQogIHsKICAgIFZlY3RvcjxQbG1XaGVyZXVzZWREb2N1bWVudD4gdl9yZXQgPSBuZXcgVmVjdG9yPFBsbVdoZXJldXNlZERvY3VtZW50PigpOwogICAgVHJhY2UucHJpbnRsbihUcmFjZS5ERUJVRywgIiAgZ2V0Tm9uTWFzdGVycygpIE1hc3RlciA8IiArIHRoaXMudG9TdHJpbmcoKSArICI+Iik7CgogICAgLy8gZ2V0IGFsbCB3aGVyZSB1c2VkIGRvY3VtZW50cwogICAgTGlzdDxQbG1XaGVyZXVzZWREb2N1bWVudD4gdl93aGVyZV91c2VkID0gdGhpcy5nZXRXaGVyZVVzZWQoKTsKICAgIGZvciAoUGxtV2hlcmV1c2VkRG9jdW1lbnQgcGxtZF93aGVyZV91c2VkIDogdl93aGVyZV91c2VkKQogICAgewogICAgICBpZiAocGxtZF93aGVyZV91c2VkLmlzTm9ubWFzdGVyUmVsYXRpb24oKSkKICAgICAgewogICAgICAgIHZfcmV0LmFkZChwbG1kX3doZXJlX3VzZWQpOwogICAgICAgIFRyYWNlLnByaW50bG4oVHJhY2UuREVCVUcsCiAgICAgICAgICAgICIgICBnZXROb25NYXN0ZXJzKCkgTm9ubWFzdGVyIDwiICsgcGxtZF93aGVyZV91c2VkLnRvU3RyaW5nKCkgKyAiPiBTb3J0c3RyOiA8IiArIHBsbWRfd2hlcmVfdXNlZC5nZXRTb3J0U3RyaW5nKCkgKyAiPiIpOwogICAgICB9CiAgICB9IC8vIGZvcgogICAgcmV0dXJuIHZfcmV0OwogIH0KCiAgLyoqCiAgICogTWV0aG9kIGdldEZhbWlseU1lbWJlcnMgQ2hlY2sgaWYgdGhpcyBpcyBhIG1hc3Rlci4gVGhlbiBnZXRzIHRoZSBXaGVyZSBVc2VkCiAgICogTGlzdCBhbmQgZmlsdGVyIG91dCBhbGwgZG9jdW1lbnRzIHdoaWNoIGFyZW4ndCBmYW1pbHkgbWVtYmVycyAobGlrZQogICAqIGFzc2VtYmx5IHBhcmVudHMsIGxhc3QgdXNlZCBkb2N1bWVudHMsIGRyYXdpbmdzLCBub25tYXN0ZXJzIC4uLikKICAgKgogICAqIEByZXR1cm4gYSBDb2xsZWN0aW9uIG9mIFBsbURvY3VtZW50cwogICAqCiAgICovCiAgcHVibGljIENvbGxlY3Rpb248UGxtV2hlcmV1c2VkRG9jdW1lbnQ+IGdldEZhbWlseU1lbWJlcnMoKQogIHsKICAgIFZlY3RvcjxQbG1XaGVyZXVzZWREb2N1bWVudD4gdl9yZXQgPSBuZXcgVmVjdG9yPFBsbVdoZXJldXNlZERvY3VtZW50PigpOwoKICAgIC8vIGdldCBhbGwgd2hlcmUgdXNlZCBkb2N1bWVudHMKICAgIExpc3Q8UGxtV2hlcmV1c2VkRG9jdW1lbnQ+IHZfd2hlcmVfdXNlZCA9IHRoaXMuZ2V0V2hlcmVVc2VkKCk7CiAgICBmb3IgKFBsbVdoZXJldXNlZERvY3VtZW50IHBsbWRfd2hlcmVfdXNlZCA6IHZfd2hlcmVfdXNlZCkKICAgIHsKICAgICAgU3RyaW5nIHNvcnRfc3RyaW5nID0gcGxtZF93aGVyZV91c2VkLmdldFNvcnRTdHJpbmcoKTsKICAgICAgaWYgKHNvcnRfc3RyaW5nICE9IG51bGwpCiAgICAgIHsKICAgICAgICBpZiAocGxtZF93aGVyZV91c2VkLmlzRmFtaWx5TWVtYmVyUmVsYXRpb24oKSkKICAgICAgICB7CiAgICAgICAgICB2X3JldC5hZGQocGxtZF93aGVyZV91c2VkKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgU3RyaW5nIHJlczQgPSBwbG1kX3doZXJlX3VzZWQuZ2V0VXNlckRlZmluZWQ0KCk7CiAgICAgICAgaWYgKHJlczQgIT0gbnVsbCkKICAgICAgICB7CiAgICAgICAgICBpZiAocGxtZF93aGVyZV91c2VkLmlzRmFtaWx5TWVtYmVyKCkpCiAgICAgICAgICB7CiAgICAgICAgICAgIHZfcmV0LmFkZChwbG1kX3doZXJlX3VzZWQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSAvLyBmb3IKCiAgICByZXR1cm4gdl9yZXQ7CiAgfQoKICAvKioKICAgKiBDaGVjayBpZiBhIFBsbUZpbGUgb24gdGhlIERJUiBleGlzdHMgd2hpY2ggaGFzIHRoZSBzYW1lIHJlbGF0aXZlIG5hbWUKICAgKiBhcyB0aGUgZmlsZSBwYXNzZWQgdG8gdGhlIG1ldGhvZCAod3NhcHBsIGRlcGVuZGFudCkKICAgKgogICAqIEBwYXJhbSAgICBmICAgICAgICAgICAgICAgICAgIGEgIEZpbGUKICAgKiBAcGFyYW0gICAgd3NhcHBsICAgICAgICAgICAgICBhICBTdHJpbmcKICAgKgogICAqIEByZXR1cm4gICBhIGJvb2xlYW4KICAgKgogICAqLwogIHB1YmxpYyBib29sZWFuIGZpbGVFeGlzdHMoRmlsZSBmLCBTdHJpbmcgd3NhcHBsKQogIHsKICAgIFZlY3RvcjxQbG1GaWxlPiB2X2YgPSB0aGlzLmdldEZpbGVzKHdzYXBwbCk7CiAgICBpZiAodl9mICE9IG51bGwgJiYgIXZfZi5pc0VtcHR5KCkpCiAgICB7CiAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdl9mLnNpemUoKTsgaSsrKQogICAgICB7CiAgICAgICAgUGxtRmlsZSBwZiA9IHZfZi5nZXQoaSk7CiAgICAgICAgU3RyaW5nIHNhcF9mbmFtZSA9IHBmLmdldEZpbGVOYW1lKCk7CiAgICAgICAgU3RyaW5nIGRpc2tfZm5hbWUgPSBmLmdldE5hbWUoKTsKCiAgICAgICAgaWYgKGRpc2tfZm5hbWUuZXF1YWxzSWdub3JlQ2FzZShzYXBfZm5hbWUpKQogICAgICAgIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgLyoqCiAgICogTWV0aG9kIGdldEZpbGVzCiAgICogcmV0dXJucyB0aGUgT3JpZ2luYWxzIG9mIHRoaXMgUGxtRG9jdW1lbnQKICAgKiBAcmV0dXJuIGEgVmVjdG9yIG9mIFBsbUZpbGVzCiAgICoKICAgKi8KICBwdWJsaWMgT2JqZWN0VmVjdG9yPFBsbUZpbGU+IGdldEZpbGVzKCkKICB7CiAgICBpZiAob3ZQbG1GaWxlcyA9PSBudWxsKQogICAgICBvdlBsbUZpbGVzID0gbmV3IE9iamVjdFZlY3RvcjxQbG1GaWxlPih0aGlzLCBQbG1GaWxlLmNsYXNzKTsKICAgIHJldHVybiBvdlBsbUZpbGVzOwogIH0KCiAgLyoqCiAgICogR2V0IGFsbCBQbG1GaWxlcyB3aXRoIHRoZSBzcGVjaWZpZWQgd29ya3N0YXRpb24gYXBwbGljYXRpb24KICAgKi8KICBwdWJsaWMgVmVjdG9yPFBsbUZpbGU+IGdldEZpbGVzKFN0cmluZyB3c2FwcCkKICB7CiAgICBpZiAod3NhcHAgPT0gbnVsbCkKICAgICAgcmV0dXJuIG51bGw7CgogICAgVmVjdG9yPFBsbUZpbGU+IHJlc3VsdCA9IG5ldyBWZWN0b3I8UGxtRmlsZT4oKTsKCiAgICBJdGVyYXRvcjxQbG1GaWxlPiBpdGVyID0gZ2V0RmlsZXMoKS5nZXRQbG1PYmplY3RzKCkuaXRlcmF0b3IoKTsKICAgIHdoaWxlIChpdGVyLmhhc05leHQoKSkKICAgIHsKICAgICAgUGxtRmlsZSBmaWxlID0gaXRlci5uZXh0KCk7CiAgICAgIGlmIChmaWxlICE9IG51bGwgJiYgd3NhcHAuZXF1YWxzKGZpbGUuZ2V0V29ya3N0YXRpb25BcHBsaWNhdGlvbigpKSkKICAgICAgICByZXN1bHQuYWRkKGZpbGUpOwogICAgfQoKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBHZXQgYWxsIFBsbUZpbGVzIHdoaWNoIGFyZSB2YWxpZCBmb3IgUHJldmlldyBpbiBhIHZlY3RvciBvciBhbiBlbXB0eSB2ZWN0b3IKICAgKiBpZiBubyBmaWxlcyBhcmUgdmFsaWQgZm9yIHByZXZpZXcKICAgKi8KICBwdWJsaWMgVmVjdG9yPFBsbUZpbGU+IGdldFByZXZpZXdGaWxlcygpCiAgewogICAgVmVjdG9yPFBsbUZpbGU+IHJlc3VsdCA9IG5ldyBWZWN0b3I8UGxtRmlsZT4oKTsKCiAgICBJdGVyYXRvcjxQbG1GaWxlPiBpdGVyID0gZ2V0RmlsZXMoKS5nZXRQbG1PYmplY3RzKCkuaXRlcmF0b3IoKTsKICAgIHdoaWxlIChpdGVyLmhhc05leHQoKSkKICAgIHsKICAgICAgUGxtRmlsZSBmaWxlID0gaXRlci5uZXh0KCk7CiAgICAgIGlmIChmaWxlLmlzUHJldmlld1BpY3R1cmUoKSkKICAgICAgICByZXN1bHQuYWRkKGZpbGUpOwogICAgfQoKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBHZXQgdGhlIFBsbUZpbGUgd2l0aCB0aGUgc3BlY2lmaWVkIGFwcGxpY2F0aW9uIElECiAgICovCiAgcHVibGljIFBsbUZpbGUgZ2V0RmlsZShTdHJpbmcgaWQpCiAgewogICAgSXRlcmF0b3I8UGxtRmlsZT4gaXRlciA9IGdldEZpbGVzKCkuZ2V0UGxtT2JqZWN0cygpLml0ZXJhdG9yKCk7CiAgICB3aGlsZSAoaXRlci5oYXNOZXh0KCkpCiAgICB7CiAgICAgIFBsbUZpbGUgZmlsZSA9IGl0ZXIubmV4dCgpOwogICAgICBpZiAoaWQuZXF1YWxzKGZpbGUuZ2V0QXBwbGljYXRpb25JZCgpKSkKICAgICAgICByZXR1cm4gZmlsZTsKICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KCiAgLyoqCiAgICogR2V0IHRoZSBQbG1GaWxlIHdpdGggdGhlIHJlbGF0aXZlIG5hbWUgb2YgdGhlIGZpbGUuCiAgICovCiAgcHVibGljIFBsbUZpbGUgZ2V0RmlsZShGaWxlIGZpbGUpCiAgewogICAgcmV0dXJuIGdldEZpbGUoZmlsZSwgZmFsc2UpOwogIH0KCiAgLyoqCiAgICogR2V0IHRoZSBQbG1GaWxlIHdpdGggdGhlIHJlbGF0aXZlIG5hbWUgb2YgdGhlIGZpbGUuCiAgICovCiAgcHVibGljIFBsbUZpbGUgZ2V0RmlsZShGaWxlIGZpbGUsIGJvb2xlYW4gaWdub3JlQ2FzZSkKICB7CiAgICBpZiAoZmlsZSAhPSBudWxsKQogICAgewogICAgICBTdHJpbmcgcmVsX25hbWUgPSBmaWxlLmdldE5hbWUoKTsKCiAgICAgIEl0ZXJhdG9yPFBsbUZpbGU+IGl0ZXIgPSBnZXRGaWxlcygpLmdldFBsbU9iamVjdHMoKS5pdGVyYXRvcigpOwogICAgICB3aGlsZSAoaXRlci5oYXNOZXh0KCkpCiAgICAgIHsKICAgICAgICBQbG1GaWxlIHBmaWxlID0gaXRlci5uZXh0KCk7CiAgICAgICAgU3RyaW5nIHJlbF9wZmlsZSA9IHBmaWxlLmdldEZpbGVOYW1lKCk7CgogICAgICAgIGlmIChpZ25vcmVDYXNlKQogICAgICAgIHsKICAgICAgICAgIGlmIChyZWxfcGZpbGUuZXF1YWxzSWdub3JlQ2FzZShyZWxfbmFtZSkpCiAgICAgICAgICAgIHJldHVybiBwZmlsZTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgIGlmIChyZWxfcGZpbGUuZXF1YWxzKHJlbF9uYW1lKSkKICAgICAgICAgICAgcmV0dXJuIHBmaWxlOwogICAgICAgIH0KCiAgICAgIH0KICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhIG5ldyBEb2NzdHJ1Y3R1cmUgZm9yIHRoaXMgZG9jdW1lbnQsIGlmIG5vIG9uZSBleGlzdHMhIEFuZCByZXR1cm5zCiAgICogaXQKICAgKi8KICBwdWJsaWMgUGxtRG9jU3RydWN0dXJlIGNyZWF0ZURvY1N0cnVjdHVyZSgpCiAgewogICAgaWYgKHBsbURvY1N0cnVjdHVyZSA9PSBudWxsKQogICAgICBwbG1Eb2NTdHJ1Y3R1cmUgPSBuZXcgUGxtRG9jU3RydWN0dXJlKHRoaXMpOwogICAgcmV0dXJuIHBsbURvY1N0cnVjdHVyZTsKICB9CgogIC8qKgogICAqIE1ldGhvZCBzZXREb2NTdHJ1Y3R1cmUgc2V0cyB0aGUgcGxtRG9jU3RydWN0dXJlIHRvIHRoZSBuZXcgb25lIGFuZCByZXR1cm5zCiAgICogdGhlIG9sZCBvbmUuCiAgICoKICAgKiBAcGFyYW0gbmV3X3N0cnVjdHVyZQogICAqICAgICAgICAgIGEgUGxtRG9jU3RydWN0dXJlCiAgICoKICAgKiBAcmV0dXJuIGEgUGxtRG9jU3RydWN0dXJlCiAgICoKICAgKi8KICBwdWJsaWMgUGxtRG9jU3RydWN0dXJlIHNldERvY1N0cnVjdHVyZShQbG1Eb2NTdHJ1Y3R1cmUgbmV3X3N0cnVjdHVyZSkKICB7CiAgICBQbG1Eb2NTdHJ1Y3R1cmUgb2xkX3N0cnVjdHVyZSA9IHBsbURvY1N0cnVjdHVyZTsKICAgIHBsbURvY1N0cnVjdHVyZSA9IG5ld19zdHJ1Y3R1cmU7CiAgICByZXR1cm4gb2xkX3N0cnVjdHVyZTsKICB9CgogIC8qKgogICAqIEByZXR1cm4gUGxtRG9jdW1lbnQgd2hlcmUgb25seSB0aGUgcHJpbWFyeSBrZXkgaXMgc2V0CiAgICovCiAgcHVibGljIFBsbURvY3VtZW50IGNyZWF0ZUVtcHR5Q2xvbmUoKQogIHsKICAgIFBsbURvY3VtZW50IHJldCA9IG5ldyBQbG1Eb2N1bWVudCh0eXBlLCBudW1iZXIsIHZlcnNpb24sIHBhcnQpOwoKICAgIHJldHVybiByZXQ7CiAgfQoKICAvKioKICAgKiBNZXRob2QgZ2V0RG9jU3RydWN0dXJlCiAgICoKICAgKiBAcmV0dXJuIHRoZSBQbG1Eb2NTdHJ1Y3R1cmUgb2YgdGhlIERvY3VtZW50CiAgICoKICAgKi8KICBwdWJsaWMgUGxtRG9jU3RydWN0dXJlIGdldERvY1N0cnVjdHVyZSgpCiAgewogICAgcmV0dXJuIHBsbURvY1N0cnVjdHVyZTsKICB9CgogIHB1YmxpYyBDb2xsZWN0aW9uPFBsbU9iamVjdExpbms+IGdldFBsbU9iamVjdExpbmtzKCkKICB7CiAgICBDb2xsZWN0aW9uPFBsbU9iamVjdExpbms+IGxpbmtzID0gbnVsbDsKICAgIGlmIChvYmplY3RMaW5rcyAhPSBudWxsKQogICAgICBsaW5rcyA9IG9iamVjdExpbmtzLmdldFBsbU9iamVjdHMoKTsKICAgIGVsc2UKICAgICAgbGlua3MgPSBDb2xsZWN0aW9ucy5lbXB0eUxpc3QoKTsKICAgIHJldHVybiBsaW5rczsKICB9CgogIHB1YmxpYyB2b2lkIGFkZFBsbU9iamVjdExpbmsoUGxtT2JqZWN0TGluayBsaW5rKQogIHsKICAgIGlmIChvYmplY3RMaW5rcyA9PSBudWxsKQogICAgICBvYmplY3RMaW5rcyA9IG5ldyBQbG1PYmplY3RMaW5rQ29udGFpbmVyKCk7CiAgICBvYmplY3RMaW5rcy5hZGRQbG1PYmplY3QobGluayk7CiAgfQoKICAvKioKICAgKiBhZGRpZXJ0IGVpbiBGaWxlIHp1IGRlbiB2UGxtRmlsZXMKICAgKgogICAqIEBwYXJhbSBmaWxlbmFtZQogICAqIEBwYXJhbSBhcHBsVHlwZQogICAqLwogIHB1YmxpYyBQbG1GaWxlIGFkZEZpbGUoU3RyaW5nIGZpbGVuYW1lLCBTdHJpbmcgYXBwbFR5cGUpCiAgewogICAgdHJ5CiAgICB7CiAgICAgIFBsbUZpbGUgZmlsZSA9IG5ldyBQbG1GaWxlKHRoaXMsIGZpbGVuYW1lLCBhcHBsVHlwZSk7Cg==</text>
      </register>
      <register name="-" type="4">
        <text encoding="base64">ICAgICAgICAgIA==</text>
      </register>
      <register name="/" type="4">
        <text>setNu</text>
      </register>
      <register name="0" type="2">
        <text encoding="base64">Ly8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgovLwovLyAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3B5cmlnaHQgKGMpIDIwMDEKLy8gICAgICAgICAgICAgICAgICAgIERTQyBTb2Z0d2FyZSBBRywgS2FybHNydWhlLCBHZXJtYW55Ci8vICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFsbCByaWdodHMgcmVzZXJ2ZWQKLy8KLy8gICAgICAgIFRoZSBjb250ZW50cyBvZiB0aGlzIGZpbGUgaXMgYW4gdW5wdWJsaXNoZWQgd29yayBwcm90ZWN0ZWQKLy8gICAgICAgIHVuZGVyIHRoZSBjb3B5cmlnaHQgbGF3IG9mIHRoZSBGZWRlcmFsIFJlcHVibGljIG9mIEdlcm1hbnkKLy8KLy8gICAgICAgIFRoaXMgc29mdHdhcmUgaXMgcHJvcHJpZXRhcnkgdG8gYW5kIGVtYm9kZGllcyBjb25maWRlbnRpYWwKLy8gICAgICAgIHRlY2hub2xvZ3kgb2YgRFNDIFNvZnR3YXJlIEFHLiBQb3NzZXNzaW9uLCB1c2UgYW5kIGNvcHlpbmcKLy8gICAgICAgIG9mIHRoZSBzb2Z0d2FyZSBhbmQgbWVkaWEgaXMgYXV0aG9yaXplZCBvbmx5IHB1cnN1YW50IHRvIGEKLy8gICAgICAgIHZhbGlkIHdyaXR0ZW4gbGljZW5zZSBmcm9tIERTQyBTb2Z0d2FyZSBBRy4gVGhpcyBjb3B5cmlnaHQKLy8gICAgICAgIHN0YXRlbWVudCBtdXN0IGJlIHZpc2libHkgaW5jbHVkZWQgaW4gYWxsIGNvcGllcy4KLy8KLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoKLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgovLwovLyAgJFJldmlzaW9uJCAoJERhdGUkKQovLwovLyAgZmlsZW5hbWUgICAgOiBQbG1Eb2N1bWVudC5qYXZhCi8vCi8vICBjb250ZW50cyAgICA6Ci8vCi8vICBjcmVhdGVkIGF0ICA6IE1heSwgMjguIDIwMDIKLy8gIGNyZWF0ZWQgYnkgIDogU2ViYXN0aWFuIEtpZXNlbCwgRFNDIFNvZnR3YXJlIEFHLCBLYXJsc3J1aGUsIEdlcm1hbnkKLy8KLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgoKcGFja2FnZSBjYWRhZ2VudC5vYmptb2Q7CgppbXBvcnQgc3RhdGljIGNhZGFnZW50LmNmYy51dGlsLkNvbnRhaW5lclRvb2wuZmlyc3ROb25OdWxsOwppbXBvcnQgc3RhdGljIGNhZGFnZW50LmNmYy51dGlsLkNvbnRhaW5lclRvb2wuaGFzSXRlbXM7CmltcG9ydCBzdGF0aWMgY2FkYWdlbnQuY2ZjLnV0aWwuQ29udGFpbmVyVG9vbC5oYXNOb0l0ZW1zOwppbXBvcnQgc3RhdGljIGNhZGFnZW50LmNmYy51dGlsLlN0cmluZ1Rvb2wuaGFzQ29udGVudDsKaW1wb3J0IHN0YXRpYyBjYWRhZ2VudC5jZmMudXRpbC5TdHJpbmdUb29sLmludGVybjsKaW1wb3J0IHN0YXRpYyBjYWRhZ2VudC5zYXAuQXBpUGFyYW1ldGVyVG9vbC5hc3NpZ247CgppbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5uZXQuTWFsZm9ybWVkVVJMRXhjZXB0aW9uOwppbXBvcnQgamF2YS5uZXQuVVJMOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkRhdGU7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkhhc2h0YWJsZTsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLk1hcC5FbnRyeTsKaW1wb3J0IGphdmEudXRpbC5PYmplY3RzOwppbXBvcnQgamF2YS51dGlsLlZlY3RvcjsKaW1wb3J0IGphdmEudXRpbC5mdW5jdGlvbi5QcmVkaWNhdGU7CmltcG9ydCBqYXZhLnV0aWwucmVnZXguUGF0dGVyblN5bnRheEV4Y2VwdGlvbjsKCmltcG9ydCBqYXZheC5hbm5vdGF0aW9uLk5vbm51bGw7CmltcG9ydCBqYXZheC5hbm5vdGF0aW9uLk51bGxhYmxlOwoKaW1wb3J0IG9yZy53M2MuZG9tLkVsZW1lbnQ7CgppbXBvcnQgY29tLmRzY3NhZy5wbG0uc3BpLmludGVyZmFjZXMuRG9jdW1lbnRLZXk7CgppbXBvcnQgY2FkYWdlbnQuY2ZjLmRpYy5EaWM7CmltcG9ydCBjYWRhZ2VudC5jZmMubG9nLkRlZmF1bHRMb2dFeGNlcHRpb247CmltcG9ydCBjYWRhZ2VudC5jZmMucHJlZi5QcmVmZXJlbmNlczsKaW1wb3J0IGNhZGFnZW50LmNmYy51dGlsLkNvbnRhaW5lclRvb2w7CmltcG9ydCBjYWRhZ2VudC5jZmMudXRpbC5EYXRlVG9vbDsKaW1wb3J0IGNhZGFnZW50LmNmYy51dGlsLk51bWJlclV0aWxzOwppbXBvcnQgY2FkYWdlbnQuY2ZjLnV0aWwuU3RyaW5nVG9vbDsKaW1wb3J0IGNhZGFnZW50LmNmYy51dGlsLlRyYWNlOwppbXBvcnQgY2FkYWdlbnQuZHR5cGUuRFR5cGU7CmltcG9ydCBjYWRhZ2VudC5kdHlwZS5EVHlwZUNvbnRhaW5lcjsKaW1wb3J0IGNhZGFnZW50LmV4Yy5NaXNzaW5nU2FwS2V5RXhjZXB0aW9uOwppbXBvcnQgY2FkYWdlbnQuZXhjLlByZWZlcmVuY2VOb3RFeGlzdGVudEV4Y2VwdGlvbjsKaW1wb3J0IGNhZGFnZW50LnBsbS5QbG1Db25zdGFudHM7CmltcG9ydCBjYWRhZ2VudC5wbG0uUGxtTG9uZ3RleHRVdGlsczsKaW1wb3J0IGNhZGFnZW50LnBsbS5QbG1TdGF0dXNDb250YWluZXI7CmltcG9ydCBjYWRhZ2VudC5wbG0uUGxtU3RhdHVzVG9vbDsKaW1wb3J0IGNhZGFnZW50LnBsbS5QbG1WZXJzaW9uVG9vbDsKaW1wb3J0IGNhZGFnZW50LnBsbS5udW1jb252ZXJ0ZXIuRG9jdW1lbnROdW1iZXJDb252ZXJ0ZXI7CmltcG9ydCBjYWRhZ2VudC5wcm9jLkRhdGFDb250YWluZXI7CmltcG9ydCBjYWRhZ2VudC5wcm9jLmRvYy5Qcm9jZXNzRG9jU3RydWN0dXJlRXhwbG9kZTQ7CmltcG9ydCBjYWRhZ2VudC5zYXAuQXBpUGFyYW1ldGVyOwppbXBvcnQgY2FkYWdlbnQuc2FwLkFwaVBhcmFtZXRlclRvb2w7CmltcG9ydCBjYWRhZ2VudC5zYXAuQmFwaVJldHVybmVkRXJyb3JFeGNlcHRpb247CmltcG9ydCBjYWRhZ2VudC5zYXAubWFuLlNhcE1hbmFnZXI7CgovKioKICogUGxtIERvY3VtZW50IGZvciB0aGUgb2JqZWN0IG1vZGVsCiAqCiAqIEBhdXRob3IgU2ViYXN0aWFuIEtpZXNlbAogKiBAdmVyc2lvbiAkUmV2aXNpb24kICgkRGF0ZSQpCiAqCiAqLwpwdWJsaWMgY2xhc3MgUGxtRG9jdW1lbnQgZXh0ZW5kcyBQbG1DbGFzc2lmaWVkT2JqZWN0IGltcGxlbWVudHMgUGxtQ2hhbmdlYWJsZU9iamVjdCwgRG9jdW1lbnRLZXkKewogIHB1YmxpYyBmaW5hbCBzdGF0aWMgU3RyaW5nIElEID0gIkAoIykgJElkJCI7CgogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogIC8vCiAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzIHQgYSB0IGkgYyBzCiAgLy8KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgcHVibGljIGZpbmFsIHN0YXRpYyBTdHJpbmcgQ0FESURQQVRURVJOID0gUHJlZmVyZW5jZXMuc3RyaW5nVmFsdWUoInBsbS5jb250cm9sLnVzZXJkZWZpbmVkNC5wYXR0ZXJuIiwgIltBLVpdW0EtWjAtOV1bQS1aMC05XTouKiIpOwoKICAvKiogbmFtZSBvZiBzYXAgdGFibGUgd2hlcmUgZG9jdW1lbnRzIGFyZSBzdG9yZWQgKi8KICBwdWJsaWMgZmluYWwgc3RhdGljIFN0cmluZyBUQUJMRV9UWVBFID0gIkRSQVciOwoKICBwdWJsaWMgZmluYWwgc3RhdGljIFN0cmluZyBNQVNURVIgPSAiTSI7CiAgcHVibGljIGZpbmFsIHN0YXRpYyBTdHJpbmcgTk9OTUFTVEVSID0gIk4iOwoKICAvKioKICAgKiBNYXN0ZXJtb2RlbGwgbWl0IEZhbWlseSBNZW1iZXIgS2VubnVuZywgZGFzcyBwYXJ0bmFtZSBlaW5lIFZlcnNpb24gZW50aGFlbHQKICAgKi8KICBwdWJsaWMgZmluYWwgc3RhdGljIFN0cmluZyBGQU1JTFlfTUVNQkVSX1ZFUlNJT04gPSAiViI7CgogIC8qKgogICAqIE1hc3Rlcm1vZGVsbCBtaXQgRmFtaWx5IE1lbWJlciBLZW5udW5nLCBkYXNzIHBhcnRuYW1lIGtlaW5lIFZlcnNpb24KICAgKiBlbnRoYWVsdAogICAqLwogIHB1YmxpYyBmaW5hbCBzdGF0aWMgU3RyaW5nIEZBTUlMWV9NRU1CRVJfTk9OVkVSU0lPTiA9ICJOViI7CgogIC8qKiBAc2VlICNpc0ZhbWlseU1lbWJlcigpICovCiAgcHJpdmF0ZSBmaW5hbCBzdGF0aWMgU3RyaW5nIEZBTUlMWV9HRU5FUklDID0gIkciOwoKICAvKiogQHNlZSAjaXNGYW1pbHlNZW1iZXIoKSAqLwogIHByaXZhdGUgZmluYWwgc3RhdGljIFN0cmluZyBGQU1JTFlfSU5TVEFOQ0UgPSAiSSI7CgogIC8qKiBAc2VlIGlzRHJhd2luZygpICovCiAgcHJpdmF0ZSBmaW5hbCBzdGF0aWMgU3RyaW5nIERSQVdJTkcgPSAiRCI7CgogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogIC8vCiAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYgYSByIGkgYSBiIGwgZSBzCiAgLy8KICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgLyoqIGNhY2hlZCBrZXkgKi8KICBwcml2YXRlIFN0cmluZyBzYXBrZXk7CgogIC8qKiBjYWNoZWQgc2hvcnRudW1iZXIgKi8KICBwcml2YXRlIFN0cmluZyBzaG9ydE51bWJlcjsKCiAgLyoqCiAgICogVGhpcyBudW1iZXIgaXMgdGhlIG1haW4gcGFydCBvZiB0aGUgZG9jdW1lbnQga2V5LCB3aGljaCBpcyB1c2VkIHRvIGlkZW50aWZ5CiAgICogdGhlIGRvY3VtZW50LgogICAqLwogIHByaXZhdGUgU3RyaW5nIG51bWJlcjsKCiAgLyoqCiAgICogVGhlIGRvY3VtZW50IHR5cGUgb2YgdGhlIHN1cGVyaW9yIGRvY3VtZW50IG11c3Qgbm90IGJlIHRoZSBzYW1lIGFzIHRoYXQgb2YKICAgKiB0aGUgZG9jdW1lbnQgeW91IGFyZSBjdXJyZW50bHkgcHJvY2Vzc2luZy4KICAgKi8KICBwcml2YXRlIFN0cmluZyB0eXBlOwoKICAvKiogTnVtYmVyIHdoaWNoIGlkZW50aWZpZXMgdGhlIHZlcnNpb24gb2YgYSBkb2N1bWVudC4gKi8KICBwcml2YXRlIFN0cmluZyB2ZXJzaW9uOwoKICAvKiogU2VjdGlvbiBvZiBhIGRvY3VtZW50IHdoaWNoIGlzIG1haW50YWluZWQgYXMgYW4gaW5kZXBlbmRlbnQgZG9jdW1lbnQuICovCiAgcHJpdmF0ZSBTdHJpbmcgcGFydDsKCiAgLyoqIFNob3J0IHRleHQgZGVzY3JpYmluZyB0aGUgZG9jdW1lbnQuICovCiAgcHJpdmF0ZSBTdHJpbmcgZGVzY3JpcHRpb247CgogIC8qKiBsb25nIHRleHQgZGVzY3JpYmluZyB0aGUgZG9jdW1lbnQuICovCiAgcHJpdmF0ZSBNYXA8U3RyaW5nLCBWZWN0b3I8U3RyaW5nPj4gbUxvbmdUZXh0czsKICBwcml2YXRlIE1hcDxTdHJpbmcsIExpbmtlZExpc3Q8UGxtTG9uZ1RleHRMaW5lPj4gbU5ld0xvbmdUZXh0czsKCiAgLyoqIE5hbWUgb2YgdGhlIHVzZXIgd2hvIGlzIHJlc3BvbnNpYmxlIGZvciB0aGUgZG9jdW1lbnQgaW5mbyByZWNvcmQuICovCiAgcHJpdmF0ZSBTdHJpbmcgdXNlcjsKCiAgLyoqIFRoaXMga2V5IHNob3dzIHRoZSBkb2N1bWVudCBzdGF0dXMuICovCiAgcHJpdmF0ZSBTdHJpbmcgc3RhdHVzOwoKICAvKiogS2V5IGZvciB0aGUgZGVzaWduIG9mZmljZSwgbGFib3JhdG9yeSwgb3IgbGFib3JhdG9yeSB3b3JrZXIgcmVzcG9uc2libGUuICovCiAgcHJpdmF0ZSBTdHJpbmcgb2ZmaWNlOwoKICAvKiogVGhlIGF1dGhvcml6YXRpb24gZ3JvdXAgZW5hYmxlcyB5b3UgcHJvdGVjdCBhY2Nlc3MgdG8gY2VydGFpbiBvYmplY3RzLiAqLwogIHByaXZhdGUgU3RyaW5nIGF1dGhvcml6YXRpb25Hcm91cDsKCiAgLyoqIFRoZSBjb252ZXJzaW9uIHN0YXR1cyBvZiB0aGUgZG9jdW1lbnQgKi8KICBwcml2YXRlIFN0cmluZyBjb252ZXJzaW9uU3RhdHVzOwoKICAvKiogKi8KICBwcml2YXRlIFBsbURvY1N0cnVjdHVyZSBwbG1Eb2NTdHJ1Y3R1cmU7CgogIC8qKgogICAqIE51bWJlciBvZiB0aGUgY2hhbmdlIG1hc3RlciByZWNvcmQgd2hpY2ggZ3JvdXBzIHRvZ2V0aGVyIGxvZ2ljYWxseSBsaW5rZWQKICAgKiBkb2N1bWVudHMgYW5kIGFueSBvdGhlciBTQVAgb2JqZWN0cyAoc3VjaCBhcyBiaWxsIG9mIG1hdGVyaWFsLCByb3V0aW5nLAogICAqIG1hdGVyaWFsKS4KICAgKi8KICBwcml2YXRlIFN0cmluZyBjaGFuZ2VOdW1iZXI7CgogIC8qKiBSZXZpc2lvbiBMZXZlbCAqLwogIHByaXZhdGUgU3RyaW5nIHJldkxldmVsOwoKICAvKiogRGVsZXRlIGZsYWcgKi8KICBwcml2YXRlIGJvb2xlYW4gZGVsZXRlRmxhZzsKCiAgLyoqIFN0cnVjdHVyZSBmbGFnICovCiAgcHJpdmF0ZSBib29sZWFuIHN0cnVjdHVyZUZsYWc7CgogIC8qKiBDQUQgaW5kaWNhdG9yICovCiAgcHJpdmF0ZSBib29sZWFuIGNhZEluZGljYXRvciA9IHRydWU7CgogIC8qKiBVc2VyZGVmaW5lZCAxICovCiAgcHJpdmF0ZSBTdHJpbmcgdXNlckRlZmluZWQxOwoKICAvKiogVXNlcmRlZmluZWQgMiAqLwogIHByaXZhdGUgU3RyaW5nIHVzZXJEZWZpbmVkMjsKCiAgLyoqIFVzZXJkZWZpbmVkIDMgKi8KICBwcml2YXRlIFN0cmluZyB1c2VyRGVmaW5lZDM7CgogIC8qKiBVc2VyZGVmaW5lZCA0LCBzZWUgYWxzbyB1Z1R5cGUgKi8KICBwcml2YXRlIFN0cmluZyB1c2VyRGVmaW5lZDQ7CgogIHByaXZhdGUgRGF0ZSBjcmVhdGVEYXRlOwoKICAvKiogQ29udGFpbnMgdGhlIGxpbmtlZCBGaWxlcyAqLwogIHByaXZhdGUgT2JqZWN0VmVjdG9yPFBsbUZpbGU+IG92UGxtRmlsZXM7CgogIHByaXZhdGUgUGxtT2JqZWN0TGlua0NvbnRhaW5lciBvYmplY3RMaW5rczsKCiAgLyoqIENvbnRhaW5zIHBsbURvY3VtZW50cyB3aGVyZSB0aGlzIGRvY3VtZW50IGlzIHVzZWQgKi8KICBwcml2YXRlIExpc3Q8UGxtV2hlcmV1c2VkRG9jdW1lbnQ+IHZXaGVyZVVzZWQ7CgogIC8qKiBjb250YWlucyB0aGUgc3RhdHVzIGxvZyBlbnRyaWVzIGFzIGluc3RhbmNlcyBvZiBTdGF0dXNMb2dFbnRyeSBjbGFzcyAqICovCiAgcHJpdmF0ZSBTdGF0dXNMb2cgc3RhdHVzTG9nOwoKICAvKioKICAgKiBDaGFuZ2UgZG9jdW1lbnQgd2l0aCBhbGwgZnJvbSB0aGUgdXNlciBwcm9wb3NlZCBjaGFuZ2VzLCBiZWZvcmUgdGhleSBhcmUKICAgKiB0cmFuc2ZlcmVkIHRvIFNBUCBOVUxMIHVudGlsIGNoYW5nZXMgYXJlIGRvbmUgdmlhIHRoZSBzZXQgTWV0aG9kcy4gR2V0CiAgICogTWV0aG9kIHdpbGwgbG9vayBmb3IgdmFsdWVzIGZpcnN0IGluIHRoZSBjaGFuZ2UgZG9jdW1lbnQsIHRoZW4gaW4gdGhlIHJlYWwKICAgKiBvbmUuCiAgICovCiAgcHJpdmF0ZSBQbG1DaGFuZ2VEb2N1bWVudCBvQ2hhbmdlRG9jdW1lbnQgPSBudWxsOwoKICAvKiogYWN0YWwgbGFuZ3VhZ2UgKi8KICBwcml2YXRlIFN0cmluZyBhY3RfbGFuZ3UgPSAiIjsKCiAgcHJpdmF0ZSBQbG1DaGFuZ2VNYXN0ZXJDb250YWluZXIgZWNtUmVzZXJ2YXRpb25zOwoKICAvKiogTWFwLiBrZXkoTEFOR1VBR0VfSVNPKS0+dmFsdWUoZGVzY3JpcHRpb24pKiAqLwogIHByaXZhdGUgTWFwPFN0cmluZywgU3RyaW5nPiBtRGVzY3JpcHRpb25zOwoKICAvKiogRXh0ZW5kZWQgRFJBVyBWYXJpYWJsZXMgKi8KICAvKiBTVUJUWVBFIC0gQ0hBUjEwICovCiAgcHJpdmF0ZSBTdHJpbmcgc3VidHlwZTsKCiAgLyoqIEV4dGVuZGVkIERSQVcgRGF0YTogTUFTVEVSIC0gQ0hBUjEgKi8KICBwcml2YXRlIFN0cmluZyBtYXN0ZXI7CgogIC8qKiBFeHRlbmRlZCBEUkFXIERhdGE6IEZBTUlMWSBDSEFSNCAqLwogIHByaXZhdGUgU3RyaW5nIGZhbWlseTsKCiAgLyoqIEV4dGVuZGVkIERSQVcgRGF0YTogRElSVFkgQ0hBUjEgKi8KICBwcml2YXRlIFN0cmluZyBkaXJ0eTsKCiAgLyoqIEV4dGVuZGVkIERSQVcgRGF0YTogTUFUX0FWQUlMQUJMRSBDSEFSMSAqLwogIHByaXZhdGUgU3RyaW5nIG1hdEF2YWlsYWJsZTsKCiAgLyoqIEV4dGVuZGVkIERSQVcgRGF0YTogTk1fQVZBSUxBQkxFIENIQVIxICovCiAgcHJpdmF0ZSBTdHJpbmcgbm1BdmFpbGFibGU7CgogIC8qKiBFeHRlbmRlZCBEUkFXIERhdGE6IENBRF9WRVJTSU9OIENIQVIyMCAqLwogIHByaXZhdGUgU3RyaW5nIGFwcGxSZWxlYXNlOwoKICAvKiogRXh0ZW5kZWQgRFJBVyBEYXRhOiBFeHBhbmRlZCBDQURfVkVSU0lPTiAqLwogIHByaXZhdGUgU3RyaW5nIGFwcGxSZWxlYXNlRXh0OwoKICAvKiogRXh0ZW5kZWQgRFJBVyBEYXRhOiBDQURfRU5WIENIQVIxMCAqLwogIHByaXZhdGUgU3RyaW5nIGFwcGxFbnZpcm9ubWVudDsKCiAgLyoqIEV4dGVuZGVkIERSQVcgRGF0YTogQ0hFQ0tJTl9EQVRFIENIQVIxNCAqLwogIHByaXZhdGUgU3RyaW5nIGxhc3RNb2RpZmllZERhdGVTdHJpbmc7CgogIHByaXZhdGUgRGF0ZSBsYXN0TW9kaWZpZWREYXRlOwoKICAvKiogRXh0ZW5kZWQgRFJBVyBEYXRhOiBWSUVXQUJMRVNfVVBEIENIQVIxICovCiAgcHJpdmF0ZSBTdHJpbmcgdmlld2FibGVzVXBkOwoKICAvKiogRXh0ZW5kZWQgRFJBVyBEYXRhOiBSRUZTRVRTIENIQVIyNTUgKi8KICBwcml2YXRlIFN0cmluZyByZWZzZXRzOwoKICAvKiogRXh0ZW5kZWQgRFJBVyBEYXRhOiBDT01QU0VUUyBDSEFSMjU1ICovCiAgcHJpdmF0ZSBTdHJpbmcgY29tcHNldHM7CgogIHByaXZhdGUgUGxtQm91bmRpbmdCb3ggYm91bmRpbmdCb3g7CgogIC8qKiBFeHRlbmRlZCBEUkFXIERhdGE6IHNhdmVjb3VudGVyIENIQVIyMCAqLwogIHByaXZhdGUgU3RyaW5nIHNhdmVDb3VudGVyOwoKICAvKiogRXh0ZW5kZWQgRFJBVyBEYXRhOiBSRVM2IENIQVIyMCAqLwogIHByaXZhdGUgU3RyaW5nIHJlczY7CgogIC8qKiBFeHRlbmRlZCBEUkFXIERhdGE6IFJFUzcgQ0hBUjEyOCAqLwogIHByaXZhdGUgU3RyaW5nIHJlczc7CgogIC8qKiBFeHRlbmRlZCBEUkFXIERhdGE6IFJFUzggQ0hBUjEyOCAqLwogIHByaXZhdGUgU3RyaW5nIHJlczg7CgogIC8qKiBFeHRlbmRlZCBEUkFXIERhdGE6IEZMQUcxIENIQVIxICovCiAgcHJpdmF0ZSBTdHJpbmcgZmxhZzE7CgogIC8qKiBFeHRlbmRlZCBEUkFXIERhdGE6IEZMQUcyIENIQVIxICovCiAgcHJpdmF0ZSBTdHJpbmcgZmxhZzI7CgogIC8qKiBFeHRlbmRlZCBEUkFXIERhdGE6IE1PRSBDSEFSMSAqLwogIHByaXZhdGUgU3RyaW5nIG1hc3Rlck9yaWdpbmFsRXhpc3Q7CgogIC8qKiBFeHRlbmRlZCBEUkFXIERhdGE6IE1PQyBDSEFSMSAqLwogIHByaXZhdGUgU3RyaW5nIG1hc3Rlck9yaWdpbmFsQ2hlY2tlZG91dDsKCiAgLyoqIEV4dGVuZGVkIERSQVcgRGF0YTogQU9FIENIQVIxICovCiAgcHJpdmF0ZSBTdHJpbmcgYWRkT3JpZ2luYWxFeGlzdDsKCiAgLyoqIEV4dGVuZGVkIERSQVcgRGF0YTogQU9DIENIQVIxICovCiAgcHJpdmF0ZSBTdHJpbmcgYWRkT3JpZ2luYWxDaGVja2Vkb3V0OwoKICAvKiogRXh0ZW5kZWQgRFJBVyBEYXRhOiBITlYgQ0hBUjEgKi8KICBwcml2YXRlIFN0cmluZyBoYXNOZXdWZXJzaW9uOwoKICAvKiogRXh0ZW5kZWQgRFJBVyBEYXRhOiBIUlYgQ0hBUjEgKi8KICBwcml2YXRlIFN0cmluZyBoYXNSZWxlYXNlZFZlcnNpb247CgogIHByaXZhdGUgYm9vbGVhbiBoYXMyRFByZXZpZXc7CgogIHByaXZhdGUgYm9vbGVhbiBoYXMzRFByZXZpZXc7CgogIHByaXZhdGUgU3RyaW5nIGlzTk1VcFRvRGF0ZTsKCiAgLyoqIG1hc3RlciBvcmlnaW5hbCBzdG9yYWdlIC0gVkFVTFQgaWYgY2hlY2tlZCBpbiwgZmlsZXNlcnZlcmlkIGlmIGNoZWNrZWQgb3V0ICovCiAgcHJpdmF0ZSBTdHJpbmcgbWFzdGVyT3JpZ2luYWxTdG9yYWdlOwoKICAvKiogbWFzdGVyIG9yaWdpbmFsIGZpbGUgbmFtZSAqLwogIHByaXZhdGUgU3RyaW5nIG1hc3Rlck9yaWdpbmFsRmlsZW5hbWU7CgogIHByaXZhdGUgU3RyaW5nIGNsYXNzaWZpY2F0aW9uRmxhZzsKCiAgLyoqIEV4dGVuZGVkIERSQVcgRGF0YTogRkxBRzQgQ0hBUjEgKi8KICBwcml2YXRlIFN0cmluZyBmbGFnNDsKCiAgLyoqIEV4dGVuZGVkIERSQVcgRGF0YTogVkFMSURGUk9NIERBVFMgKi8KICBwcml2YXRlIERhdGUgdmFsaWRGcm9tOwoKICAvKiogRXh0ZW5kZWQgRFJBVyBEYXRhOiBWQUxJRFRPIERBVFMgKi8KICBwcml2YXRlIERhdGUgdmFsaWRUbzsKCiAgLyoqIG1hdGVyaWFsIHR5cGUgTUFUX01UQVJUIENIQVIgKi8KICBwcml2YXRlIFN0cmluZyBtYXRUeXBlOwoKICAvKiogbWF0ZXJpYWwgc3RhdHVzIE1BVF9NU1RBRSBDSEFSICovCiAgcHJpdmF0ZSBTdHJpbmcgbWF0U3RhdHVzOwoKICAvKiogZXh0ZXJuYWwgbnVtYmVyIG9mIGxpbmtlZCBtYXRlcmlhbCBNQVROUl9FWFQgQ0hBUiAqLwogIHByaXZhdGUgU3RyaW5nIG1hdEV4dE51bTsKCiAgLyoqIGludGVybmFsIG51bWJlciBvZiBsaW5rZWQgbWF0ZXJpYWwgTUFUTlJfSU5UIENIQVIgKi8KICBwcml2YXRlIFN0cmluZyBtYXRJbnROdW07CgogIHByaXZhdGUgU3RyaW5nIGhhc01vcmVUaGFuT25lTGlua2VkTWF0ZXJpYWw7CgogIHByaXZhdGUgUGxtTWF0ZXJpYWwgbGlua2VkTWF0SW5zdGFuY2U7CgogIHByaXZhdGUgYm9vbGVhbiBoYXNHb3NOb3RlOwoKICBwcml2YXRlIGxvbmcgY2hlY2tvdXRTaXplID0gLTE7CgogIHByaXZhdGUgU3RyaW5nIGFjbU93bmVkQ29udGV4dDsKCiAgcHJpdmF0ZSBQbG1MaWJyYXJ5SW5mbyBsaWJyYXJ5SW5mbzsKCiAgcHJpdmF0ZSBib29sZWFuIGhhc0F1dGhvcmlzYXRpb24gPSB0cnVlOwoKICBwcml2YXRlIGJvb2xlYW4gaGFzRG93bmxvYWRQZXJtaXNzaW9uID0gdHJ1ZTsKCiAgcHJpdmF0ZSBTdHJpbmcgY2FkVmFyaWFudElkOwoKICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAvLwogIC8vICAgICAgICAgICAgICAgICAgICAgICBwIHUgYiBsIGkgYyAgIG0gZSB0IGggbyBkIHMKICAvLwogIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKICAvKioKICAgKiBDb25zdHJ1Y3RvciAxCiAgICovCiAgcHJvdGVjdGVkIFBsbURvY3VtZW50KCkKICB7CiAgICBzdXBlcigpOwogICAgYWN0X2xhbmd1ID0gU2FwTWFuYWdlci5nZXRBY3RpdmVMYW5ndWFnZSgpOwogIH0gLy8gQ29uc3RydWN0b3IKCiAgLyoqCiAgICogQ29uc3RydWN0b3IgMgogICAqCiAgICogQHBhcmFtIGRvY19rZXlzICAgYSBIYXNodGFibGUgZnJvbSB0eXBlIEJBUElfRE9DX0tFWVMKICAgKi8KICBwcm90ZWN0ZWQgUGxtRG9jdW1lbnQoTWFwPFN0cmluZywgPyBleHRlbmRzIE9iamVjdD4gZG9jX2tleXMpCiAgewogICAgbnVtYmVyID0gU3RyaW5nVG9vbC5jdXRUcmFpbGluZyhTdHJpbmcudmFsdWVPZihmaXJzdE5vbk51bGwoZG9jX2tleXMsICJET0NVTUVOVE5VTUJFUiIsICJET0tOUiIsICJET0NVTUVOVCIpKSwgJyAnLCAxLCBmYWxzZSk7CiAgICBudW1iZXIgPSBTdHJpbmdUb29sLnRvVXBwZXJDYXNlKG51bWJlcik7CiAgICB0eXBlID0gU3RyaW5nVG9vbC5jdXRUcmFpbGluZyhTdHJpbmcudmFsdWVPZihmaXJzdE5vbk51bGwoZG9jX2tleXMsICJET0NVTUVOVFRZUEUiLCAiRE9LQVIiLCAiRE9DX1RZUEUiKSksICcgJywgMSk7CiAgICB0eXBlID0gU3RyaW5nVG9vbC50b1VwcGVyQ2FzZSh0eXBlKTsKICAgIHZlcnNpb24gPSBTdHJpbmdUb29sLmN1dFRyYWlsaW5nKFN0cmluZy52YWx1ZU9mKGZpcnN0Tm9uTnVsbChkb2Nfa2V5cywgIkRPQ1VNRU5UVkVSU0lPTiIsICJET0tWUiIsICJET0NfVkVSUyIpKSwgJyAnLCAxKTsKICAgIHZlcnNpb24gPSBTdHJpbmdUb29sLnRvVXBwZXJDYXNlKHZlcnNpb24pOwogICAgcGFydCA9IFN0cmluZ1Rvb2wuY3V0VHJhaWxpbmcoU3RyaW5nLnZhbHVlT2YoZmlyc3ROb25OdWxsKGRvY19rZXlzLCAiRE9DVU1FTlRQQVJUIiwgIkRPS1RMIiwgIkRPQ19QQVJUIikpLCAnICcsIDEpOwogICAgcGFydCA9IFN0cmluZ1Rvb2wudG9VcHBlckNhc2UocGFydCk7CgogICAgLy8gY29udmVydCBudW1iZXIKICAgIG51bWJlciA9IERvY3VtZW50TnVtYmVyQ29udmVydGVyLmdldEluc3QoKS5leHRUb0ludChudW1iZXIpOwoKICAgIGFjdF9sYW5ndSA9IFNhcE1hbmFnZXIuZ2V0QWN0aXZlTGFuZ3VhZ2UoKTsKICAgIHNhcGtleSA9IG51bGw7CiAgICBzaG9ydE51bWJlciA9IG51bGw7CiAgfQoKICAvKioKICAgKiBDb25zdHJ1Y3RvciAzCiAgICoKICAgKiBAcGFyYW0gc2FwX29iamVjdGtleSAgIHVzZWQgaW4gYSBsb3Qgb2YgdGFibGVzIGxpa2UgRFJBRAogICAqLwogIHByb3RlY3RlZCBQbG1Eb2N1bWVudChTdHJpbmcgc2FwX29iamVjdGtleSkKICB7CiAgICAvLyBzcGxpdCBvYmplY3RrZXkKICAgIHNldEtleXNGcm9tT2JqS2V5KHNhcF9vYmplY3RrZXkpOwogIH0KCiAgLyoqCiAgICogQ29uc3RydWt0b3IgNAogICAqLwogIHByb3RlY3RlZCBQbG1Eb2N1bWVudChTdHJpbmcgdHlwZSwgU3RyaW5nIG51bWJlciwgU3RyaW5nIHZlcnNpb24sIFN0cmluZyBwYXJ0KQogIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLnR5cGUgPSBTdHJpbmdUb29sLnRvVXBwZXJDYXNlKHR5cGUpOwogICAgdGhpcy5udW1iZXIgPSBEb2N1bWVudE51bWJlckNvbnZlcnRlci5nZXRJbnN0KCkuZXh0VG9JbnQobnVtYmVyKTsKICAgIHRoaXMudmVyc2lvbiA9IFN0cmluZ1Rvb2wudG9VcHBlckNhc2UodmVyc2lvbik7CiAgICB0aGlzLnBhcnQgPSBTdHJpbmdUb29sLnRvVXBwZXJDYXNlKHBhcnQpOwoKICAgIGFjdF9sYW5ndSA9IFNhcE1hbmFnZXIuZ2V0QWN0aXZlTGFuZ3VhZ2UoKTsKICAgIHNhcGtleSA9IG51bGw7CiAgICBzaG9ydE51bWJlciA9IG51bGw7CiAgfQoKICAvKioKICAgKiBDb25zdHJ1Y3RvciA1CiAgICoKICAgKiBAcGFyYW0gc2FwX29iamVjdGtleSAgIHVzZWQgaW4gYSBsb3Qgb2YgdGFibGVzIGxpa2UgRFJBRAogICAqIEBwYXJhbSB1c2VyX2RlZmluZWQ0ICAgYSBTdHJpbmcgdXNlZCBlLmcuIGluIEJyRG9jdW1lbnQKICAgKi8KICBwcm90ZWN0ZWQgUGxtRG9jdW1lbnQoU3RyaW5nIHNhcF9vYmplY3RrZXksIFN0cmluZyBkdHlwZSwgU3RyaW5nIG1hc3RlciwgU3RyaW5nIGZhbWlseSwgU3RyaW5nIHVzZXJfZGVmaW5lZDQpCiAgewogICAgLy8gc3BsaXQgb2JqZWN0a2V5CiAgICBzZXRLZXlzRnJvbU9iaktleShzYXBfb2JqZWN0a2V5KTsKICAgIGlmIChoYXNDb250ZW50KGR0eXBlKSkKICAgICAgdGhpcy5zdWJ0eXBlID0gZHR5cGU7CiAgICBpZiAoaGFzQ29udGVudChtYXN0ZXIpKQogICAgICB0aGlzLm1hc3RlciA9IG1hc3RlcjsKICAgIGlmIChoYXNDb250ZW50KGZhbWlseSkpCiAgICAgIHRoaXMuZmFtaWx5ID0gZmFtaWx5OwogICAgaWYgKGhhc0NvbnRlbnQodXNlcl9kZWZpbmVkNCkpCiAgICAgIHRoaXMudXNlckRlZmluZWQ0ID0gdXNlcl9kZWZpbmVkNDsKICB9CgogIC8qKgogICAqIE1ldGhvZCBjbGVhckxvbmdUZXh0CiAgICoKICAgKi8KICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBjbGVhckxvbmdUZXh0KCkKICB7CiAgICBpZiAobUxvbmdUZXh0cyAhPSBudWxsKQogICAgICBtTG9uZ1RleHRzLmNsZWFyKCk7CgogICAgaWYgKG1OZXdMb25nVGV4dHMgIT0gbnVsbCkKICAgICAgbU5ld0xvbmdUZXh0cy5jbGVhcigpOwogIH0KCiAgcHJvdGVjdGVkIHZvaWQgY2xlYXJEZXNjcmlwdGlvbnMoKQogIHsKICAgIGlmIChtRGVzY3JpcHRpb25zICE9IG51bGwpCiAgICAgIG1EZXNjcmlwdGlvbnMuY2xlYXIoKTsKICB9CgogIC8qKgogICAqIE1ldGhvZCBjbGVhclN0YXR1c0xvZwogICAqCiAgICovCiAgcHJvdGVjdGVkIHZvaWQgY2xlYXJTdGF0dXNMb2coKQogIHsKICAgIHN0YXR1c0xvZyA9IG51bGw7CiAgfQoKICAvKioKICAgKiBNZXRob2Qgc2V0TGFzdE1vZGlmaWVkRGF0ZQogICAqCiAgICogQHBhcmFtIGxhc3RfbW9kaWZpZWRfZGF0ZQogICAqICAgICAgICAgIGEgRGF0ZQogICAqCiAgICovCiAgcHVibGljIHZvaWQgc2V0TGFzdE1vZGlmaWVkRGF0ZShEYXRlIGxhc3RfbW9kaWZpZWRfZGF0ZSkKICB7CiAgICBpZiAobGFzdF9tb2RpZmllZF9kYXRlID09IG51bGwpCiAgICAgIHRoaXMubGFzdE1vZGlmaWVkRGF0ZVN0cmluZyA9IG51bGw7CiAgICBlbHNlCiAgICAgIHRoaXMubGFzdE1vZGlmaWVkRGF0ZVN0cmluZyA9IERhdGVUb29sLmRhdGVUb1NhcChsYXN0X21vZGlmaWVkX2RhdGUpOwoKICAgIHRoaXMubGFzdE1vZGlmaWVkRGF0ZSA9IGxhc3RfbW9kaWZpZWRfZGF0ZTsKICB9CgogIC8qKgogICAqIE1ldGhvZCBzZXRMYXN0TW9kaWZpZWREYXRlU3RyaW5nCiAgICoKICAgKiBAcGFyYW0gbGFzdE1vZGlmaWVkRGF0ZVN0cmluZwogICAqICAgICAgICAgIGEgU3RyaW5nCiAgICoKICAgKi8KICBwdWJsaWMgdm9pZCBzZXRMYXN0TW9kaWZpZWREYXRlU3RyaW5nKFN0cmluZyBsYXN0TW9kaWZpZWREYXRlU3RyaW5nKQogIHsKICAgIHRyeQogICAgewogICAgICBEYXRlIGRhdGUgPSBEYXRlVG9vbC5zYXBUb0RhdGUobGFzdE1vZGlmaWVkRGF0ZVN0cmluZyk7CiAgICAgIHRoaXMubGFzdE1vZGlmaWVkRGF0ZVN0cmluZyA9IGxhc3RNb2RpZmllZERhdGVTdHJpbmc7CiAgICAgIHRoaXMubGFzdE1vZGlmaWVkRGF0ZSA9IGRhdGU7CiAgICB9CiAgICBjYXRjaCAoRXhjZXB0aW9uIGUpCiAgICB7CiAgICAgIFRyYWNlLnByaW50bG4oVHJhY2UuSEVBRCwgIkludmFsaWQgZGF0ZTogPCIgKyBsYXN0TW9kaWZpZWREYXRlU3RyaW5nICsgIj4gYXQgIiArIHRoaXMudG9TdHJpbmcoKSk7CiAgICAgIFRyYWNlLnByaW50bG5TdGFja1RyYWNlKFRyYWNlLkRFQlVHLCBlKTsKICAgIH0KICB9CgogIC8qKgogICAqIHNldCB0aGUga2V5IHZhbHVlcyBvZiB0aGUgZG9jdW1lbnQuIE9ubHkgYWxsb3dlZCBpZiBkb2N1bWVudCBkb2Vzbid0IGV4aXN0CiAgICogaW4gU0FQCiAgICoKICAgKiBAcmV0dXJuIHRydWUgaWYgY2hhbmdlIHdhcyBzdWNjZXNzZnVsIGZhbHNlIGlmIGNoYW5nZSBmYWlsZWQKICAgKi8KICBwdWJsaWMgYm9vbGVhbiBzZXRLZXkoU3RyaW5nIHR5cGUsIFN0cmluZyBudW1iZXIsIFN0cmluZyB2ZXJzaW9uLCBTdHJpbmcgcGFydCkKICB7CiAgICBpZiAoZXhpc3RzSW5TYXApCiAgICB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgc2Fwa2V5ID0gbnVsbDsKICAgICAgc2hvcnROdW1iZXIgPSBudWxsOwogICAgICB0aGlzLm51bWJlciA9IERvY3VtZW50TnVtYmVyQ29udmVydGVyLmdldEluc3QoKS5leHRUb0ludChudW1iZXIpOwoKICAgICAgdGhpcy50eXBlID0gU3RyaW5nVG9vbC50b1VwcGVyQ2FzZSh0eXBlKTsKICAgICAgdGhpcy52ZXJzaW9uID0gU3RyaW5nVG9vbC50b1VwcGVyQ2FzZSh2ZXJzaW9uKTsKICAgICAgdGhpcy5wYXJ0ID0gU3RyaW5nVG9vbC50b1VwcGVyQ2FzZShwYXJ0KTsKCiAgICAgIHNldE9iamVjdElkKGdldFNhcEtleSgpKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgfQoKICAvKioKICAgKiBNZXRob2QgZnJvbUNoZWNrb3V0SW5mbwogICAqCiAgICogQHBhcmFtIGNvaQogICAqICAgICAgICAgIGEgQ2hlY2tvdXRJbmZvCiAgICoKICAgKiBAcmV0dXJuIGEgUGxtRG9jdW1lbnQKICAgKgogICAqLwogIHB1YmxpYyBzdGF0aWMgUGxtRG9jdW1lbnQgZnJvbUNoZWNrb3V0SW5mbyhDaGVja291dEluZm8gY29pKQogIHsKICAgIFBsbURvY3VtZW50IGRvYyA9IG5ldyBQbG1Eb2N1bWVudChjb2kuZ2V0U2FwS2V5KCksIGNvaS5zdWJ0eXBlLCBjb2kubWFzdGVyLCBjb2kuZmFtaWx5LCBjb2kucmVzNCk7CiAgICBkb2Muc2V0U3RhdHVzKGNvaS5kb2tzdCk7CiAgICBkb2Muc2V0VXNlcihjb2kudXNlcik7CiAgICBkb2Muc2V0U3VidHlwZShjb2kuc3VidHlwZSk7CiAgICBkb2Muc2V0TWFzdGVyKGNvaS5tYXN0ZXIpOwogICAgZG9jLnNldEZhbWlseShjb2kuZmFtaWx5KTsKICAgIGRvYy5zZXREaXJ0eShjb2kuZGlydHkpOwogICAgZG9jLnNldEFwcGxWZXJzaW9uKGNvaS5hcHBsVmVyc2lvbik7CiAgICBkb2Muc2V0QXBwbFZlcnNpb25FeHQoY29pLmFwcGxWZXJzaW9uRXh0KTsKICAgIGRvYy5zZXRBcHBsRW52aXJvbm1lbnQoY29pLmFwcGxFbnZpcm9ubWVudCk7CiAgICBkb2Muc2V0TGFzdE1vZGlmaWVkRGF0ZVN0cmluZyhjb2kubGFzdE1vZGlmaWVkRGF0ZVN0cmluZyk7CiAgICBkb2Muc2V0U2F2ZUNvdW50ZXIoY29pLnNhdmVDb3VudGVyKTsKICAgIGRvYy5zZXRNYXN0ZXJGaWxlbmFtZShjb2kubWFzdGVyRmlsZU5hbWUpOwogICAgcmV0dXJuIGRvYzsKICB9CgogIC8qKgogICAqIENoZWNrcyB0aGUgZXhpc3RlbmNlIGluIFNBUCB0aHJvdWdoIEJBUElfRE9DVU1FTlRfRVhJU1RFTkNFQ0hFQ0sgUGVyZm9ybXMKICAgKiBBTFdBWVMgYSBCQVBJX0RPQ1VNRU5UX0VYSVNURU5DRUNIRUNLCiAgICovCiAgcHVibGljIGJvb2xlYW4gZXhpc3RlbmNlQ2hlY2soKQogIHsKICAgIHJldHVybiBleGlzdGVuY2VDaGVjayh0cnVlKTsKICB9CgogIC8qKgogICAqIENoZWNrcyB0aGUgZXhpc3RlbmNlIGluIFNBUCB0aHJvdWdoIEJBUElfRE9DVU1FTlRfRVhJU1RFTkNFQ0hFQ0sKICAgKgogICAqIEBwYXJhbSBiYXBpCiAgICogICAgICAgICAgdHJ1ZSB1c2UgQkFQSV9ET0NVTUVOVF9FWElTVEVOQ0VDSEVDSyB0byBkZXRlcm1pbmUgaWYgdGhlIGRvY3VtZW50CiAgICogICAgICAgICAgZXhpc3QuIGZhbHNlIGNoZWNrIGludGVybmFsIGZsYWcKICAgKi8KICBwdWJsaWMgYm9vbGVhbiBleGlzdGVuY2VDaGVjayhib29sZWFuIGJhcGkpCiAgewogICAgaWYgKGNoZWNrSW50ZXJuYWxGbGFncyhiYXBpKSkKICAgICAgcmV0dXJuIHRydWU7CgogICAgLy8gcGVyZm9ybSBjaGVjayB2aWEgQkFQSSBjYWxsCiAgICBBcGlQYXJhbWV0ZXIgYXBpX3BhcmFtcyA9IG5ldyBBcGlQYXJhbWV0ZXIoKTsKICAgIGV4cG9ydEtleXMoYXBpX3BhcmFtcyk7CiAgICBleGVjdXRlQXBpKCJCQVBJX0RPQ1VNRU5UX0VYSVNURU5DRUNIRUNLIiwgYXBpX3BhcmFtcyk7CiAgICBTdHJpbmcgZXhpc3RzRmxhZyA9IGFwaV9wYXJhbXMuZ2V0U2NhbGFyRXhwb3J0KCJET0NVTUVOVEVYSVNUUyIpOwogICAgYm9vbGVhbiBleGlzdHMgPSAiWCIuZXF1YWxzSWdub3JlQ2FzZShleGlzdHNGbGFnKTsKICAgIHNldEV4aXN0c0luU2FwKGV4aXN0cyk7CiAgICByZXR1cm4gZXhpc3RzOwogIH0KCiAgcHJpdmF0ZSBib29sZWFuIGNoZWNrSW50ZXJuYWxGbGFncyhib29sZWFuIGJhcGkpCiAgewogICAgaWYgKCFiYXBpICYmIGV4aXN0c0luU2FwKQogICAgewogICAgICAvLyBkb2N1bWVudCBleGlzdHMgaW4gU0FQIC0gb25lIGV4aXN0ZW5jZUNoZWNrKCkgZWFybGllciBtYXliZSBoYXMgc2V0IHRoZSBmbGFnIGFscmVhZHkuCiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgLyoqCiAgICogZ2lidCBkaWUgRG9rdW1lbnRudW1tZXIgb2huZSBm/GhyZW5kZSBOdWxsZW4genVydWVjawogICAqLwogIHB1YmxpYyBTdHJpbmcgZ2V0RXh0TnVtYmVyKCkKICB7CiAgICBpZiAoc2hvcnROdW1iZXIgPT0gbnVsbCkKICAgICAgc2hvcnROdW1iZXIgPSBEb2N1bWVudE51bWJlckNvbnZlcnRlci5nZXRJbnN0KCkuaW50VG9FeHQobnVtYmVyKTsKICAgIHJldHVybiBzaG9ydE51bWJlcjsKICB9CgogIC8qKgogICAqIGdpYnQgZGllIERva3VtZW50bnVtbWVyIHp1cnVlY2sKICAgKi8KICBAT3ZlcnJpZGUKICBwdWJsaWMgU3RyaW5nIGdldE51bWJlcigpCiAgewogICAgcmV0dXJuIG51bWJlcjsKICB9CgogIC8qKgogICAqIGdpYnQgZGVuIERva3VtZW50ZW50eXAgenVydWVjawogICAqLwogIEBPdmVycmlkZQogIHB1YmxpYyBTdHJpbmcgZ2V0VHlwZSgpCiAgewogICAgcmV0dXJuIHR5cGU7CiAgfQoKICAvKioKICAgKiBnaWJ0IGRlbiBEb2t1bWVudGVucGFydCB6dXJ1ZWNrCiAgICovCiAgQE92ZXJyaWRlCiAgcHVibGljIFN0cmluZyBnZXRQYXJ0KCkKICB7CiAgICByZXR1cm4gcGFydDsKICB9CgogIC8qKgogICAqIGdpYnQgZGllIERva3VtZW50ZW52ZXJzaW9uIHp1cnVlY2sKICAgKi8KICBAT3ZlcnJpZGUKICBwdWJsaWMgU3RyaW5nIGdldFZlcnNpb24oKQogIHsKICAgIHJldHVybiB2ZXJzaW9uOwogIH0KCiAgLyoqCiAgICogZ2lidCBkaWUgRG9rdW1lbnRkZXNjcmlwdGlvbiB6dXJ1ZWNrCiAgICovCiAgcHVibGljIFN0cmluZyBnZXREZXNjcmlwdGlvbigpCiAgewogICAgaWYgKG1vZGlmaWVkICYmIHZhbEF2YWlsKG9DaGFuZ2VEb2N1bWVudC5jaERlc2NyaXB0aW9uKSkKICAgICAgcmV0dXJuIG9DaGFuZ2VEb2N1bWVudC5jaERlc2NyaXB0aW9uOwogICAgZWxzZQogICAgICByZXR1cm4gZGVzY3JpcHRpb247CiAgfQoKICAvKioKICAgKiBNZXRob2QgZ2V0RGVzY3JpcHRpb24KICAgKgogICAqIEBwYXJhbSBsYW5ndWFnZV9pc28KICAgKiAgICAgICAgICBhIFN0cmluZwogICAqCiAgICogQHJldHVybiBhIFN0cmluZyAtIGRlc2NyaXB0aW9uIGZvciB0aGUgbGFuZ3VhZ2UoSVNPKSBvciBudWxsIGlmIGRlc2NyaXB0aW9uCiAgICogICAgICAgICBpcyBub3QgYXZhaWxhYmxlCiAgICoKICAgKi8KICBwdWJsaWMgU3RyaW5nIGdldERlc2NyaXB0aW9uKFN0cmluZyBsYW5ndWFnZV9pc28pIC8vVE9ETyB2YWxBdmFpbCguLi4pIORuZGVybiB6dSBvQ2hhbmdlRG91Y21lbnQuY2hEZXNjcmlwdGlvbi5jb250YWluc0tleShsYW5ndWFnZV9pc28pCiAgewogICAgU3RyaW5nIHJldCA9IG51bGw7CiAgICBpZiAobW9kaWZpZWQgJiYgdmFsQXZhaWwob0NoYW5nZURvY3VtZW50Lm1DaERlc2NyKSkKICAgIHsKICAgICAgcmV0ID0gb0NoYW5nZURvY3VtZW50Lm1DaERlc2NyLmdldChsYW5ndWFnZV9pc28pOwogICAgfQogICAgZWxzZQogICAgewogICAgICBpZiAobURlc2NyaXB0aW9ucyAhPSBudWxsKQogICAgICAgIHJldCA9IG1EZXNjcmlwdGlvbnMuZ2V0KGxhbmd1YWdlX2lzbyk7CiAgICB9CiAgICByZXR1cm4gcmV0OwogIH0KCiAgcHVibGljIFN0cmluZyBnZXRPcmlnaW5hbERlc2NyaXB0aW9uKFN0cmluZyBsYW5ndWFnZV9pc28pCiAgewogICAgU3RyaW5nIHJldCA9IG51bGw7CiAgICBpZiAobURlc2NyaXB0aW9ucyAhPSBudWxsKQogICAgICByZXQgPSBtRGVzY3JpcHRpb25zLmdldChsYW5ndWFnZV9pc28pOwogICAgcmV0dXJuIHJldDsKICB9CgogIC8qKgogICAqIE1ldGhvZCBnZXREZXNjTGFuZ3VhZ2VzCiAgICoKICAgKiBAcmV0dXJuIGEgQ29sbGVjdGlvbiB3aXRoIGFsbCBsYW5ndWFnZXMoSVNPKSBmb3Igd2hpY2ggYSBkZXNjcmlwdGlvbiBpcwogICAqICAgICAgICAgbWFpbnRhaW5lZCBvciBudWxsCiAgICoKICAgKi8KICBwdWJsaWMgQ29sbGVjdGlvbjxTdHJpbmc+IGdldERlc2NMYW5ndWFnZXMoKQogIHsKICAgIENvbGxlY3Rpb248U3RyaW5nPiByZXQgPSBudWxsOwogICAgaWYgKG1vZGlmaWVkICYmIHZhbEF2YWlsKG9DaGFuZ2VEb2N1bWVudC5tQ2hEZXNjcikpCiAgICAgIHJldCA9IG9DaGFuZ2VEb2N1bWVudC5tQ2hEZXNjci5rZXlTZXQoKTsKICAgIGVsc2UgaWYgKG1EZXNjcmlwdGlvbnMgIT0gbnVsbCkKICAgICAgcmV0ID0gbURlc2NyaXB0aW9ucy5rZXlTZXQoKTsKICAgIHJldHVybiByZXQ7CiAgfQoKICBATm9ubnVsbAogIHB1YmxpYyBDb2xsZWN0aW9uPFN0cmluZz4gZ2V0QWxsTWFpbnRhaW5lZExhbmd1YWdlcygpCiAgewogICAgQ29sbGVjdGlvbjxTdHJpbmc+IGNfbF9kZXNjcyA9IGdldERlc2NMYW5ndWFnZXMoKTsKICAgIENvbGxlY3Rpb248U3RyaW5nPiBjX2xfbHRleHRzID0gZ2V0TmV3TG9uZ1RleHRMYW5ndWFnZXMoKTsKICAgIExpc3Q8U3RyaW5nPiBsX2FsbF9sYW5ncyA9IG5ldyBBcnJheUxpc3Q8PigpOwoKICAgIGlmIChjX2xfZGVzY3MgIT0gbnVsbCkKICAgICAgbF9hbGxfbGFuZ3MuYWRkQWxsKGNfbF9kZXNjcyk7CgogICAgaWYgKCFsX2FsbF9sYW5ncy5jb250YWlucyhhY3RfbGFuZ3UpKQogICAgICBsX2FsbF9sYW5ncy5hZGQoYWN0X2xhbmd1KTsKCiAgICBmb3IgKEl0ZXJhdG9yPFN0cmluZz4gaXQgPSBjX2xfbHRleHRzLml0ZXJhdG9yKCk7IGl0Lmhhc05leHQoKTspCiAgICB7CiAgICAgIFN0cmluZyBvID0gaXQubmV4dCgpOwogICAgICBpZiAoIWxfYWxsX2xhbmdzLmNvbnRhaW5zKG8pKQogICAgICB7CiAgICAgICAgbF9hbGxfbGFuZ3MuYWRkKG8pOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gKGxfYWxsX2xhbmdzKTsKICB9CgogIC8qKgogICAqIE1ldGhvZCBnZXREZXNjcmlwdGlvbnMKICAgKgogICAqIEByZXR1cm4gYSBDb2xsZWN0aW9uIHdpdGggYWxsIG1haW50YWluZWQgZGVzY3JpcHRpb25zIG9yIG51bGwKICAgKgogICAqLwogIHB1YmxpYyBDb2xsZWN0aW9uPFN0cmluZz4gZ2V0RGVzY3JpcHRpb25zKCkKICB7CiAgICBDb2xsZWN0aW9uPFN0cmluZz4gcmV0ID0gbnVsbDsKICAgIGlmIChtb2RpZmllZCAmJiB2YWxBdmFpbChvQ2hhbmdlRG9jdW1lbnQubUNoRGVzY3IpKQogICAgewogICAgICByZXQgPSBvQ2hhbmdlRG9jdW1lbnQubUNoRGVzY3IudmFsdWVzKCk7CiAgICB9CiAgICBlbHNlCiAgICB7CiAgICAgIGlmIChtRGVzY3JpcHRpb25zICE9IG51bGwpCiAgICAgIHsKICAgICAgICByZXQgPSBtRGVzY3JpcHRpb25zLnZhbHVlcygpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmV0OwogIH0KCiAgLyoqCiAgICogc2V0enQgZGllIERva3VtZW50ZGVzY3JpcHRpb24KICAgKgogICAqIEBwYXJhbSBkZXNjcmlwdGlvbgogICAqLwogIHB1YmxpYyB2b2lkIHNldERlc2NyaXB0aW9uKFN0cmluZyBkZXNjcmlwdGlvbikKICB7CiAgICBpbml0Q2hhbmdlRG9jKCk7CiAgICBvQ2hhbmdlRG9jdW1lbnQuY2hEZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uOwogICAgb0NoYW5nZURvY3VtZW50Lm1DaERlc2NyLnB1dChhY3RfbGFuZ3UsIGRlc2NyaXB0aW9uKTsKICB9CgogIHB1YmxpYyB2b2lkIHNldERlc2NyaXB0aW9uKFN0cmluZyBsYW5nLCBTdHJpbmcgZGVzY3JpcHRpb24pCiAgewogICAgaW5pdENoYW5nZURvYygpOwogICAgaWYgKGFjdF9sYW5ndS5lcXVhbHNJZ25vcmVDYXNlKGxhbmcpKQogICAgICBvQ2hhbmdlRG9jdW1lbnQuY2hEZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uOwogICAgb0NoYW5nZURvY3VtZW50Lm1DaERlc2NyLnB1dChsYW5nLCBkZXNjcmlwdGlvbik7CiAgfQoKICBATnVsbGFibGUKICBwdWJsaWMgTGlua2VkTGlzdDxQbG1Mb25nVGV4dExpbmU+IGdldE5ld0xvbmdUZXh0KFN0cmluZyBsYW5nKQogIHsKICAgIExpbmtlZExpc3Q8UGxtTG9uZ1RleHRMaW5lPiBsUmV0ID0gbnVsbDsKICAgIGlmIChtb2RpZmllZCAmJiBvQ2hhbmdlRG9jdW1lbnQgIT0gbnVsbCAmJiB2YWxBdmFpbChvQ2hhbmdlRG9jdW1lbnQubUNoTmV3TG9uZ1RleHQpKQogICAgewogICAgICBsUmV0ID0gb0NoYW5nZURvY3VtZW50Lm1DaE5ld0xvbmdUZXh0LmdldChsYW5nKTsKICAgIH0KICAgIGVsc2UgaWYgKG1OZXdMb25nVGV4dHMgIT0gbnVsbCkKICAgIHsKICAgICAgbFJldCA9IG1OZXdMb25nVGV4dHMuZ2V0KGxhbmcpOwogICAgfQoKICAgIHJldHVybiBsUmV0OwogIH0KCiAgcHVibGljIHZvaWQgcmVtb3ZlVW51c2VkTmV3TG9uZ1RleHRzKCkKICB7CiAgICBpZiAob0NoYW5nZURvY3VtZW50ICE9IG51bGwpCiAgICB7CiAgICAgIFByZWRpY2F0ZTxATnVsbGFibGUgTGlua2VkTGlzdDxQbG1Mb25nVGV4dExpbmU+PiBpc0VtcHR5VGV4dCA9IHRleHQgLT4gdGV4dCA9PSBudWxsIHx8IHRleHQuaXNFbXB0eSgpCiAgICAgICAgICB8fCAodGV4dC5zaXplKCkgPT0gMSB8fCB0ZXh0LmdldCgwKS5nZXRUZXh0KCkuaXNFbXB0eSgpKTsKCiAgICAgIEl0ZXJhdG9yPEVudHJ5PFN0cmluZywgTGlua2VkTGlzdDxQbG1Mb25nVGV4dExpbmU+Pj4gYWxsTGFuZ3MgPSBvQ2hhbmdlRG9jdW1lbnQubUNoTmV3TG9uZ1RleHQuZW50cnlTZXQoKS5pdGVyYXRvcigpOwogICAgICB3aGlsZSAoYWxsTGFuZ3MuaGFzTmV4dCgpKQogICAgICB7CiAgICAgICAgRW50cnk8U3RyaW5nLCBMaW5rZWRMaXN0PFBsbUxvbmdUZXh0TGluZT4+IGxhbmcgPSBhbGxMYW5ncy5uZXh0KCk7CiAgICAgICAgaWYgKGlzRW1wdHlUZXh0LnRlc3QobGFuZy5nZXRWYWx1ZSgpKSkKICAgICAgICAgIGFsbExhbmdzLnJlbW92ZSgpOwogICAgICB9CiAgICB9CiAgfQoKICBATm9ubnVsbAogIHB1YmxpYyBDb2xsZWN0aW9uPFN0cmluZz4gZ2V0TmV3TG9uZ1RleHRMYW5ndWFnZXMoKQogIHsKICAgIENvbGxlY3Rpb248U3RyaW5nPiBjTGFuZyA9IG51bGw7CiAgICBpZiAobW9kaWZpZWQgJiYgb0NoYW5nZURvY3VtZW50ICE9IG51bGwgJiYgdmFsQXZhaWwob0NoYW5nZURvY3VtZW50Lm1DaE5ld0xvbmdUZXh0KSkKICAgIHsKICAgICAgY0xhbmcgPSBvQ2hhbmdlRG9jdW1lbnQubUNoTmV3TG9uZ1RleHQua2V5U2V0KCk7CiAgICB9CiAgICBlbHNlIGlmIChtTmV3TG9uZ1RleHRzICE9IG51bGwpCiAgICB7CiAgICAgIGNMYW5nID0gbU5ld0xvbmdUZXh0cy5rZXlTZXQoKTsKICAgIH0KCiAgICByZXR1cm4gY0xhbmcgIT0gbnVsbCA/IGNMYW5nIDogbmV3IEhhc2hTZXQ8PigpOwogIH0KCiAgcHVibGljIHZvaWQgc2V0TmV3TG9uZ1RleHQoU3RyaW5nIGxhbmcsIExpbmtlZExpc3Q8UGxtTG9uZ1RleHRMaW5lPiB0ZXh0cykKICB7CiAgICBpbml0Q2hhbmdlRG9jKCk7CiAgICBpZiAob0NoYW5nZURvY3VtZW50Lm1DaE5ld0xvbmdUZXh0ID09IG51bGwpCiAgICAgIG9DaGFuZ2VEb2N1bWVudC5tQ2hOZXdMb25nVGV4dCA9IG5ldyBIYXNoTWFwPFN0cmluZywgTGlua2VkTGlzdDxQbG1Mb25nVGV4dExpbmU+PigpOwoKICAgIG9DaGFuZ2VEb2N1bWVudC5tQ2hOZXdMb25nVGV4dC5wdXQobGFuZywgdGV4dHMpOwogIH0KCiAgLyoqCiAgICogZnVlZ3QgZGVuIHVlYmVyZ2ViZW5lbiBTdHJpbmcgZGVtIExhbmd0ZXh0IGhpbnp1CiAgICoKICAgKiBAcGFyYW0gcwogICAqLwogIHB1YmxpYyB2b2lkIGFkZHRMb25nVGV4dChTdHJpbmcgcykKICB7CiAgICBpbml0Q2hhbmdlRG9jKCk7CiAgICBWZWN0b3I8U3RyaW5nPiB2ID0gb0NoYW5nZURvY3VtZW50Lm1DaExvbmdUZXh0LmdldChhY3RfbGFuZ3UpOwogICAgaWYgKHYgPT0gbnVsbCkKICAgIHsKICAgICAgdiA9IG5ldyBWZWN0b3I8U3RyaW5nPigpOwogICAgICBvQ2hhbmdlRG9jdW1lbnQubUNoTG9uZ1RleHQucHV0KGFjdF9sYW5ndSwgdik7CiAgICB9CiAgICB2LmFkZChzKTsKICB9CgogIC8qKgogICAqIGZ1ZWd0IGRpZSB1ZWJlcmdlYmViZW4gWmVpbGVuIGRlcyBWZWN0b3JzIGRlbSBMYW5ndGV4dCBoaW56dQogICAqCiAgICogQHBhcmFtIHYKICAgKiAgICAgICAgICBsb25nIHRleHQKICAgKi8KICBwdWJsaWMgdm9pZCBhZGR0TG9uZ1RleHQoVmVjdG9yPFN0cmluZz4gdikKICB7CiAgICBpbml0Q2hhbmdlRG9jKCk7CiAgICBWZWN0b3I8U3RyaW5nPiB2X29sZCA9IG9DaGFuZ2VEb2N1bWVudC5tQ2hMb25nVGV4dC5nZXQoYWN0X2xhbmd1KTsKICAgIGlmICh2X29sZCA9PSBudWxsKQogICAgewogICAgICB2X29sZCA9IG5ldyBWZWN0b3I8U3RyaW5nPih2LnNpemUoKSk7CiAgICAgIG9DaGFuZ2VEb2N1bWVudC5tQ2hMb25nVGV4dC5wdXQoYWN0X2xhbmd1LCB2X29sZCk7CiAgICB9CiAgICB2X29sZC5hZGRBbGwodik7CiAgfQoKICAvKioKICAgKiBNZXRob2QgZ2V0U3RhdHVzTG9nCiAgICoKICAgKiBAcmV0dXJuIGEgU3RhdHVzTG9nIC0gc3RhdHVzIGxvZyBhc3NvY2l0YXRlZCB3aXRoIHRoaXMgZG9jIG9yIG51bGwgaWYgaXQgaXMKICAgKiAgICAgICAgIG5vdCByZWFkCiAgICoKICAgKi8KICBwdWJsaWMgU3RhdHVzTG9nIGdldFN0YXR1c0xvZygpCiAgewogICAgcmV0dXJuIHN0YXR1c0xvZzsKICB9CgogIC8qKgogICAqIGdpYnQgZGllIENoYW5nZW51bWJlciB6dXJ1ZWNrCiAgICovCiAgcHVibGljIFN0cmluZyBnZXRDaGFuZ2VOdW1iZXIoKQogIHsKICAgIHJldHVybiBjaGFuZ2VOdW1iZXI7CiAgfQoKICAvKioKICAgKiBzZXR6dCBkaWUgQ2hhbmdlbnVtYmVyIE9uY2UgeW91IHNhdmUgdGhlIGRvY3VtZW50IGluZm8gcmVjb3JkLCB5b3UgY2FuIG5vCiAgICogbG9uZ2VyIGNoYW5nZSB0aGUgY2hhbmdlIG51bWJlci4gSWYgeW91IHdhbnQgdG8gcHJvY2VzcyB0aGUgZG9jdW1lbnQgd2l0aAogICAqIGFub3RoZXIgY2hhbmdlIG51bWJlciwgeW91IGhhdmUgdG8gY3JlYXRlIGEgbmV3IHZlcnNpb24uCiAgICoKICAgKi8KICBwdWJsaWMgdm9pZCBzZXRDaGFuZ2VOdW1iZXIoU3RyaW5nIGNoYW5nZU51bWJlcikKICB7CiAgICB0aGlzLmNoYW5nZU51bWJlciA9IFBsbUNoYW5nZU9iamVjdC5nZXROZXdWYWx1ZUlmQ2hhbmdlZCh0aGlzLmNoYW5nZU51bWJlciwKICAgICAgICBTdHJpbmdUb29sLmlzTnVtZXJpYyhjaGFuZ2VOdW1iZXIpID8gU3RyaW5nVG9vbC5zZXRMZWFkaW5nKGNoYW5nZU51bWJlciwgJzAnLCAxMikgOiBjaGFuZ2VOdW1iZXIsIHRoaXMsICJFQ05VTUJFUiIpOwogIH0KCiAgLyoqCiAgICogTWV0aG9kIHNldENoYW5nZU1hc3RlciBPbmNlIHlvdSBzYXZlIHRoZSBkb2N1bWVudCBpbmZvIHJlY29yZCwgeW91IGNhbiBubwogICAqIGxvbmdlciBjaGFuZ2UgdGhlIGNoYW5nZSBudW1iZXIuIElmIHlvdSB3YW50IHRvIHByb2Nlc3MgdGhlIGRvY3VtZW50IHdpdGgKICAgKiBhbm90aGVyIGNoYW5nZSBudW1iZXIsIHlvdSBoYXZlIHRvIGNyZWF0ZSBhIG5ldyB2ZXJzaW9uLgogICAqCiAgICogQHBhcmFtIGNoYW5nZU1hc3RlcgogICAqICAgICAgICAgIGEgUGxtQ2hhbmdlTWFzdGVyCiAgICoKICAgKi8KICBwdWJsaWMgdm9pZCBzZXRDaGFuZ2VNYXN0ZXIoUGxtQ2hhbmdlTWFzdGVyIGNoYW5nZU1hc3RlcikKICB7CiAgICBzZXRDaGFuZ2VOdW1iZXIoY2hhbmdlTWFzdGVyLmdldENoYW5nZU5vKCkpOwogIH0KCiAgLyoqCiAgICogZ2lidCBkZW4gRG9rdW1lbnQgU2FjaGJlYXJiZWl0ZXIgenVydWVjawogICAqLwogIHB1YmxpYyBTdHJpbmcgZ2V0VXNlcigpCiAgewogICAgcmV0dXJuIHVzZXI7CiAgfQoKICAvKioKICAgKiBzZXR6dCBkZW4gU2FjaGJlYXJiZWl0ZXIKICAgKgogICAqIEBwYXJhbSB1c2VyCiAgICovCiAgcHVibGljIHZvaWQgc2V0VXNlcihTdHJpbmcgdXNlcikKICB7CiAgICB0aGlzLnVzZXIgPSBQbG1DaGFuZ2VPYmplY3QuZ2V0TmV3VmFsdWVJZkNoYW5nZWQodGhpcy51c2VyLCB1c2VyLCB0aGlzLCAiVVNFUk5BTUUiKTsKICB9CgogIC8qKgogICAqIHNldHp0IGRlbiBVc2VyZGVmaW5lZDIgZmxhZyAoWmVpdHN0ZW1wZWwpCiAgICoKICAgKiBAcGFyYW0gcmVzMQogICAqLwogIHB1YmxpYyB2b2lkIHNldFVzZXJEZWZpbmVkMShTdHJpbmcgcmVzMSkKICB7CiAgICB0aGlzLnVzZXJEZWZpbmVkMSA9IFBsbUNoYW5nZU9iamVjdC5nZXROZXdWYWx1ZUlmQ2hhbmdlZCh0aGlzLnVzZXJEZWZpbmVkMSwgcmVzMSwgdGhpcywgIlVTRVJERUZJTkVEMSIpOwogIH0KCiAgLyoqCiAgICogc2V0enQgZGVuIFVzZXJkZWZpbmVkMiBmbGFnIChaZWl0c3RlbXBlbCkKICAgKgogICAqLwogIHB1YmxpYyB2b2lkIHNldFVzZXJEZWZpbmVkMihTdHJpbmcgY2hhbmdlZEF0KQogIHsKICAgIHRoaXMudXNlckRlZmluZWQyID0gUGxtQ2hhbmdlT2JqZWN0LmdldE5ld1ZhbHVlSWZDaGFuZ2VkKHRoaXMudXNlckRlZmluZWQyLCBjaGFuZ2VkQXQsIHRoaXMsICJVU0VSREVGSU5FRDIiKTsKICB9CgogIC8qKgogICAqIHNldHp0IGRlbiBVc2VyZGVmaW5lZDMgZmxhZwogICAqCiAgICovCiAgcHVibGljIHZvaWQgc2V0VXNlckRlZmluZWQzKFN0cmluZyByZXMzKQogIHsKICAgIHRoaXMudXNlckRlZmluZWQzID0gUGxtQ2hhbmdlT2JqZWN0LmdldE5ld1ZhbHVlSWZDaGFuZ2VkKHRoaXMudXNlckRlZmluZWQzLCByZXMzLCB0aGlzLCAiVVNFUkRFRklORUQzIik7CiAgfQoKICAvKioKICAgKiBzZXR6dCBkZW4gVXNlcmRlZmluZWQ0IGZsYWcKICAgKgogICAqLwogIHB1YmxpYyB2b2lkIHNldFVzZXJEZWZpbmVkNChTdHJpbmcgcmVzNCkKICB7CiAgICB0aGlzLnVzZXJEZWZpbmVkNCA9IFBsbUNoYW5nZU9iamVjdC5nZXROZXdWYWx1ZUlmQ2hhbmdlZCh0aGlzLnVzZXJEZWZpbmVkNCwgcmVzNCwgdGhpcywgIlVTRVJERUZJTkVENCIpOwogIH0KCiAgLyoqCiAgICogZ2lidCBkZW4gRG9rdW1lbnRzdGF0dXMgenVydWVjawogICAqLwogIHB1YmxpYyBTdHJpbmcgZ2V0U3RhdHVzKCkKICB7CiAgICByZXR1cm4gc3RhdHVzOwogIH0KCiAgLyoqCiAgICogQHJldHVybiB0cnVlIGlmIHRoZSBkb2N1bWVudCBpcyBpbiBjaGVja291dCBzdGF0dXMKICAgKi8KICBwdWJsaWMgYm9vbGVhbiBoYXNDaGVja291dFN0YXR1cygpCiAgewogICAgcmV0dXJuIChpc0NoZWNrb3V0U3RhdHVzKGdldFN0YXR1cygpLCBnZXRUeXBlKCkpKTsKICB9CgogIC8qKgogICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgZG9jdW1lbnQgaXMgaW4gbG9jayBzdGF0dXMKICAgKi8KICBwdWJsaWMgYm9vbGVhbiBoYXNMb2NrZWRTdGF0dXMoKQogIHsKICAgIFBsbVN0YXR1c0NvbnRhaW5lciBwbG1fc3RhdF9jb250ID0gUGxtU3RhdHVzVG9vbC5nZXREb2NTdGF0dXMoZ2V0VHlwZSgpLCBnZXRTdGF0dXMoKSk7CiAgICBpZiAocGxtX3N0YXRfY29udCA9PSBudWxsKQogICAgewogICAgICAvLyAyNS4wMS4yMDA2IHd0IC0gZXMgZ2lidCBEb2t1bWVudGFydGVuIGRpZSBrZWluIFN0YXR1c25ldHp3ZXJrIGhhYmVuIC0+CiAgICAgIC8vIGRpZSBEb2t1bWVudGUgaGFiZW4gZGFubiBhdWNoIGtlaW4gU3RhdHVzIC0tPgogICAgICAvLyBlcyBtdXNzIGFiZXIgaW1tZXIgbm9jaCBtb2VnbGljaCBzZWluIHouYi4gRG9rdW1lbnRiZXNjaHJlaWJ1bmcgenUKICAgICAgLy8gYWVuZGVybi4KICAgICAgLy8gYWxzbyBrZWluIHN0YXR1cyBkZWZpbmllcnQgaGVpc3N0IGF1Y2ggZXMgaXN0IGtlaW4gbG9ja3N0YXR1cyAtIHJldAogICAgICAvLyBmYWxzZQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICByZXR1cm4gcGxtX3N0YXRfY29udC5pc0xvY2tlZFN0YXR1cygpOwogIH0KCiAgLyoqCiAgICogTWV0aG9kIHNldFN0YXR1cyBzZXR6dCBkZW4gRG9rdW1lbnRzdGF0dXMKICAgKgogICAqIEBwYXJhbSBzdGF0dXMKICAgKiAgICAgICAgICBhIFN0cmluZwogICAqCiAgICovCiAgcHVibGljIHZvaWQgc2V0U3RhdHVzKFN0cmluZyBzdGF0dXMpCiAgewogICAgc2V0U3RhdHVzKHN0YXR1cywgbnVsbCk7CiAgfQoKICAvKioKICAgKiBNZXRob2Qgc2V0U3RhdHVzIHNldHp0IGRlbiBEb2t1bWVudHN0YXR1cyB1bmQgZGF6dSBlaW5lbiBFaW50cmFnIGluIGRhcwogICAqIFN0YXR1c2xvZwogICAqCiAgICogQHBhcmFtIHN0YXR1cwogICAqICAgICAgICAgIGEgU3RyaW5nCiAgICogQHBhcmFtIHN0YXR1c19sb2cKICAgKiAgICAgICAgICBhIFN0cmluZwogICAqCiAgICovCiAgcHVibGljIHZvaWQgc2V0U3RhdHVzKFN0cmluZyBzdGF0dXMsIFN0cmluZyBzdGF0dXNfbG9nKQogIHsKICAgIHRoaXMuc3RhdHVzID0gUGxtQ2hhbmdlT2JqZWN0LmdldE5ld1ZhbHVlSWZDaGFuZ2VkKHRoaXMuc3RhdHVzLCBzdGF0dXMsIHRoaXMsIG5ldyBTdHJpbmdbXSB7IlNUQVRVU0VYVEVSTiIsICJTVEFUVVNJTlRFUk4ifSk7CgogICAgaWYgKGhhc0NvbnRlbnQoc3RhdHVzX2xvZykpCiAgICB7CiAgICAgIC8vQXZvaWQgTnVsbFBvaW50ZXIgd2hpY2ggY2FuIG9jY3VyIGlmIHRoZSBzdGF0dXMgaGFzIG5vdCBjaGFuZ2VkID0+IG9DaGFuZ2VPYmplY3QgaXMgbnVsbCBpbiB0aGlzIGNhc2UuCiAgICAgIFBsbUNoYW5nZURvY3VtZW50IGNoYW5nZURvY3VtZW50ID0gKFBsbUNoYW5nZURvY3VtZW50KSBnZXRDaGFuZ2VPYmplY3QoKTsKICAgICAgY2hhbmdlRG9jdW1lbnQuY2hTdGF0dXNMb2cgPSBzdGF0dXNfbG9nOwogICAgfQogIH0KCiAgLyoqCiAgICogZ2lidCBkYXMgTGFib3JhdG9yeS9PZmZpY2UgenVydWVjawogICAqLwogIHB1YmxpYyBTdHJpbmcgZ2V0T2ZmaWNlKCkKICB7CiAgICByZXR1cm4gb2ZmaWNlOwogIH0KCiAgLyoqCiAgICogc2V0enQgZGFzIERva3VtZW50IExhYm9yYXRvcnkvT2ZmaWNlCiAgICoKICAgKi8KICBwdWJsaWMgdm9pZCBzZXRPZmZpY2UoU3RyaW5nIG9mZmljZSkKICB7CiAgICB0aGlzLm9mZmljZSA9IFBsbUNoYW5nZU9iamVjdC5nZXROZXdWYWx1ZUlmQ2hhbmdlZCh0aGlzLm9mZmljZSwgb2ZmaWNlLCB0aGlzLCAiTEFCT1JBVE9SWSIpOwogIH0KCiAgLyoqCiAgICogUmV2aXNpb25MZXZlbCBvZiB0aGUgZG9jdW1lbnQKICAgKi8KICBwdWJsaWMgU3RyaW5nIGdldFJldkxldmVsKCkKICB7CiAgICByZXR1cm4gcmV2TGV2ZWw7CiAgfQoKICAvKioKICAgKiBSZXZpc2lvbkxldmVsIG9mIHRoZSBkb2N1bWVudAogICAqLwogIHB1YmxpYyB2b2lkIHNldFJldkxldmVsKFN0cmluZyB2YWwpCiAgewogICAgdGhpcy5yZXZMZXZlbCA9IFBsbUNoYW5nZU9iamVjdC5nZXROZXdWYWx1ZUlmQ2hhbmdlZCh0aGlzLnJldkxldmVsLCB2YWwsIHRoaXMsICJSRVZMRVZFTCIpOwogIH0KCiAgcHVibGljIFN0cmluZyBnZXRDbGFzc2lmaWNhdGlvbkZsYWcoKQogIHsKICAgIHJldHVybiBjbGFzc2lmaWNhdGlvbkZsYWc7CiAgfQoKICAvKioKICAgKiBHZXQgdGhlIEFwcGxpY2F0aW9uIHR5cGUuIExvb2tzIGluIFVzZXJkZWZpbmVkNCBmaWVsZCBhbmQgdGFrZXMgYWxsIGNoYXJzCiAgICogdW50aWwgdGhlIGNoYXIgJzonLgogICAqCiAgICogQHJldHVybiBhcHBsaWNhdGlvbiB0eXBlIGZvciB0aGUgZG9jdW1lbnQgb3IgZW1wdHkgaWYgbm90IHNldCAvIHZhbGlkCiAgICovCiAgcHVibGljIFN0cmluZyBnZXRBcHBsaWNhdGlvblR5cGUoKQogIHsKICAgIC8vIGdldCB0aGUgYXBwbGljYXRpb24gdHlwZSBmcm9tIHRoZSByZXM0IGZpZWxkIC0gZS5nLiBVR1M6UAogICAgU3RyaW5nIHJlczQgPSBnZXRVc2VyRGVmaW5lZDQoKTsKICAgIHJldHVybiAoZ2V0QXBwbGljYXRpb25UeXBlKHJlczQsIGdldFR5cGUoKSkpOwogIH0KCiAgLyoqCiAgICogR2V0IHRoZSBBcHBsaWNhdGlvbiB0eXBlLiBMb29rcyBpbiB1c2VyZGVmaW5lZDQgZmllbGQgYW5kIHRha2VzIGFsbCBjaGFycwogICAqIHVudGlsIHRoZSBjaGFyICc6Jy4KICAgKgogICAqIEByZXR1cm4gYXBwbGljYXRpb24gdHlwZSBmb3IgdGhlIGdpdmVuIHVzZXJkZWZpbmVkNAogICAqLwogIHB1YmxpYyBzdGF0aWMgU3RyaW5nIGdldEFwcGxpY2F0aW9uVHlwZShTdHJpbmcgdXNlcmRlZmluZWQ0LCBTdHJpbmcgZG9jdW1lbnRfdHlwZSkKICB7CiAgICBpZiAoaGFzQ29udGVudCh1c2VyZGVmaW5lZDQpKQogICAgewogICAgICBpbnQgaW5kID0gdXNlcmRlZmluZWQ0LmluZGV4T2YoIjoiKTsKCiAgICAgIGlmIChpbmQgPiAtMSkKICAgICAgewogICAgICAgIFN0cmluZyBhcHBsdHlwZSA9IHVzZXJkZWZpbmVkNC5zdWJzdHJpbmcoMCwgaW5kKTsKICAgICAgICByZXR1cm4gYXBwbHR5cGU7CiAgICAgIH0KICAgICAgZWxzZQogICAgICAgIHJldHVybiAiIjsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgLy8gY2hlY2sgaWYgdGhlcmUgYXJlIGRlZmF1bHQgc2V0dGluZ3MgZm9yIHRoZSBkb2N1bWVudCB0eXBlIGluIHRoZQogICAgICAvLyBwcmVmZXJlbmVjZXMKICAgICAgU3RyaW5nIHJlczRfcHJlZiA9IGdldFByZWZlcmVuY2UoInBsbS5jb250cm9sLmVtcHR5LnVzZXJkZWZpbmVkNC4iICsgZG9jdW1lbnRfdHlwZSwgInBsbS5jb250cm9sLmVtcHR5LnVzZXJkZWZpbmVkNC5kZWZhdWx0Iik7CiAgICAgIGlmIChoYXNDb250ZW50KHJlczRfcHJlZikpCiAgICAgICAgcmV0dXJuIGdldEFwcGxpY2F0aW9uVHlwZShyZXM0X3ByZWYsIGRvY3VtZW50X3R5cGUpOwogICAgICBlbHNlCiAgICAgICAgcmV0dXJuICIiOwogICAgfQogIH0KCiAgLyoqCiAgICogRXh0cmFjdHMgdGhlIG9iamVjdCB0eXBlIG91dCBvZiB1c2VyZGVmaW5lZDQgZmllbGQsIGUuZy4gIlVHUzpQIiAtLT4gIlAiCiAgICoKICAgKiBAcmV0dXJuIG9iamVjdCB0eXBlLCBlLmcuICJBIiwgIlAiLCAiRCIKICAgKi8KICBwdWJsaWMgU3RyaW5nIGdldFVzZXJEZWZpbmVkNE9iamVjdFR5cGUoKQogIHsKICAgIHJldHVybiBnZXRVc2VyRGVmaW5lZDRPYmplY3RUeXBlKGdldFVzZXJEZWZpbmVkNCgpKTsKICB9CgogIHB1YmxpYyBzdGF0aWMgU3RyaW5nIGdldFVzZXJEZWZpbmVkNE9iamVjdFR5cGUoU3RyaW5nIHJlczQpCiAgewogICAgU3RyaW5nIHJlc3VsdCA9ICIiOwogICAgaWYgKGhhc0NvbnRlbnQocmVzNCkpCiAgICB7CiAgICAgIGludCBpbmQgPSByZXM0LmluZGV4T2YoIjoiKTsKCiAgICAgIGlmIChpbmQgPiAtMSkKICAgICAgewogICAgICAgIHRyeQogICAgICAgIHsKICAgICAgICAgIHJlc3VsdCA9IHJlczQuc3Vic3RyaW5nKGluZCArIDEpOwogICAgICAgIH0KICAgICAgICBjYXRjaCAoSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiBlKQogICAgICAgIHsKICAgICAgICAgIC8qdGhlbiB0aGUgcmVzdWx0IGlzIGxlZnQgYXMgaXQgaXMgLSBlbXB0eSBzdHJpbmcuKi8KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICBwdWJsaWMgYm9vbGVhbiBoYXNWZXJzaW9uKCkKICB7CiAgICBpZiAoaXNGYW1pbHlNZW1iZXIoKSkKICAgIHsKICAgICAgaWYgKGdldEZhbWlseSgpLmVxdWFscyhQbG1Eb2N1bWVudC5GQU1JTFlfTUVNQkVSX1ZFUlNJT04pKQogICAgICAgIHJldHVybiB0cnVlOwogICAgICBlbHNlCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvKioKICAgKgogICAqIEByZXR1cm4gY2hlY2tvdXQgc2l6ZSBhcyBkZXRlcm1pbmVkIGluIEFCQVAKICAgKi8KICBwdWJsaWMgbG9uZyBnZXRDaGVja291dFNpemUoKQogIHsKICAgIHJldHVybiBjaGVja291dFNpemU7CiAgfQoKICAvKioKICAgKiBSZXR1cm5zIHRoZSBtYXN0ZXIgd29ya3N0YXR0aW9uIGFwcGxpY2F0aW9uIGZvciB0aGlzIGRvY3VtZW50LCBtYXBwZWQgdGhyb3VnaAogICAqIGR0eXBlCiAgICogQHJldHVybiB0aGUgd29ya3N0YXRpb24gYXBwbGljYXRpb24gb3IgbnVsbCBpZiBub3Qgc2V0CiAgICovCiAgcHVibGljIFN0cmluZyBnZXRNYXN0ZXJXb3Jrc3RhdGlvbkFwcGxpY2F0aW9uKCkKICB7CiAgICBTdHJpbmcgd3NhcHBsID0gbnVsbDsKICAgIHRyeQogICAgewogICAgICB3c2FwcGwgPSBnZXRNYXN0ZXJXb3Jrc3RhdGlvbkFwcGxpY2F0aW9uKGdldERUeXBlSWQoKSk7CiAgICB9CiAgICBjYXRjaCAoRGVmYXVsdExvZ0V4Y2VwdGlvbiBkbGUpCiAgICB7CiAgICAgIFRyYWNlLnByaW50bG5TdGFja1RyYWNlKFRyYWNlLlRSQUNFLCBkbGUpOwogICAgfQogICAgcmV0dXJuIHdzYXBwbDsKICB9CgogIC8qKgogICAqIEdldCB0aGUgb3JpZ2luYWwgZmlsZSBmcm9tIGEgRG9jdW1lbnQuPGJyPgogICAqIDwvYnI+IFVzZXMgZ2V0QXBwbGljYXRpb25UeXBlKCkgYW5kIGdldFdzQXBwbCgpLiBJZiBubyBtYXN0ZXIgb3JpZ2luYWwgaXMKICAgKiBhdmFpbGFibGUsIHRoZW4gaXQgd2lsbCBiZSBsb29rZWQgaW50byB0aGUgQ2hlY2tpbi9jaGVja291dCBpbmZvcyBpZiB0aGVyZQogICAqIGlzIG9uZSBkZWZpbmVkLgogICAqCiAgICogQHJldHVybiBQbG1GaWxlIHJlcHJlc2VudGluZyB0aGUgb3JpZ2luYWwgYXBwbGljYXRpb24gZmlsZSwgbnVsbCBpZiBubwogICAqICAgICAgICAgbWF0Y2hpbmcgT3JpZ2luYWwgd2FzIGZvdW5kCiAgICovCiAgcHVibGljIFBsbUZpbGUgZ2V0TWFzdGVyT3JpZ2luYWwoKQogIHsKICAgIFN0cmluZyB3c2FwcGwgPSBnZXRNYXN0ZXJXb3Jrc3RhdGlvbkFwcGxpY2F0aW9uKCk7CgogICAgLy8gZ2V0IHRoZSBmaWxlcyAod3NhcHBsIGNhbiBiZSBudWxsIGlmIHRoZXJlIGlzIG5vIHZhbGlkIHJlczQgaW5mbyBvcgogICAgLy8gbm8gZmlsZSB3aXRoIHRoYXQgd3NhcHBsIGluIHRlaCBrcHJvCiAgICBWZWN0b3I8UGxtRmlsZT4gb3JpZ2luYWxzID0gZ2V0RmlsZXMod3NhcHBsKTsKICAgIGlmIChoYXNOb0l0ZW1zKG9yaWdpbmFscykpCiAgICB7CiAgICAgIFRyYWNlLnByaW50bG4oVHJhY2UuTU9SRV9ERUJVRywgIk5vIG9yaWdpbmFscyB3aXRoIG1hc3RlciB3b3Jrc3RhdGlvbiBhcHBsaWNhdGlvbi4gRGV0ZXJtaW5lIHZpYSBDaGVja2luL291dCBpbmZvcm1hdGlvbiBvYmplY3QuIik7CiAgICAgIC8vIHRoZXJlIGlzIG5vIG1hc3RlciBmaWxlIGF2YWlsYWJsZSB3aXRoIHRoZSBkZWZpbmVkIG1hc3RlciB3c2FwcGwKICAgICAgLy8gKGZyb20gdGhlIHByZWZlcmVuY2VzKS4gVHJ5IHRvIGRldGVybWluZSB0aGUgbWFzdGVyIGZpbGUgdmlhIHRoZQogICAgICAvLyBjaGVja2luIGluZm9ybWF0aW9uCiAgICAgIEl0ZXJhdG9yPFBsbUZpbGU+IGl0ID0gZ2V0RmlsZXMoKS5nZXRQbG1PYmplY3RzKCkuaXRlcmF0b3IoKTsKICAgICAgd2hpbGUgKGl0Lmhhc05leHQoKSkKICAgICAgewogICAgICAgIFBsbUZpbGUgZmlsZSA9IGl0Lm5leHQoKTsKICAgICAgICBUcmFjZS5wcmludGxuKFRyYWNlLk1PUkVfREVCVUcsICJGaWxlICIgKyBmaWxlKTsKICAgICAgICBpZiAoZmlsZS5nZXRDaGVja0luSW5mb3JtYXRpb24oKS5pc01hc3RlckZpbGUoKSB8fCBmaWxlLmdldENoZWNrT3V0SW5mb3JtYXRpb24oKS5pc01hc3RlckZpbGUoKSkKICAgICAgICB7CiAgICAgICAgICBUcmFjZS5wcmludGxuKFRyYWNlLk1PUkVfREVCVUcsICIgIGlzTWFzdGVyOiB0cnVlIik7CiAgICAgICAgICByZXR1cm4gZmlsZTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgIFRyYWNlLnByaW50bG4oVHJhY2UuTU9SRV9ERUJVRywgIiAgaXNNYXN0ZXI6IGZhbHNlIik7CiAgICAgICAgfQogICAgICB9CiAgICAgIC8vIG5vdCBldmVuIGEgbWFzdGVyIGZpbGUgaXMgZGVmaW5lZCBpbiB0aGUgY2hlY2tpbiBpbmZvCiAgICAgIFRyYWNlLnByaW50bG4oVHJhY2UuSU1QT1JUQU5ULAogICAgICAgICAgIk5vIE9yaWdpbmFsIGZvciBEb2N1bWVudDogIiArIGdldFNhcEtleSgpICsgIiB3aXRoIFdTQVBQTCA9ICIgKyBnZXRNYXN0ZXJXb3Jrc3RhdGlvbkFwcGxpY2F0aW9uKCkgKyAiIGZvdW5kLiIpOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgaW50IHNpemUgPSBvcmlnaW5hbHMuc2l6ZSgpOwogICAgICBpZiAoc2l6ZSA9PSAxKQogICAgICB7CiAgICAgICAgLy8gdGhlcmUgc2hvdWxkIGJlIG9ubHkgb25lIG9yaWdpbmFsIGZpbGUgIQogICAgICAgIFBsbUZpbGUgZmlsZSA9IG9yaWdpbmFscy5maXJzdEVsZW1lbnQoKTsKICAgICAgICByZXR1cm4gZmlsZTsKICAgICAgfQogICAgICBlbHNlCiAgICAgIHsKICAgICAgICAvLyBzb21laG93IHdlIGhhdmUgbW9yZSB0aGFuIE9ORSBNYXN0ZXIgT3JpZ2luYWwgISEgVGhpcyBiYXNpY2FsbHkKICAgICAgICAvLyBzaG91bGRuJ3QgaGFwcGVuLCBidXQgZHVyaW5nIHRoZSBjaGVja2luIHByb2Nlc3MgaXQgaXMgcG9zc2libGUuCiAgICAgICAgLy8gRm9sbG93aW5nIHNjZW5hcmlvOgogICAgICAgIC8vIENyZWF0ZSBhIFBhcnQgQS4gQWRkIGEgY29tcG9uZW50IEIgdG8gdGhhdCBwYXJ0LgogICAgICAgIC8vIC0gUGFydCBBIGlzIGNyZWF0ZWQgKGZpbGVuYW1lIGluIEtwcm8gd2lsbCBiZSB0ZW1wbGF0ZS5wcnQhKQogICAgICAgIC8vIC0gUGFydCBBIG11c3QgYmUgc2F2ZWQuIFRoZSBkb2N1bWVudCBzdHJ1Y3R1cmUgd2lsbCBiZSB1cGRhdGVkCiAgICAgICAgLy8gLSBldmVyeXRoaW5nIG9rIHRpbGwgaGVyZQogICAgICAgIC8vIC0gdGhlIHJlczQgbXVzdCBiZSBjaGFuZ2VkIGZyb20gVUdTOlAgdG8gVUdTOkEgKGRvbmUgdmlhIGRvYy5mbHVzaCgpKQogICAgICAgIC8vIC0gbm93IGEgQkFQSV9HRVRfREVUQUlMIGlzIGNhbGxlZAogICAgICAgIC8vIC0gdGhlIGRvY3VtZW50IHdpbGwgYmUgdXBkYXRlZCB3aXRoIHRoZSBpbmZvcyBmcm9tIHRoZSBkZXRhaWwKICAgICAgICAvLyAtIGhlcmUgd2UgZG9uJ3QgZmluZCB0aGUgb2xkIG9yaWdpbmFsIChiZWNhdXNlIGl0IGhhcyBhCiAgICAgICAgLy8gZGlmZmVyZW50IGFwcGxpZCAvIGZpbGVpZCAtIGFuZCBldmVuIHRoZSByZWwgbmFtZXMgYXJlIG5vdCB0aGUgc2FtZQogICAgICAgIC8vIChyZWxfbmFtZSBpbiBkb2MgPSB0ZW1wbGF0ZS5wcnQsIHJldHVybmVkIGZyb20gQkFQSSA9CiAgICAgICAgLy8gMTUwN3VtazAwMF8wMC5wcnQpCiAgICAgICAgLy8gLSBub3cgYSAybmQgb3JpZ2luYWwgZmlsZSBpcyBhZGRlZAoKICAgICAgICAvLyBob3cgdG8gc29sdmUgdGhpcyA/CiAgICAgICAgLy8gaSByZWFkIHRoZSBjaGVja2luaW5mb3JtYXRpb24gZnJvbSBib3RoIGZpbGVzIGFuZCBjaGVjayB3aGljaCBvZgogICAgICAgIC8vIHRoZW0gaXMgaW5pdGlhbGl6ZWQgKGhhcyBzZXQgdmFsdWVzKS4gSSB3aWxsIHJldHVybiB0aGUgUGxtRmlsZQogICAgICAgIC8vIHdoZXJlIHRoZSBDaGVja2luaW5mbyBpcyB2YWxpZCAhIQoKICAgICAgICAvLyB0YWtlIHRoZSBmaXJzdCBmaWxlIGFzIGRlZmF1bHQKICAgICAgICBQbG1GaWxlIHBmX3JldCA9IG9yaWdpbmFscy5maXJzdEVsZW1lbnQoKTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzaXplOyBpKyspCiAgICAgICAgewogICAgICAgICAgUGxtRmlsZSBwZiA9IG9yaWdpbmFscy5lbGVtZW50QXQoaSk7CgogICAgICAgICAgLy8gaSB3aWxsIEFMV0FZUyBnZXQgYSBvYmplY3QgYmFjayBmcm9tIHRoaXMgbWV0aG9kLgogICAgICAgICAgUGxtQ2hlY2tJbkluZm9ybWF0aW9uIGNpaSA9IHBmLmdldENoZWNrSW5JbmZvcm1hdGlvbigpOwoKICAgICAgICAgIC8vIHRoZSBwYXJ0aGFuZGxlciBtb2RlIG11c3QgYmUgZ3JlYXRlciB0aGFuIC0xICwgdGhlbiB0aGUKICAgICAgICAgIC8vIGNoZWNraW5pbmZvcm1hdGlvbiBpIGdvdCB3YXMgaW5pdGlhbGl6ZWQgYnkgdGhlIHByb2Nlc3MKICAgICAgICAgIC8vIHByZXZpb3VzbHkKICAgICAgICAgIGlmIChjaWkuZ2V0UGFydEhhbmRsZXJNb2RlKCkgIT0gLTEpCiAgICAgICAgICB7CiAgICAgICAgICAgIHBmX3JldCA9IHBmOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHBmX3JldDsKICAgICAgfQogICAgfQogIH0KCiAgLyoqCiAgICogR2V0IHRoZSBjaGVja2luIGluZm9ybWF0aW9uIG9iamVjdCBmb3IgdGhlIE1hc3RlciBGaWxlIG9mIHRoaXMgZG9jdW1lbnQuCiAgICogPGJyPgogICAqIDwvYnI+VGhpcyBvYmplY3QgaXMgZmlsbGVkIHdpdGggaW5mb3JtYXRpb25zIGR1cmluZyB0aGUgd2hvbGUgY2hlY2sgaW4KICAgKiBwcm9jZXNzLiBJdCBhbHNvIGNvbnRyb2xzIHdoYXQgd2lsbCBiZSBkb25lIC8gaGFzIHRvIGJlIGRvbmUgd2l0aCB0aGlzCiAgICogUGxtRmlsZSBpbiB0aGUgZnV0dXJlLgogICAqCiAgICogQHJldHVybiBDaGVja0luSW5mb3JtYXRpb24gLSBmb3IgbWFzdGVyIG9yaWdpbmFsCiAgICovCiAgcHVibGljIFBsbUNoZWNrSW5JbmZvcm1hdGlvbiBnZXRNYXN0ZXJDaGVja0luSW5mb3JtYXRpb24oKQogIHsKICAgIFBsbUZpbGUgZm1hc3RlciA9IGdldE1hc3Rlck9yaWdpbmFsKCk7CiAgICBpZiAoZm1hc3RlciAhPSBudWxsKQogICAgICByZXR1cm4gZm1hc3Rlci5nZXRDaGVja0luSW5mb3JtYXRpb24oKTsKICAgIGVsc2UKICAgICAgcmV0dXJuIG51bGw7CiAgfQoKICAvKioKICAgKiBHZXQgdGhlIGNoZWNrb3V0IGluZm9ybWF0aW9uIG9iamVjdCBmb3IgdGhlIE1hc3RlciBGaWxlIG9mIHRoaXMgZG9jdW1lbnQuCiAgICogPGJyPgogICAqIDwvYnI+VGhpcyBvYmplY3QgaXMgZmlsbGVkIHdpdGggaW5mb3JtYXRpb25zIGR1cmluZyB0aGUgd2hvbGUgY2hlY2sgb3V0CiAgICogcHJvY2Vzcy4gSXQgYWxzbyBjb250cm9scyB3aGF0IHdpbGwgYmUgZG9uZSAvIGhhcyB0byBiZSBkb25lIHdpdGggdGhpcwogICAqIFBsbUZpbGUgaW4gdGhlIGZ1dHVyZS4KICAgKgogICAqIEByZXR1cm4gQ2hlY2tPdXRJbmZvcm1hdGlvbiAtIGZvciBtYXN0ZXIgb3JpZ2luYWwKICAgKi8KICBwdWJsaWMgUGxtRmlsZS5DaGVja091dEluZm9ybWF0aW9uIGdldE1hc3RlckNoZWNrT3V0SW5mb3JtYXRpb24oKQogIHsKICAgIFBsbUZpbGUgZm1hc3RlciA9IGdldE1hc3Rlck9yaWdpbmFsKCk7CiAgICBpZiAoZm1hc3RlciAhPSBudWxsKQogICAgICByZXR1cm4gZm1hc3Rlci5nZXRDaGVja091dEluZm9ybWF0aW9uKCk7CiAgICBlbHNlCiAgICAgIHJldHVybiBudWxsOwogIH0KCiAgLyoqCiAgICogUmVzZXQgYWxsIENoZWNrT3V0SW5mb3JtYXRpb24gb2JqZWN0cy4gQWxsIHN0b3JlZCB2YWx1ZXMgd2lsbCBiZSBzZXQgYmFjawogICAqIHRvIGRlZmF1bHQuCiAgICovCiAgcHVibGljIHZvaWQgcmVzZXRBbGxDaGVja091dEluZm9ybWF0aW9uKCkKICB7CiAgICBDb2xsZWN0aW9uPFBsbUZpbGU+IGNvbCA9IGdldEZpbGVzKCkuZ2V0UGxtT2JqZWN0cygpOwogICAgaWYgKGhhc0l0ZW1zKGNvbCkpCiAgICB7CiAgICAgIGZvciAoUGxtRmlsZSBwZmlsZSA6IGNvbCkKICAgICAgewogICAgICAgIHBmaWxlLnJlc2V0Q2hlY2tPdXRJbmZvcm1hdGlvbigpOwogICAgICB9CiAgICB9CiAgfQoKICAvKioKICAgKiBSZXNldCBhbGwgQ2hlY2tPdXRJbmZvcm1hdGlvbiBvYmplY3RzLiBBbGwgc3RvcmVkIHZhbHVlcyB3aWxsIGJlIHNldCBiYWNrCiAgICogdG8gZGVmYXVsdC4KICAgKi8KICBwdWJsaWMgdm9pZCByZXNldEFsbENoZWNrSW5JbmZvcm1hdGlvbigpCiAgewogICAgQ29sbGVjdGlvbjxQbG1GaWxlPiBjb2wgPSBnZXRGaWxlcygpLmdldFBsbU9iamVjdHMoKTsKICAgIGlmIChoYXNJdGVtcyhjb2wpKQogICAgewogICAgICBmb3IgKFBsbUZpbGUgcGZpbGUgOiBjb2wpCiAgICAgIHsKICAgICAgICBwZmlsZS5yZXNldENoZWNrSW5JbmZvcm1hdGlvbigpOwogICAgICB9CiAgICB9CiAgfQoKICAvKioKICAgKiBNZXRob2QgZ2V0QWRkaXRpb25hbEZpbGVzIGdldCBhbGwgRmlsZXMgZXhjbHVkZWQgdGhlIG1hc3RlciBmaWxlCiAgICoKICAgKiBAcmV0dXJuIGEgVmVjdG9yIG9mIFBsbUZpbGVzCiAgICoKICAgKi8KICBwdWJsaWMgVmVjdG9yPFBsbUZpbGU+IGdldEFkZGl0aW9uYWxGaWxlcygpCiAgewogICAgVmVjdG9yPFBsbUZpbGU+IHJldHVybl92ZWMgPSBuZXcgVmVjdG9yPFBsbUZpbGU+KCk7CiAgICBTdHJpbmcgd3NhcHBsID0gZ2V0TWFzdGVyV29ya3N0YXRpb25BcHBsaWNhdGlvbigpOwogICAgaWYgKHdzYXBwbCA9PSBudWxsKQogICAgICByZXR1cm4gcmV0dXJuX3ZlYzsKCiAgICAvLyBnZXQgdGhlIGZpbGVzCiAgICBJdGVyYXRvcjxQbG1GaWxlPiBpdGVyID0gZ2V0RmlsZXMoKS5nZXRQbG1PYmplY3RzKCkuaXRlcmF0b3IoKTsKICAgIHdoaWxlIChpdGVyLmhhc05leHQoKSkKICAgIHsKICAgICAgUGxtRmlsZSBwbG1fZmlsZSA9IGl0ZXIubmV4dCgpOwogICAgICBpZiAocGxtX2ZpbGUgIT0gbnVsbCAmJiAhd3NhcHBsLmVxdWFscyhwbG1fZmlsZS5nZXRXb3Jrc3RhdGlvbkFwcGxpY2F0aW9uKCkpKQogICAgICAgIHJldHVybl92ZWMuYWRkKHBsbV9maWxlKTsKICAgIH0KICAgIHJldHVybiByZXR1cm5fdmVjOwogIH0KCiAgLyoqCiAgICogZ2lidCBkaWUgQmVyZWNodGlndW5nc2dydXBwZSB6dXJ1ZWNrCiAgICovCiAgcHVibGljIFN0cmluZyBnZXRBdXRob3JpemF0aW9uR3JvdXAoKQogIHsKICAgIHJldHVybiBhdXRob3JpemF0aW9uR3JvdXA7CiAgfQoKICAvKioKICAgKiBEZWxldGUgRmxhZwogICAqLwogIHB1YmxpYyBib29sZWFuIGdldERlbGV0ZUZsYWcoKQogIHsKICAgIHJldHVybiBkZWxldGVGbGFnOwogIH0KCiAgLyoqCiAgICogRGVsZXRlIEZsYWcKICAgKi8KICBwdWJsaWMgdm9pZCBzZXREZWxldGVGbGFnKGJvb2xlYW4gdmFsKQogIHsKICAgIHRoaXMuZGVsZXRlRmxhZyA9IFBsbUNoYW5nZU9iamVjdC5nZXROZXdWYWx1ZUlmQ2hhbmdlZCh0aGlzLmRlbGV0ZUZsYWcsIHZhbCwgdGhpcywgIkRFTEVURUlORElDQVRPUiIpOwogIH0KCiAgcHVibGljIGJvb2xlYW4gZ2V0U3RydWN0dXJlRmxhZygpCiAgewogICAgcmV0dXJuIHN0cnVjdHVyZUZsYWc7CiAgfQoKICAvKioKICAgKiBDQUQgRmxhZwogICAqLwogIHB1YmxpYyBib29sZWFuIGdldENhZEluZGljYXRvcigpCiAgewogICAgcmV0dXJuIGNhZEluZGljYXRvcjsKICB9CgogIC8qKgogICAqIHNldCBDQUQgRmxhZwogICAqLwogIHB1YmxpYyB2b2lkIHNldENhZEluZGljYXRvcihib29sZWFuIHZhbCkKICB7CiAgICB0aGlzLmNhZEluZGljYXRvciA9IFBsbUNoYW5nZU9iamVjdC5nZXROZXdWYWx1ZUlmQ2hhbmdlZCh0aGlzLmNhZEluZGljYXRvciwgdmFsLCB0aGlzLCAiQ0FESU5ESUNBVE9SIik7CiAgfQoKICAvKioKICAgKiBzZXQgYXV0aG9yaXphdGlvbiBncm91cAogICAqLwogIHB1YmxpYyB2b2lkIHNldEF1dGhvcml0eUdyb3VwKFN0cmluZyBzKQogIHsKICAgIFN0cmluZyB0bXAgPSBzOwogICAgaWYgKHRtcCA9PSBudWxsKQogICAgICB0bXAgPSAiIjsKCiAgICB0aGlzLmF1dGhvcml6YXRpb25Hcm91cCA9IFBsbUNoYW5nZU9iamVjdC5nZXROZXdWYWx1ZUlmQ2hhbmdlZCh0aGlzLmF1dGhvcml6YXRpb25Hcm91cCwgdG1wLCB0aGlzLCAiQVVUSE9SSVRZR1JPVVAiKTsKICB9CgogIC8qKgogICAqIEByZXR1cm4gdHJ1ZSBpZiBkb2MgaGFzIG1vcmUgdGhhbiBvbmUgbWF0bGluawogICAqLwogIHB1YmxpYyBib29sZWFuIGhhc01vcmVUaGFuT25lTWF0ZXJpYWxMaW5rKCkKICB7CiAgICByZXR1cm4gIVN0cmluZ1Rvb2wuZ2V0U3RyaW5nT3JFbXB0eShoYXNNb3JlVGhhbk9uZUxpbmtlZE1hdGVyaWFsKS50cmltKCkuaXNFbXB0eSgpOwogIH0KCiAgLyoqCiAgICogQHJldHVybiB0cnVlIGlmIHRoZXJlIGlzIG1vcmUgdGhhbiBvbmUgbWF0bGluayBidXQgbm9uZSBvZiB0aGVtIGlzIHNpZ25lZAogICAqLwogIHB1YmxpYyBib29sZWFuIGhhc0FtYmlndW91c011bHRpTWF0bGlua3MoKQogIHsKICAgIHJldHVybiAiWCIuZXF1YWxzKGhhc01vcmVUaGFuT25lTGlua2VkTWF0ZXJpYWwpOwogIH0KCiAgLyoqCiAgICogQHJldHVybiB0cnVlIGlmIHRoZXJlIGlzIG1vcmUgdGhhbiBvbmUgbWF0bGluayBhbmQgb25lIG9mIHRoZW0gaXMgc2lnbmVkCiAgICovCiAgcHVibGljIGJvb2xlYW4gaGFzU2lnbmVkTXVsdGlNYXRsaW5rcygpCiAgewogICAgcmV0dXJuICJTIi5lcXVhbHMoaGFzTW9yZVRoYW5PbmVMaW5rZWRNYXRlcmlhbCk7CiAgfQoKICBwdWJsaWMgU3RyaW5nIGdldENvbnZlcnNpb25TdGF0dXMoKQogIHsKICAgIHJldHVybiBjb252ZXJzaW9uU3RhdHVzOwogIH0KCiAgLyoqCiAgICogRnVuY3Rpb24gb25seSBwcm92aWRlZCB0byByZWFkLiBUaGUgY29udHJvbCBvZiB0aGlzIGZpZWxkIGJlbG9uZ3MgdG8gdGhpcwogICAqIGNsYXNzIGFuZCBzaG91bGQgbmV2ZXIgYmUgbW9kaWZpZWQgZnJvbSB0aGUgb3V0c2lkZS4KICAgKi8KICBwdWJsaWMgU3RyaW5nIGdldFVzZXJEZWZpbmVkMSgpCiAgewogICAgcmV0dXJuIHVzZXJEZWZpbmVkMTsKICB9CgogIC8qKgogICAqIEZ1bmN0aW9uIG9ubHkgcHJvdmlkZWQgdG8gcmVhZC4gVGhlIGNvbnRyb2wgb2YgdGhpcyBmaWVsZCBiZWxvbmdzIHRvIHRoaXMKICAgKiBjbGFzcyBhbmQgc2hvdWxkIG5ldmVyIGJlIG1vZGlmaWVkIGZyb20gdGhlIG91dHNpZGUuCiAgICovCiAgcHVibGljIFN0cmluZyBnZXRVc2VyRGVmaW5lZDIoKQogIHsKICAgIHJldHVybiB1c2VyRGVmaW5lZDI7CiAgfQoKICAvKioKICAgKiBGdW5jdGlvbiBvbmx5IHByb3ZpZGVkIHRvIHJlYWQuIFRoZSBjb250cm9sIG9mIHRoaXMgZmllbGQgYmVsb25ncyB0byB0aGlzCiAgICogY2xhc3MgYW5kIHNob3VsZCBuZXZlciBiZSBtb2RpZmllZCBmcm9tIHRoZSBvdXRzaWRlLgogICAqLwogIHB1YmxpYyBTdHJpbmcgZ2V0VXNlckRlZmluZWQzKCkKICB7CiAgICByZXR1cm4gdXNlckRlZmluZWQzOwogIH0KCiAgLyoqCiAgICogVXNlIGdldFVnVHlwZSgpIHRoZSBnZXQgVW5pZ3JhcGhpY3MgcGFydCB0eXBlLiBGdW5jdGlvbiBvbmx5IHByb3ZpZGVkIHRvCiAgICogcmVhZC4gVGhlIGNvbnRyb2wgb2YgdGhpcyBmaWVsZCBiZWxvbmdzIHRvIHRoaXMgY2xhc3MgYW5kIHNob3VsZCBuZXZlciBiZQogICAqIG1vZGlmaWVkIGZyb20gdGhlIG91dHNpZGUuCiAgICovCiAgcHVibGljIFN0cmluZyBnZXRVc2VyRGVmaW5lZDQoKQogIHsKICAgIFN0cmluZyByZXM0ID0gdXNlckRlZmluZWQ0OwoKICAgIGlmICghaGFzQ29udGVudChyZXM0KSkKICAgIHsKICAgICAgLy8gY2hlY2sgaWYgdGhlcmUgYXJlIGRlZmF1bHQgc2V0dGluZ3MgZm9yIHRoZSBkb2N1bWVudCB0eXBlIGluIHRoZQogICAgICAvLyBwcmVmZXJlbmVjZXMKICAgICAgU3RyaW5nIHByZWZfcmVzNCA9IGdldFByZWZlcmVuY2UoInBsbS5jb250cm9sLmVtcHR5LnVzZXJkZWZpbmVkNC4iICsgZ2V0VHlwZSgpLCAicGxtLmNvbnRyb2wuZW1wdHkudXNlcmRlZmluZWQ0LmRlZmF1bHQiKTsKICAgICAgaWYgKGhhc0NvbnRlbnQocHJlZl9yZXM0KSkKICAgICAgICByZXM0ID0gU3RyaW5nVG9vbC50b1VwcGVyQ2FzZShwcmVmX3JlczQpOwogICAgfQogICAgcmV0dXJuIHJlczQ7CiAgfQoKICAvKioKICAgKiBNZXRob2QgaXNWYWxpZFBsbURvY3VtZW50IEVzIHdpcmQgZGFzIFJFUzQsIGRlciBNYXN0ZXIgdW5kIGRlciBTdXB0eXBlCiAgICogZ2VwcnVlZnQsIG9iIG51bGwgb2RlciBsZWVyLgogICAqCiAgICogQHJldHVybiBhIGJvb2xlYW4KICAgKgogICAqLwogIHB1YmxpYyBib29sZWFuIGlzVmFsaWRQbG1Eb2N1bWVudCgpCiAgewogICAgYm9vbGVhbiB2YWxpZCA9IGhhc0NvbnRlbnQoZ2V0VXNlckRlZmluZWQ0KCkpICYmIGhhc0NvbnRlbnQoZ2V0TWFzdGVyKCkpICYmIGhhc0NvbnRlbnQoZ2V0U3VidHlwZSgpKTsKICAgIHJldHVybiB2YWxpZDsKICB9CgogIC8qKgogICAqIGdldCB0aGUgSUQgb2YgdGhlIHJlbGF0ZWQgRFR5cGUgZW50cnkKICAgKgogICAqIEByZXR1cm4gZS5nLiAiRUlOWkUiIG9yICJGRVJUSSIgb3IgIkRSQVciIC4uLgogICAqIEB0aHJvdyBEZWZhdWx0TG9nRXhjZXB0aW9uIEUwMjAwMiAtIFJlczMgbm90IHNldAogICAqIEB0aHJvdyBEZWZhdWx0TG9nRXhjZXB0aW9uIEUwMjAwMyAtIFJlczMgY29udGFpbnMgaW52YWxpZCB2YWx1ZQogICAqLwogIHB1YmxpYyBTdHJpbmcgZ2V0RFR5cGVJZCgpCiAgewogICAgcmV0dXJuIGdldFN1YnR5cGUoKTsKICB9CgogIC8qKgogICAqIFNldCB0aGUgUExNKysgRFR5cGUgRGVmaW5pdGlvbiBJZGVudGlmaWVyLiAobWF4IDUgY2hhcnMpCiAgICovCiAgcHVibGljIHZvaWQgc2V0RFR5cGVJZChTdHJpbmcgaWQpCiAgewogICAgaWYgKGlkLmxlbmd0aCgpIDw9IDUpCiAgICB7CiAgICAgIGluaXRDaGFuZ2VEb2MoKTsKICAgICAgc2V0U3VidHlwZShpZCk7CiAgICB9CiAgfQoKICAvKioKICAgKiBTZXQgaWYgdGhlIERvY3VtZW50IGlzIGEgTWFzdGVyIG1vZGVsIG9yIGEgTm9uIE1hc3RlciBtb2RlbAogICAqCiAgICogQHBhcmFtIGIKICAgKiAgICAgICAgICB0cnVlIGlmIGl0IGlzIGEgbWFzdGVyIG1vZGVsLCBmYWxzZSBpZiBpdCBpcyBhIE5vbiBtYXN0ZXIgbW9kZWwKICAgKgogICAqLwogIHB1YmxpYyB2b2lkIHNldE1hc3Rlcihib29sZWFuIGIpCiAgewogICAgc2V0TWFzdGVyKGIgPyBNQVNURVIgOiBOT05NQVNURVIpOwogIH0KCiAgLyoqCiAgICogU2V0IHRoZSBDYWREZXNrdG9wIGlkZW50aWZpZXIgZGVmaW5pbmcgdGhlIHR5cGUgb2YgdGhlIGRvY3VtZW50LiBlLmcuIFVHUzpQCiAgICogVGhlIGlkIE1VU1QgYmUgaW4gdGhlIGZvcm0gW0EtWl1bQS1aXVtBLVpdOi4qCiAgICovCiAgcHVibGljIHZvaWQgc2V0Q2FkRGVza3RvcElEKFN0cmluZyBpZCkgdGhyb3dzIFBhdHRlcm5TeW50YXhFeGNlcHRpb24KICB7CiAgICBib29sZWFuIG1hdGNoID0gaWQgIT0gbnVsbCAmJiBpZC5tYXRjaGVzKENBRElEUEFUVEVSTik7CiAgICBpZiAobWF0Y2gpCiAgICB7CiAgICAgIHRoaXMudXNlckRlZmluZWQ0ID0gUGxtQ2hhbmdlT2JqZWN0LmdldE5ld1ZhbHVlSWZDaGFuZ2VkKHRoaXMudXNlckRlZmluZWQ0LCBpZCwgdGhpcywgIlVTRVJERUZJTkVENCIpOwogICAgfQogICAgZWxzZQogICAgICBUcmFjZS5wcmludGxuKFRyYWNlLkhFQUQsCiAgICAgICAgICAiUGxtRG9jdW1lbnQuc2V0Q2FkRGVza3RvcElEKCIgKyBpZCArICIpOiB0aGUgZ2l2ZW4gaWQgZG9lcyBub3QgbWF0Y2ggdGhlIHBhdHRlcm4gIiArIENBRElEUEFUVEVSTiArICIgLCBpZ25vcmVkLiIpOwoKICB9CgogIC8qKgogICAqIE1ldGhvZCBjaGFuZ2VDYWREZXNrdG9wSUR0b0Fzc2VtYmx5IG1ha2VzIGEgIlVHUzpBIiBvdXQgb2YgYSAiVUdTOlAiCiAgICovCiAgcHVibGljIHZvaWQgY2hhbmdlQ2FkRGVza3RvcElEdG9Bc3NlbWJseSgpCiAgewogICAgU3RyaW5nIGlkX2Z1bGwgPSBnZXRVc2VyRGVmaW5lZDQoKTsKICAgIGlmIChpZF9mdWxsID09IG51bGwgfHwgIiIuZXF1YWxzKGlkX2Z1bGwpKQogICAgICByZXR1cm47CiAgICAvLyBVR1M6UAogICAgU3RyaW5nIGlkX2VuZCA9IGlkX2Z1bGwuc3Vic3RyaW5nKGlkX2Z1bGwuaW5kZXhPZignOicpKTsKICAgIFN0cmluZyBpZF9zdGFydCA9IGlkX2Z1bGwuc3Vic3RyaW5nKDAsIGlkX2Z1bGwuaW5kZXhPZignOicpKTsKICAgIFN0cmluZyBpZF90ZW1wID0gaWRfZW5kOwogICAgaWRfZW5kID0gaWRfZW5kLnJlcGxhY2UoJ1AnLCAnQScpOwogICAgaWYgKGlkX2VuZC5lcXVhbHMoaWRfdGVtcCkpCiAgICAgIGlkX2VuZCA9IGlkX2VuZCArICJBIjsKICAgIHNldENhZERlc2t0b3BJRChpZF9zdGFydCArIGlkX2VuZCk7CiAgfQoKICAvKioKICAgKiBNZXRob2QgY2hhbmdlQ2FkRGVza3RvcElEdG9QYXJ0IG1ha2VzIGEgIlVHUzpQIiBvdXQgb2YgYSAiVUdTOkEiCiAgICovCiAgcHVibGljIHZvaWQgY2hhbmdlQ2FkRGVza3RvcElEdG9QYXJ0KCkgdGhyb3dzIERlZmF1bHRMb2dFeGNlcHRpb24KICB7CiAgICBTdHJpbmcgaWRfZnVsbCA9IGdldFVzZXJEZWZpbmVkNCgpOwogICAgaWYgKGlkX2Z1bGwgPT0gbnVsbCB8fCAiIi5lcXVhbHMoaWRfZnVsbCkgfHwgaXNEcmF3aW5nKCkpCiAgICAgIHJldHVybjsKICAgIC8vIFVHUzpQCiAgICBTdHJpbmcgaWRfZW5kID0gaWRfZnVsbC5zdWJzdHJpbmcoaWRfZnVsbC5pbmRleE9mKCc6JykpOwogICAgU3RyaW5nIGlkX3N0YXJ0ID0gaWRfZnVsbC5zdWJzdHJpbmcoMCwgaWRfZnVsbC5pbmRleE9mKCc6JykpOwogICAgU3RyaW5nIGlkX3RlbXAgPSBpZF9lbmQ7CiAgICBpZF9lbmQgPSBpZF9lbmQucmVwbGFjZSgnQScsICdQJyk7CiAgICBpZiAoaWRfZW5kLmVxdWFscyhpZF90ZW1wKSkKICAgICAgaWRfZW5kID0gaWRfZW5kICsgIlAiOwogICAgc2V0Q2FkRGVza3RvcElEKGlkX3N0YXJ0ICsgaWRfZW5kKTsKICB9CgogIC8qKgogICAqIG1ha2VzIGEgIlVHUzpQRyIgb3V0IG9mIGEgIlVHUzpQIgogICAqLwogIHB1YmxpYyB2b2lkIGNoYW5nZUNhZERlc2t0b3BJRHRvR2VuZXJpYygpCiAgewogICAgU3RyaW5nIGlkX2Z1bGwgPSBnZXRVc2VyRGVmaW5lZDQoKTsKICAgIGlmIChpZF9mdWxsID09IG51bGwgfHwgIiIuZXF1YWxzKGlkX2Z1bGwpKQogICAgICByZXR1cm47CgogICAgaW50IGluZGV4ID0gaWRfZnVsbC5pbmRleE9mKCc6Jyk7CiAgICBpZiAoaW5kZXggIT0gLTEpCiAgICB7CiAgICAgIFN0cmluZyBpZF9lbmQgPSBpZF9mdWxsLnN1YnN0cmluZyhpbmRleCk7CiAgICAgIFN0cmluZyBpZF9zdGFydCA9IGlkX2Z1bGwuc3Vic3RyaW5nKDAsIGlkX2Z1bGwuaW5kZXhPZignOicpKTsKICAgICAgaWYgKGlkX2VuZC5pbmRleE9mKCdnJykgPT0gLTEgJiYgaWRfZW5kLmluZGV4T2YoJ0cnKSA9PSAtMSkKICAgICAgewogICAgICAgIGlkX2VuZCA9IGlkX2VuZCArICJHIjsKICAgICAgICBzZXRDYWREZXNrdG9wSUQoaWRfc3RhcnQgKyBpZF9lbmQpOwogICAgICB9CiAgICB9CiAgfQoKICAvKioKICAgKiBtYWtlcyBhICJVR1M6UCIgb3V0IG9mIGEgIlVHUzpQRyIKICAgKi8KICBwdWJsaWMgdm9pZCByZW1vdmVHZW5lcmljRnJvbUNhZERlc2t0b3BJRCgpCiAgewogICAgU3RyaW5nIGlkX2Z1bGwgPSBnZXRVc2VyRGVmaW5lZDQoKTsKICAgIGlmIChpZF9mdWxsID09IG51bGwgfHwgIiIuZXF1YWxzKGlkX2Z1bGwpKQogICAgICByZXR1cm47CgogICAgaW50IGluZGV4ID0gaWRfZnVsbC5pbmRleE9mKCc6Jyk7CiAgICBpZiAoaW5kZXggIT0gLTEpCiAgICB7CiAgICAgIFN0cmluZyBpZF9zdGFydCA9IGlkX2Z1bGwuc3Vic3RyaW5nKDAsIGluZGV4KTsKICAgICAgU3RyaW5nIGlkX2VuZCA9IGlkX2Z1bGwuc3Vic3RyaW5nKGluZGV4ICsgMSk7CiAgICAgIGlkX2VuZCA9IGlkX2VuZC5yZXBsYWNlKCdHJywgJyAnKTsKICAgICAgaWRfZW5kID0gaWRfZW5kLnJlcGxhY2UoJ2cnLCAnICcpOwogICAgICBzZXRDYWREZXNrdG9wSUQoaWRfc3RhcnQgKyAiOiIgKyBpZF9lbmQudHJpbSgpKTsKICAgIH0KICB9CgogIC8qKgogICAqIERldGVybWluZSBpZiB0aGUgZG9jdW1lbnQgaXMgYSBtYXN0ZXIgbW9kZWwgb3IgYSBub24gbWFzdGVyIG1vZGVsCiAgICoKICAgKiBAcmV0dXJuIHRydWUgaWYgaXRzIGEgbm9uIG1hc3RlciBtb2RlbCwgZmFsc2UgaWYgaXQgaXMgYSBtYXN0ZXIKICAgKi8KICBwdWJsaWMgYm9vbGVhbiBpc05vbk1hc3RlcigpCiAgewogICAgcmV0dXJuIGlzTm9uTWFzdGVyKGdldE1hc3RlcigpKTsKICB9CgogIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBpc05vbk1hc3RlcihTdHJpbmcgbWFzdGVyRmxhZykKICB7CiAgICByZXR1cm4gTk9OTUFTVEVSLmVxdWFscyhtYXN0ZXJGbGFnKTsKICB9CgogIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBpc01hc3RlcihTdHJpbmcgbWFzdGVyRmxhZykKICB7CiAgICByZXR1cm4gIWlzTm9uTWFzdGVyKG1hc3RlckZsYWcpOwogIH0KCiAgLyoqCiAgICogRGV0ZXJtaW5lIGlmIHRoZSBkb2N1bWVudCBpcyBhIG1hc3RlciBtb2RlbCBvciBhIG5vbiBtYXN0ZXIgbW9kZWwKICAgKgogICAqIEByZXR1cm4gdHJ1ZSBpZiBpdHMgYSBtYXN0ZXIgbW9kZWwsIGZhbHNlIGlmIGl0IGlzIGEgbm9uIG1hc3RlcgogICAqLwogIHB1YmxpYyBib29sZWFuIGlzTWFzdGVyKCkKICB7CiAgICByZXR1cm4gIWlzTm9uTWFzdGVyKCk7CiAgfQoKICAvKioKICAgKiBBbnkgaW5mb3JtYXRpb24gYWJvdXQgdGhlIG9yaWdpbmFscyBhdmFpbGFibGUgZnJvbSB0aGUgQ0hFQ0tFRElOIEZsYWcKICAgKgogICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgdmFsdWUgd2FzIHNldCBhbmQgcGFyc2VkIGNvcnJlY3RseQogICAqLwogIHB1YmxpYyBib29sZWFuIGlzRmxhZ0NoZWNrZWRJbkF2YWlsYWJsZSgpCiAgewogICAgLy8gYXQgbGVhc3QgdGhlIHZhbHVlcyBmb3IgbWFzdGVyIG11c3QgYmUgc2V0ICEKICAgIHJldHVybiBpc01hc3Rlck9yaWdpbmFsRXhpc3QoKSAhPSBudWxsICYmIGlzTWFzdGVyT3JpZ2luYWxDaGVja2Vkb3V0KCkgIT0gbnVsbDsKICB9CgogIC8qKgogICAqIG1ha2Ugc3VyZSB0byBjaGVjayBpc0ZsYWdDaGVja2VkSW5BdmFpbGFibGUoKSBmaXJzdCB0byBzZWUgaWYgdGhlIHZhbHVlIGlzIHZhbGlkCiAgICogQHJldHVybiBib29sZWFuCiAgICovCiAgcHVibGljIGJvb2xlYW4gaXNGbGFnTWFzdGVyT3JpZ2luYWxDaGVja2VkT3V0KCkKICB7CiAgICByZXR1cm4gIjEiLmVxdWFsc0lnbm9yZUNhc2UoaXNNYXN0ZXJPcmlnaW5hbENoZWNrZWRvdXQoKSk7CiAgfQoKICAvKioKICAgKiBtYWtlIHN1cmUgdG8gY2hlY2sgaXNGbGFnQ2hlY2tlZEluQXZhaWxhYmxlKCkgZmlyc3QgdG8gc2VlIGlmIHRoZSB2YWx1ZSBpcyB2YWxpZAogICAqIEByZXR1cm4gYm9vbGVhbgogICAqLwogIHB1YmxpYyBib29sZWFuIGlzRmxhZ0FkZGl0aW9uYWxPcmlnaW5hbENoZWNrZWRPdXQoKQogIHsKICAgIHJldHVybiAiMSIuZXF1YWxzSWdub3JlQ2FzZShpc0FkZE9yaWdpbmFsQ2hlY2tlZG91dCgpKTsKICB9CgogIC8qKgogICAqIG1ha2Ugc3VyZSB0byBjaGVjayBpc0ZsYWdDaGVja2VkSW5BdmFpbGFibGUoKSBmaXJzdCB0byBzZWUgaWYgdGhlIHZhbHVlIGlzIHZhbGlkCiAgICogQHJldHVybiBib29sZWFuCiAgICovCiAgcHVibGljIGJvb2xlYW4gaXNGbGFnTWFzdGVyT3JpZ2luYWxFeGlzdCgpCiAgewogICAgcmV0dXJuICIxIi5lcXVhbHNJZ25vcmVDYXNlKGlzTWFzdGVyT3JpZ2luYWxFeGlzdCgpKTsKICB9CgogIC8qKgogICAqIG1ha2Ugc3VyZSB0byBjaGVjayBpc0ZsYWdDaGVja2VkSW5BdmFpbGFibGUoKSBmaXJzdCB0byBzZWUgaWYgdGhlIHZhbHVlIGlzIHZhbGlkCiAgICogQHJldHVybiBib29sZWFuCiAgICovCiAgcHVibGljIGJvb2xlYW4gaXNGbGFnQWRkaXRpb25hbE9yaWdpbmFsRXhpc3QoKQogIHsKICAgIHJldHVybiAiMSIuZXF1YWxzSWdub3JlQ2FzZShpc0FkZE9yaWdpbmFsRXhpc3QoKSk7CiAgfQoKICAvKioKICAgKiBtYWtlIHN1cmUgdG8gY2hlY2sgaXNGbGFnQ2hlY2tlZEluQXZhaWxhYmxlKCkgZmlyc3QgdG8gc2VlIGlmIHRoZSB2YWx1ZSBpcyB2YWxpZAogICAqIEByZXR1cm4gYm9vbGVhbgogICAqLwogIHB1YmxpYyBib29sZWFuIGlzRmxhZ0FueU9yaWdpbmFsQ2hlY2tlZE91dCgpCiAgewogICAgcmV0dXJuIGlzRmxhZ01hc3Rlck9yaWdpbmFsQ2hlY2tlZE91dCgpIHx8IGlzRmxhZ0FkZGl0aW9uYWxPcmlnaW5hbENoZWNrZWRPdXQoKTsKICB9CgogIC8qKgogICAqIG1ha2Ugc3VyZSB0byBjaGVjayBpc0ZsYWdDaGVja2VkSW5BdmFpbGFibGUoKSBmaXJzdCB0byBzZWUgaWYgdGhlIHZhbHVlIGlzIHZhbGlkCiAgICogQHJldHVybiBib29sZWFuCiAgICovCiAgcHVibGljIGJvb2xlYW4gaXNGbGFnTm9PcmlnaW5hbEF2YWlsYWJsZSgpCiAgewogICAgcmV0dXJuICFpc0ZsYWdNYXN0ZXJPcmlnaW5hbEV4aXN0KCkgJiYgIWlzRmxhZ0FkZGl0aW9uYWxPcmlnaW5hbEV4aXN0KCk7CiAgfQoKICAvKioKICAgKgogICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgc3RhdHVzIGlzIGEgY2hlY2tvdXQgc3RhdHVzLCBmYWxzZSBpZiBub3Qgb3IKICAgKiAgICAgICAgIHByZWZlcmVuY3hlcyBub3Qgc2V0LgogICAqLwogIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBpc0NoZWNrb3V0U3RhdHVzKFN0cmluZyBzdGF0dXMsIFN0cmluZyB0eXBlKQogIHsKICAgIGJvb2xlYW4gcmV0ID0gZmFsc2U7CiAgICBQbG1TdGF0dXNDb250YWluZXIgcG9zX3N0YXR1cyA9IFBsbVN0YXR1c1Rvb2wuZ2V0RG9jU3RhdHVzKHR5cGUsIHN0YXR1cyk7CgogICAgaWYgKHBvc19zdGF0dXMgPT0gbnVsbCkKICAgICAgcmV0ID0gZmFsc2U7CiAgICBlbHNlCiAgICAgIHJldCA9IHBvc19zdGF0dXMuaXNDaGVja291dFN0YXR1cygpOwoKICAgIHJldHVybiByZXQ7CiAgfQoKICAvKioKICAgKiB3b3JrcyBhY2NvcmRpbmcgdG8gdGhlIHJ1bGVzIGRlZmluZWQgaGVyZTogaHR0cDovL3dpa2kuZHNjLm5ldC9pbmRleC5waHAvRUNUUl9TQVBfU3RhdHVza29uemVwdAogICAqIGl0IG1lYW5zOiByZXR1cm5zIHRydWUgaWYgMS4gdGhlIHN0YXR1cyBpdHNlbGYgaXMgY2hlY2tvdXQgc3RhdHVzIChoYXMgIk8iIGZsYWcpIE9SIDIuIG9uZSBvZiBjaGlsZCBzdGF0dXMgaXMgYSBjaGVja291dCBzdGF0dXMuCiAgICovCiAgcHVibGljIGJvb2xlYW4gaXNBbGxvd2VkVG9DaGVja091dEVkaXQoKQogIHsKICAgIGJvb2xlYW4gcmV0ID0gaXNBbGxvd2VkVG9DaGVja091dEVkaXQoZ2V0U3RhdHVzKCksIGdldFR5cGUoKSk7CiAgICBpZiAoIXJldCkKICAgIHsKICAgICAgLy9mYWxsYmFjazogY2hlY2sgZHR5cGUgc2V0dGluZ3MsIG1heSBiZSB0aGlzIHN0YXR1cyBpcyBhbGxvd2VkIGZvciBjaGVja291dCB0aGVyZSEKICAgICAgdHJ5CiAgICAgIHsKICAgICAgICBEVHlwZSBkdHlwZSA9IERUeXBlQ29udGFpbmVyLmdldEluc3QoKS5nZXREVHlwZShnZXREVHlwZUlkKCkpOwogICAgICAgIGlmICghZHR5cGUuaXNSZXF1aXJlU3RhdHVzV2l0aE9GbGFnKCkpCiAgICAgICAgewogICAgICAgICAgcmV0ID0gZHR5cGUuZ2V0Q2hlY2tvdXRDaGFuZ2VTdGF0dXNNYXAoKS52YWx1ZXMoKS5jb250YWlucyhnZXRTdGF0dXMoKSk7CiAgICAgICAgICBpZiAoIXJldCkKICAgICAgICAgIHsKICAgICAgICAgICAgLy9kYXMgaXN0IGFsc28gc2VsYnN0IG5pY2h0IGRlciBjaGVja291dCBzdGF0dXMuCiAgICAgICAgICAgIC8vZGFubiBtdWVzc2VuIHdpciBzY2hhdWVuLCBvYiB3aXIgYXVzIGRpZXNlbSBzdGF0dXMgaW4gZWluZW4gY2hlY2tvdXQgc3RhdHVzIGtvbW1lbgogICAgICAgICAgICAvL2tvZW5uZW4gLSBkLmguIGluIGRlbSBmYWxsLCBvYiBlcyBpbiBkdHlwZSBlaW4gcGFzc2VuZGVyIHN0YXR1c3VlYmVyZ2FuZyBhbmdlZ2ViZW4gaXN0CiAgICAgICAgICAgIHJldCA9IGR0eXBlLmdldENoZWNrb3V0Q2hhbmdlU3RhdHVzTWFwKCkua2V5U2V0KCkuY29udGFpbnMoZ2V0U3RhdHVzKCkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBjYXRjaCAoRGVmYXVsdExvZ0V4Y2VwdGlvbiBkbGUpCiAgICAgIHsKICAgICAgICBUcmFjZS5wcmludGxuKFRyYWNlLkRFQlVHLCAiUGxtRG9jdW1lbnQoIiArIHRvU3RyaW5nKCkgKyAiKTogY2FuJ3QgZGV0ZXJtaW5lIGR0eXBlIGZvciBpZCAnIiArIGdldERUeXBlSWQoKSArICInIik7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXQ7CiAgfQoKICAvKioKICAgKiB3b3JrcyBhY2NvcmRpbmcgdG8gdGhlIHJ1bGVzIGRlZmluZWQgaGVyZTogaHR0cDovL3dpa2kuZHNjLm5ldC9pbmRleC5waHAvRUNUUl9TQVBfU3RhdHVza29uemVwdAogICAqIGl0IG1lYW5zOiByZXR1cm5zIHRydWUgaWYgMS4gdGhlIHN0YXR1cyBpdHNlbGYgaXMgY2hlY2tvdXQgc3RhdHVzIChoYXMgIk8iIGZsYWcpIE9SIDIuIG9uZSBvZiBjaGlsZCBzdGF0dXMgaXMgYSBjaGVja291dCBzdGF0dXMuCiAgICovCiAgcHVibGljIHN0YXRpYyBib29sZWFuIGlzQWxsb3dlZFRvQ2hlY2tPdXRFZGl0KFN0cmluZyBzdGF0dXMsIFN0cmluZyB0eXBlKQogIHsKICAgIGJvb2xlYW4gYWxsb3dlZCA9IGZhbHNlOwogICAgaWYgKFN0cmluZ1Rvb2wuaGFzQ29udGVudChzdGF0dXMpKQogICAgewogICAgICBQbG1TdGF0dXNDb250YWluZXIgcHNjID0gUGxtU3RhdHVzVG9vbC5nZXREb2NTdGF0dXModHlwZSwgc3RhdHVzKTsKICAgICAgaWYgKHBzYyA9PSBudWxsKQogICAgICB7CiAgICAgICAgVHJhY2UucHJpbnRsbihUcmFjZS5ERUJVRywgImlzQWxsb3dlZFRvQ2hlY2tPdXRFZGl0OiB1bmtub3duIHN0YXR1cy90eXBlOiAnIiArIHN0YXR1cyArICIvIiArIHR5cGUgKyAiJyIpOwogICAgICAgIGFsbG93ZWQgPSB0cnVlOyAvL3d0IC0gaWYgdGhlIGRvY3VtZW50IHR5cGUgaGFzIG5vIHN0YXR1cyBhc3NpZ25lZCwgdGhlbiB0aGVyZSBpcyBubyByZWFzb24gdG8gcHJldmVudCBjaGVja291dC4KICAgICAgfQogICAgICBlbHNlCiAgICAgICAgYWxsb3dlZCA9IHBzYy5pc0NoZWNrb3V0QWxsb3dlZCgpOwogICAgfQogICAgZWxzZQogICAgICBhbGxvd2VkID0gdHJ1ZTsKCiAgICByZXR1cm4gYWxsb3dlZDsKICB9CgogIC8qKgogICAqIEdldCB0aGUgbGFzdCBtb2RpZmllZCB0aW1lIGZyb20gdGhlIGRvY3VtZW50LiBUbyBkZXRlcm1pbmUgdGhpcyB0aW1lLCB0aGUKICAgKiBVc2VyZGVmaW5lZDIgZmllbGQgaXMgcmVhZCBhbmQgdGhlIHZhbHVlIChpdHMgaW4gZm9ybSB5eXl5TU1kZEhIU1MpIGlzCiAgICogcmVwYXJzZWQgdG8gYSB2YWxpZCBsb25nIHZhbHVlIHdpdGggdGhlIERhdGVUb29sIHV0aWxpdHkuCiAgICoKICAgKiBAcmV0dXJuIGxvbmcgbGFzdCBtb2RpZmllZCBkYXRlIGluIG1pbGxpc2Vjb25kcyBzaW5jZSAxOTcwIG9yIC0xIGlmCiAgICogICAgICAgICB1c2VyZGVmaW5lZDIgbm90IHNldAogICAqLwogIHB1YmxpYyBsb25nIGxhc3RNb2RpZmllZCgpCiAgewogICAgbG9uZyBsYXN0X21vZCA9IC0xOwoKICAgIERhdGUgZGF0ZSA9IGdldExhc3RNb2RpZmllZERhdGUoKTsKICAgIGlmIChkYXRlICE9IG51bGwpCiAgICAgIGxhc3RfbW9kID0gZGF0ZS5nZXRUaW1lKCk7CgogICAgcmV0dXJuIGxhc3RfbW9kOwogIH0KCiAgLyoqCiAgICogTWV0aG9kIGlzQXNzZW1ibHkKICAgKgogICAqLwogIHB1YmxpYyBib29sZWFuIGlzQXNzZW1ibHkoKQogIHsKICAgIFN0cmluZyBvYmpfdHlwZSA9IGdldFVzZXJEZWZpbmVkNE9iamVjdFR5cGUoKTsKICAgIHJldHVybiBvYmpfdHlwZS5pbmRleE9mKCdBJykgIT0gLTE7CiAgfQoKICBwdWJsaWMgYm9vbGVhbiBpc05vcm1Eb2N1bWVudCgpCiAgewogICAgU3RyaW5nIG9ial90eXBlID0gZ2V0VXNlckRlZmluZWQ0T2JqZWN0VHlwZSgpOwogICAgcmV0dXJuIG9ial90eXBlLmluZGV4T2YoJ04nKSAhPSAtMTsKICB9CgogIC8qKgogICAqIENoZWNrIGlmIGRvY3VtZW50IGlzIGEgZHJhd2luZyAoUmVzMzpOLCBSZXM0OkQpCiAgICoKICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGRvY3VtZW50IGlzIGEgZHJhd2luZwogICAqLwogIHB1YmxpYyBzdGF0aWMgYm9vbGVhbiBpc0RyYXdpbmcoU3RyaW5nIG1hc3RlckZsYWcsIFN0cmluZyByZXM0KSB0aHJvd3MgRGVmYXVsdExvZ0V4Y2VwdGlvbgogIHsKICAgIGlmIChpc05vbk1hc3RlcihtYXN0ZXJGbGFnKSkKICAgIHsKICAgICAgLy8gYSBkcmF3aW5nIGlzIGRlZmluZWQgYnkgcmVzMyArIHJlczQuCiAgICAgIC8vIFJlczM9RUlOWkU6TiBvciBSZXMzPUVJTlpFOk0KICAgICAgLy8gUmVzND1VR1M6RCBvciBSZXM0PVVHUzpQCiAgICAgIC8vIC0tPiBhIGRyYXdpbmcgLS0+IGEgbWFzdGVybW9kZWwKCiAgICAgIGludCBpbmRleCA9IHJlczQuaW5kZXhPZigiOiIpOwogICAgICBpZiAoaW5kZXggPiAtMSkKICAgICAgewogICAgICAgIFN0cmluZyBmbGFnID0gcmVzNC5zdWJzdHJpbmcoaW5kZXggKyAxKTsKICAgICAgICByZXR1cm4gZmxhZy5lcXVhbHNJZ25vcmVDYXNlKERSQVdJTkcpOwogICAgICB9CiAgICAgIGVsc2UKICAgICAgICB0aHJvdyBuZXcgRGVmYXVsdExvZ0V4Y2VwdGlvbigiRTEwMjA1IiwgIlVzZXJkZWZpbmVkNCBmaWVsZCBub3Qgc2V0LiBDYW4ndCBkZXRlcm1pbmUgaWYgZG9jdW1lbnQgaXMgYSBkcmF3aW5nIG9yIG5vdC4iKTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CgogIC8qKgogICAqIENoZWNrIGlmIGRvY3VtZW50IGlzIGEgZHJhd2luZyAoUmVzMzpOLCBSZXM0OkQpCiAgICoKICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGRvY3VtZW50IGlzIGEgZHJhd2luZwogICAqIEB0aHJvdyBEZWZhdWx0TG9nRXhjZXB0aW9uIEUxMDIwMCAtIFJlczMgbm90IHNldAogICAqIEB0aHJvdyBEZWZhdWx0TG9nRXhjZXB0aW9uIEUxMDIwMSAtIFJlczMgY29udGFpbnMgaW52YWxpZCB2YWx1ZQogICAqIEB0aHJvdyBEZWZhdWx0TG9nRXhjZXB0aW9uIEUxMDIwNSAtIFJlczQgbm90IHNldAogICAqLwogIHB1YmxpYyBib29sZWFuIGlzRHJhd2luZygpIHRocm93cyBEZWZhdWx0TG9nRXhjZXB0aW9uCiAgewogICAgcmV0dXJuIChpc0RyYXdpbmcoZ2V0TWFzdGVyKCksIGdldFVzZXJEZWZpbmVkNCgpKSk7CiAgfQoKICAvKioKICAgKiBDaGVjayBpZiBkb2N1bWVudCBpcyBhIGZhbWlseSBtZW1iZXIgKFVzZXJkZWZpbmVkNDogQUkgb3IgUEkpCiAgICoKICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGRvY3VtZW50IGlzIGEgcGFydCBmYW1pbHkgbWVtYmVyCiAgICovCiAgcHVibGljIGJvb2xlYW4gaXNGYW1pbHlNZW1iZXIoKQogIHsKICAgIHJldHVybiBpc0ZhbWlseU1lbWJlcihnZXRVc2VyRGVmaW5lZDQoKSk7CiAgfQoKICAvKioKICAgKiBDaGVjayBpZiBkb2N1bWVudCBpcyBhIGZhbWlseSBtZW1iZXIgKFVzZXJkZWZpbmVkNDogQUkgb3IgUEkpCiAgICoKICAgKiBAcGFyYW0gcmVzNCAtCiAgICogICAgICAgICAgdGhlIGRvY3VtZW50J3MgdXNlcmRlZmluZWQ0IGZpZWxkCiAgICogQHJldHVybiB0cnVlIGlmIGRvY3VtZW50IGlzIGEgcGFydCBmYW1pbHkgbWVtYmVyCiAgICovCiAgcHVibGljIHN0YXRpYyBib29sZWFuIGlzRmFtaWx5TWVtYmVyKFN0cmluZyByZXM0KQogIHsKICAgIGJvb2xlYW4gcmVzdWx0ID0gZmFsc2U7CgogICAgdHJ5CiAgICB7CiAgICAgIGludCBpbmRleCA9IHJlczQuaW5kZXhPZigiOiIpOwogICAgICBTdHJpbmcgcmVzNG9ial90eXBlID0gcmVzNC5zdWJzdHJpbmcoaW5kZXggKyAxKTsKCiAgICAgIGlmIChyZXM0b2JqX3R5cGUuaW5kZXhPZihGQU1JTFlfSU5TVEFOQ0UpID4gLTEpCiAgICAgIHsKICAgICAgICAvLyB3ZSBoYXZlIGEgZmFtaWx5IG1lbWJlciBpbiBhbnkgZm9ybQogICAgICAgIHJlc3VsdCA9IHRydWU7CiAgICAgIH0KICAgIH0KICAgIGNhdGNoIChFeGNlcHRpb24gZSkKICAgIHsKICAgICAgLy8gdGhlIHJlczQgZmllbGQgd2FzIG51bGwgb3Igbm90IHZhbGlkIChubyAnOicpCiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgLyoqCiAgICogUmV0dXJucyB0cnVlIGlmIHRoaXMgZG9jdW1lbnQgaXMgYSBmYW1pbHkgdGVtcGxhdGUKICAgKgogICAqIEByZXR1cm4gdHJ1ZSBpZiBpdCBpcyBhIGZhbWlseSB0ZW1wbGF0ZQogICAqLwogIHB1YmxpYyBib29sZWFuIGlzRmFtaWx5VGVtcGxhdGUoKQogIHsKICAgIHJldHVybiBpc0ZhbWlseVRlbXBsYXRlKGdldE1hc3RlcigpLCBnZXRVc2VyRGVmaW5lZDQoKSk7CiAgfQoKICAvKioKICAgKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBkb2N1bWVudCBpcyBhIGZhbWlseSB0ZW1wbGF0ZQogICAqCiAgICogQHJldHVybiB0cnVlIGlmIGl0IGlzIGEgRmFtaWx5IFRlbXBsYXRlCiAgICovCiAgcHVibGljIHN0YXRpYyBib29sZWFuIGlzRmFtaWx5VGVtcGxhdGUoU3RyaW5nIG1hc3RlckZsYWcsIFN0cmluZyByZXM0KQogIHsKICAgIGJvb2xlYW4gaXNGYW1pbHlUZW1wbGF0ZSA9IGZhbHNlOwogICAgdHJ5CiAgICB7CiAgICAgIGlmIChyZXM0ICE9IG51bGwpCiAgICAgIHsKICAgICAgICAvLyBpbnQgaW5kZXggPSByZXMzLmluZGV4T2YoIjoiKTsKICAgICAgICBpbnQgaW5kZXgyID0gcmVzNC5pbmRleE9mKCI6Iik7CgogICAgICAgIC8vIFN0cmluZyByb2xlID0gcmVzMy5zdWJzdHJpbmcoaW5kZXgrMSk7CiAgICAgICAgU3RyaW5nIHJlczRvYmpfdHlwZSA9IHJlczQuc3Vic3RyaW5nKGluZGV4MiArIDEpOwoKICAgICAgICBpZiAoaXNNYXN0ZXIobWFzdGVyRmxhZykpCiAgICAgICAgICBpc0ZhbWlseVRlbXBsYXRlID0gcmVzNG9ial90eXBlLmluZGV4T2YoRkFNSUxZX0dFTkVSSUMpID4gLTE7CiAgICAgIH0KICAgIH0KICAgIGNhdGNoIChFeGNlcHRpb24gZSkKICAgIHsKICAgICAgLy8gb25lIG9mIHRoZSByZXMgZmllbGRzIHdhcyBudWxsIG9yIG5vdCB2YWxpZCAobm8gJzonKQogICAgICBUcmFjZS5wcmludGxuU3RhY2tUcmFjZShUcmFjZS5ERUJVRywgZSk7CiAgICB9CiAgICByZXR1cm4gaXNGYW1pbHlUZW1wbGF0ZTsKICB9CgogIHB1YmxpYyB2b2lkIHNldExpbmtlZE1hdGVyaWFsQWxsb2NzSW5zdGFuY2UoUGxtTWF0ZXJpYWwgbWF0KQogIHsKICAgIHRoaXMubGlua2VkTWF0SW5zdGFuY2UgPSBtYXQ7CiAgfQoKICBwdWJsaWMgUGxtTWF0ZXJpYWwgZ2V0TGlua2VkTWF0ZXJpYWxBbGxvY3NJbnN0YW5jZSgpCiAgewogICAgcmV0dXJuIHRoaXMubGlua2VkTWF0SW5zdGFuY2U7CiAgfQoKICAvKioKICAgKiBAcmV0dXJuIFBsbURvY3VtZW50IGxhdGVzdCBQbG1Eb2N1bWVudCBhY2NvcmRpbmcgdG8gUGxtVmVyc2lvblRvb2wsIG51bGwgaWYKICAgKiAgICAgICAgIGRvY3VtZW50IGRvZXMgbm90IGV4aXN0cyBpbiBTQVAKICAgKi8KICBwdWJsaWMgUGxtRG9jdW1lbnQgYWN0dWFsVmVyc2lvbigpIHRocm93cyBEZWZhdWx0TG9nRXhjZXB0aW9uCiAgewogICAgaWYgKGV4aXN0c0luU2FwKQogICAgewogICAgICB0cnkKICAgICAgewogICAgICAgIFN0cmluZyBsYXRlc3QgPSBQbG1WZXJzaW9uVG9vbC5nZXRJbnN0YW5jZSgpLmdldExhdGVzdFZlcnNpb24odGhpcyk7CiAgICAgICAgUGxtRG9jdW1lbnQgbGF0ZXN0X2RvYyA9IG5ldyBQbG1Eb2N1bWVudCh0eXBlLCBudW1iZXIsIGxhdGVzdCwgcGFydCk7CiAgICAgICAgbGF0ZXN0X2RvYy5zZXRFeGlzdHNJblNhcCh0cnVlKTsKICAgICAgICByZXR1cm4gbGF0ZXN0X2RvYzsKICAgICAgfQogICAgICBjYXRjaCAoRGVmYXVsdExvZ0V4Y2VwdGlvbiBkbGUpCiAgICAgIHsKICAgICAgICB0aHJvdyBuZXcgRGVmYXVsdExvZ0V4Y2VwdGlvbihEaWMuZ2V0VGV4dCgiRTAxNzUwIiwgIkxhdGVzdCB2ZXJzaW9uIGNvdWxkIG5vdCBiZSBkZXRlcm1pbmVkLiIpLCBkbGUpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CgogIC8qKgogICAqIE1ldGhvZCBnZXRWV2hlcmVVc2VkIFJldHVybnMgdGhlIHdoZXJldXNlZCBsaXN0IG9mIHRoaXMgZG9jdW1lbnQKICAgKgogICAqIEByZXR1cm4gYSBWZWN0b3Igb2YgUGxtRG9jdW1lbnRzCiAgICoKICAgKi8KICBwdWJsaWMgTGlzdDxQbG1XaGVyZXVzZWREb2N1bWVudD4gZ2V0V2hlcmVVc2VkKCkKICB7CiAgICBpZiAodldoZXJlVXNlZCA9PSBudWxsKQogICAgICB2V2hlcmVVc2VkID0gbmV3IEFycmF5TGlzdDxQbG1XaGVyZXVzZWREb2N1bWVudD4oKTsKICAgIHJldHVybiB2V2hlcmVVc2VkOwogIH0KCiAgLyoqCiAgICogTWV0aG9kIGFkZFdoZXJlVXNlZAogICAqIGFkZHMgYSB3aGVyZXVzZWQgZG9jdW1lbnQgdG8gdGhlIHdoZXJldXNlZCBsaXN0IG9mIHRoaXMgZG9jdW1lbnQKICAgKgogICAqLwogIHByb3RlY3RlZCB2b2lkIGFkZFdoZXJlVXNlZChQbG1XaGVyZXVzZWREb2N1bWVudCB1c2VkX2RvYykKICB7CiAgICBpZiAodldoZXJlVXNlZCA9PSBudWxsKQogICAgICB2V2hlcmVVc2VkID0gbmV3IEFycmF5TGlzdDxQbG1XaGVyZXVzZWREb2N1bWVudD4oKTsKICAgIHZXaGVyZVVzZWQuYWRkKHVzZWRfZG9jKTsKICB9CgogIC8qKgogICAqIE1ldGhvZCBnZXRNYXN0ZXJNb2RlbGwgTWFrZXMgYSBTdHJ1Y3R1cmVFeHBsb2RlIHRvIGdldCBhbGwgcmVmZXJlbmNlZAogICAqIERvY3VtZW50cyBFcyBrYW5uIGxhdXQgRGF0ZW5tb2RlbGwgbnVyIEVJTiBNYXN0ZXJtb2RlbGwgenUgZWluZW0gTm9ubWFzdGVyCiAgICogZ2ViZW4uIERhcyBpc3QgZWluZSAxIC0gbiBCZXppZWh1bmcgdW5kIGtlaW5lIG4gLSBuIEJlemllaHVuZy4gV2VubiBlaW4KICAgKiBOb25tYXN0ZXIgbm9jaCBlaW4gIk1hc3Rlcm1vZGVsbCIgaW4gc2VpbmVyIFN0dWVja2xpc3RlIGhhdCwgZGFzIGFiZXIgaW0KICAgKiBTb3J0c3RyaW5nIGtlaW4gIkQiIGhhdCwgaXN0IGRhcyB6LkIuIFVtZ2VidW5nc2dlb21ldHJpZSB1bmQgbmljaHQgbm9jaCBlaW4KICAgKiBNYXN0ZXJtb2RlbGwhCiAgICoKICAgKiBAcmV0dXJuIHRoZSBQbG1Eb2N1bWVudCwgbWF0Y2hpbmcgdG8gVEhJUyBub25tYXN0ZXIhIQogICAqCiAgICogQHRocm93cyBEZWZhdWx0TG9nRXhjZXB0aW9uCiAgICoKICAgKi8KICBwdWJsaWMgUGxtRG9jdW1lbnQgZ2V0TWFzdGVyTW9kZWwoKSB0aHJvd3MgRGVmYXVsdExvZ0V4Y2VwdGlvbgogIHsKICAgIENvbGxlY3Rpb248UGxtRG9jdW1lbnQ+IGNfbWFzdGVyID0gZ2V0TWFzdGVyTW9kZWwoZmFsc2UpOwogICAgUGxtRG9jdW1lbnQgZm1hc3RlciA9IG51bGw7CiAgICBpZiAoaGFzSXRlbXMoY19tYXN0ZXIpKQogICAgewogICAgICBJdGVyYXRvcjxQbG1Eb2N1bWVudD4gaXRlciA9IGNfbWFzdGVyLml0ZXJhdG9yKCk7CiAgICAgIHdoaWxlIChpdGVyLmhhc05leHQoKSkKICAgICAgewogICAgICAgIGZtYXN0ZXIgPSBpdGVyLm5leHQoKTsKICAgICAgfQogICAgICByZXR1cm4gZm1hc3RlcjsKICAgIH0KICAgIGVsc2UKICAgICAgcmV0dXJuIG51bGw7CiAgfQoKICAvKioKICAgKgogICAqIEBwYXJhbSBnZXRBbGxNYXN0ZXJzCiAgICogICAgICAgICAgYSBib29sZWFuIC0gYmVpIHRydWUgd2VyZGVuIGF1Y2ggZGllIE1hc3RlcnMgZGVyCiAgICogICAgICAgICAgVW1nZWJ1bmdzZ2VvbWV0cmllIHp1cvxja2dlZ2ViZW4sIGRpZSBLRUlOICJEIiBpbSBTb3J0aWVyZmVsZAogICAqICAgICAgICAgIGhhYmVuLgogICAqCiAgICogQHJldHVybiBhIFBsbURvY3VtZW50CiAgICoKICAgKiBAZXhjZXB0aW9uIERlZmF1bHRMb2dFeGNlcHRpb24KICAgKgogICAqLwogIHB1YmxpYyBDb2xsZWN0aW9uPFBsbURvY3VtZW50PiBnZXRNYXN0ZXJNb2RlbChib29sZWFuIGdldEFsbE1hc3RlcnMpIHRocm93cyBEZWZhdWx0TG9nRXhjZXB0aW9uCiAgewogICAgaWYgKHRoaXMuaXNOb25NYXN0ZXIoKSkKICAgIHsKICAgICAgVmVjdG9yPFBsbURvY3VtZW50PiB2X21hc3RlcnMgPSBuZXcgVmVjdG9yPFBsbURvY3VtZW50PigpOwogICAgICAvLyByZWFkIHRoZSBEb2N1bWVudHN0cnVjdHVyZSBzYXZlZCBpbiBTQVAKICAgICAgUHJvY2Vzc0RvY1N0cnVjdHVyZUV4cGxvZGU0IHByb2MgPSBuZXcgUHJvY2Vzc0RvY1N0cnVjdHVyZUV4cGxvZGU0KCk7CiAgICAgIERhdGFDb250YWluZXIgZGMgPSBuZXcgRGF0YUNvbnRhaW5lcigpOwogICAgICBkYy5hZGRPYmplY3QoUHJvY2Vzc0RvY1N0cnVjdHVyZUV4cGxvZGU0LklOT1VUX1BMTV9ET0NVTUVOVCwgdGhpcyk7CiAgICAgIGRjLmFkZEJvb2woUHJvY2Vzc0RvY1N0cnVjdHVyZUV4cGxvZGU0LklOX1NFQVJDSF9NQUlOX0RPQywgZmFsc2UpOwogICAgICBkYy5hZGRPYmplY3QoUHJvY2Vzc0RvY1N0cnVjdHVyZUV4cGxvZGU0LklOX0xPQURPUFQsIFBsbUNvbnN0YW50cy5MT0FEX09QVF9BU19TQVZFRCk7CiAgICAgIGRjLmFkZEJvb2woUHJvY2Vzc0RvY1N0cnVjdHVyZUV4cGxvZGU0LklOX01VTFRJTEVWRUxfRVhQTCwgZmFsc2UpOwogICAgICBkYy5hZGRPYmplY3QoUHJvY2Vzc0RvY1N0cnVjdHVyZUV4cGxvZGU0LklOX0VYUExPU0lPTl9TQ0VOQVJJTywgIiIpOwogICAgICBwcm9jLnNldERhdGEoZGMpOwogICAgICBwcm9jLmV4ZWN1dGUoKTsKICAgICAgUGxtRG9jU3RydWN0dXJlIHBsbV9kb2Nfc3RydWMgPSB0aGlzLmdldERvY1N0cnVjdHVyZSgpOwogICAgICBpZiAocGxtX2RvY19zdHJ1YyAhPSBudWxsICYmICFwbG1fZG9jX3N0cnVjLmlzRW1wdHkoKSkKICAgICAgewogICAgICAgIENvbGxlY3Rpb248UGxtRG9jdW1lbnQ+IHZfZG9jc193X2RldGFpbCA9IGRjLmdldE9iamVjdChQcm9jZXNzRG9jU3RydWN0dXJlRXhwbG9kZTQuT1VUX0FMTF9ET0NVTUVOVFMpOwogICAgICAgIFBsbURvY3VtZW50Q29udGFpbmVyIHBkY19kZXRhaWwgPSBuZXcgUGxtRG9jdW1lbnRDb250YWluZXIodl9kb2NzX3dfZGV0YWlsKTsKCiAgICAgICAgSXRlcmF0b3I8UGxtRG9jQm9tSXRlbT4gaXRlciA9IHBsbV9kb2Nfc3RydWMuZ2V0UGxtRG9jQm9tSXRlbXMoKS5pdGVyYXRvcigpOwogICAgICAgIHdoaWxlIChpdGVyLmhhc05leHQoKSkKICAgICAgICB7CiAgICAgICAgICBQbG1Eb2NCb21JdGVtIGVsZW1lbnQgPSBpdGVyLm5leHQoKTsKICAgICAgICAgIC8vIERhcyB6dSBkaWVzZXIgRHJhd2luZyBnZWj2cmVuZGUgTWFzdGVyTW9kZWxsIG11c3Mgdm9tIFR5cAogICAgICAgICAgLy8gTWF0ZXJtb2RlbGwgc2VpbiEKICAgICAgICAgIC8vIGdldCB0aGUgZG9jdW1lbnQgd2l0aCBkZXRhaWxzIHJldHVybmVkIGZyb20gdGhlIHN0cnVjdHVyZSBleHBsb2RlCiAgICAgICAgICAvLyBwcm9jZXNzCiAgICAgICAgICBQbG1Eb2N1bWVudCBkb2MgPSBlbGVtZW50LmdldERvY3VtZW50KCk7CiAgICAgICAgICBQbG1Eb2N1bWVudCBkb2NfZCA9IHBkY19kZXRhaWwuZ2V0RG9jdW1lbnQoZG9jLmdldFNhcEtleSgpKTsKICAgICAgICAgIGlmIChkb2NfZCAhPSBudWxsKQogICAgICAgICAgICBkb2MgPSBkb2NfZDsKCiAgICAgICAgICBpZiAoZG9jLmlzTWFzdGVyKCkpCiAgICAgICAgICB7CiAgICAgICAgICAgIFN0cmluZyBzb3J0U3RyaW5nID0gZWxlbWVudC5nZXRTb3J0U3RyaW5nKCk7CiAgICAgICAgICAgIGlmIChzb3J0U3RyaW5nICE9IG51bGwpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAvLyB3aXIgbfxzc2VuIGRlbiBTb3J0c3RyaW5nIHBy/GZlbiB1bmQgendhciBuYWNoIGRlbSBVR1M6CiAgICAgICAgICAgICAgaW50IGluZGV4ID0gc29ydFN0cmluZy5pbmRleE9mKCI6Iik7CiAgICAgICAgICAgICAgaWYgKGluZGV4ID4gLTEpCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKFBsbURvY0JvbUl0ZW0uaXNNYXN0ZXIoc29ydFN0cmluZykpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIHZfbWFzdGVycy5pbnNlcnRFbGVtZW50QXQoZG9jX2QsIDApOwogICAgICAgICAgICAgICAgICBpZiAoIWdldEFsbE1hc3RlcnMpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZfbWFzdGVyczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGdldEFsbE1hc3RlcnMpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIHZfbWFzdGVycy5hZGQoZG9jX2QpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdl9tYXN0ZXJzOwogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgZWxzZQogICAgICByZXR1cm4gbnVsbDsKICB9CgogIC8qKgogICAqIE1ldGhvZCBnZXROb25NYXN0ZXJzIENoZWNrIGlmIHRoaXMgaXMgYSBtYXN0ZXIuIFRoZW4gZ2V0cyB0aGUgV2hlcmUgVXNlZAogICAqIExpc3QgYW5kIGZpbHRlciBvdXQgYWxsIGRvY3VtZW50cyB3aGljaCBhcmVuJ3Qgbm9ubWFzdGVycyAobGlrZSBhc3NlbWJseQogICAqIHBhcmVudHMsIGxhc3QgdXNlZCBkb2N1bWVudHMsIC4uLikKICAgKgogICAqIEByZXR1cm4gYSBDb2xsZWN0aW9uIG9mIFBsbURvY3VtZW50cwogICAqCiAgICovCiAgcHVibGljIEBOb25udWxsIENvbGxlY3Rpb248UGxtV2hlcmV1c2VkRG9jdW1lbnQ+IGdldE5vbk1hc3RlcnMoKQogIHsKICAgIFZlY3RvcjxQbG1XaGVyZXVzZWREb2N1bWVudD4gdl9yZXQgPSBuZXcgVmVjdG9yPFBsbVdoZXJldXNlZERvY3VtZW50PigpOwogICAgVHJhY2UucHJpbnRsbihUcmFjZS5ERUJVRywgIiAgZ2V0Tm9uTWFzdGVycygpIE1hc3RlciA8IiArIHRoaXMudG9TdHJpbmcoKSArICI+Iik7CgogICAgLy8gZ2V0IGFsbCB3aGVyZSB1c2VkIGRvY3VtZW50cwogICAgTGlzdDxQbG1XaGVyZXVzZWREb2N1bWVudD4gdl93aGVyZV91c2VkID0gdGhpcy5nZXRXaGVyZVVzZWQoKTsKICAgIGZvciAoUGxtV2hlcmV1c2VkRG9jdW1lbnQgcGxtZF93aGVyZV91c2VkIDogdl93aGVyZV91c2VkKQogICAgewogICAgICBpZiAocGxtZF93aGVyZV91c2VkLmlzTm9ubWFzdGVyUmVsYXRpb24oKSkKICAgICAgewogICAgICAgIHZfcmV0LmFkZChwbG1kX3doZXJlX3VzZWQpOwogICAgICAgIFRyYWNlLnByaW50bG4oVHJhY2UuREVCVUcsCiAgICAgICAgICAgICIgICBnZXROb25NYXN0ZXJzKCkgTm9ubWFzdGVyIDwiICsgcGxtZF93aGVyZV91c2VkLnRvU3RyaW5nKCkgKyAiPiBTb3J0c3RyOiA8IiArIHBsbWRfd2hlcmVfdXNlZC5nZXRTb3J0U3RyaW5nKCkgKyAiPiIpOwogICAgICB9CiAgICB9IC8vIGZvcgogICAgcmV0dXJuIHZfcmV0OwogIH0KCiAgLyoqCiAgICogTWV0aG9kIGdldEZhbWlseU1lbWJlcnMgQ2hlY2sgaWYgdGhpcyBpcyBhIG1hc3Rlci4gVGhlbiBnZXRzIHRoZSBXaGVyZSBVc2VkCiAgICogTGlzdCBhbmQgZmlsdGVyIG91dCBhbGwgZG9jdW1lbnRzIHdoaWNoIGFyZW4ndCBmYW1pbHkgbWVtYmVycyAobGlrZQogICAqIGFzc2VtYmx5IHBhcmVudHMsIGxhc3QgdXNlZCBkb2N1bWVudHMsIGRyYXdpbmdzLCBub25tYXN0ZXJzIC4uLikKICAgKgogICAqIEByZXR1cm4gYSBDb2xsZWN0aW9uIG9mIFBsbURvY3VtZW50cwogICAqCiAgICovCiAgcHVibGljIENvbGxlY3Rpb248UGxtV2hlcmV1c2VkRG9jdW1lbnQ+IGdldEZhbWlseU1lbWJlcnMoKQogIHsKICAgIFZlY3RvcjxQbG1XaGVyZXVzZWREb2N1bWVudD4gdl9yZXQgPSBuZXcgVmVjdG9yPFBsbVdoZXJldXNlZERvY3VtZW50PigpOwoKICAgIC8vIGdldCBhbGwgd2hlcmUgdXNlZCBkb2N1bWVudHMKICAgIExpc3Q8UGxtV2hlcmV1c2VkRG9jdW1lbnQ+IHZfd2hlcmVfdXNlZCA9IHRoaXMuZ2V0V2hlcmVVc2VkKCk7CiAgICBmb3IgKFBsbVdoZXJldXNlZERvY3VtZW50IHBsbWRfd2hlcmVfdXNlZCA6IHZfd2hlcmVfdXNlZCkKICAgIHsKICAgICAgU3RyaW5nIHNvcnRfc3RyaW5nID0gcGxtZF93aGVyZV91c2VkLmdldFNvcnRTdHJpbmcoKTsKICAgICAgaWYgKHNvcnRfc3RyaW5nICE9IG51bGwpCiAgICAgIHsKICAgICAgICBpZiAocGxtZF93aGVyZV91c2VkLmlzRmFtaWx5TWVtYmVyUmVsYXRpb24oKSkKICAgICAgICB7CiAgICAgICAgICB2X3JldC5hZGQocGxtZF93aGVyZV91c2VkKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZQogICAgICB7CiAgICAgICAgU3RyaW5nIHJlczQgPSBwbG1kX3doZXJlX3VzZWQuZ2V0VXNlckRlZmluZWQ0KCk7CiAgICAgICAgaWYgKHJlczQgIT0gbnVsbCkKICAgICAgICB7CiAgICAgICAgICBpZiAocGxtZF93aGVyZV91c2VkLmlzRmFtaWx5TWVtYmVyKCkpCiAgICAgICAgICB7CiAgICAgICAgICAgIHZfcmV0LmFkZChwbG1kX3doZXJlX3VzZWQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSAvLyBmb3IKCiAgICByZXR1cm4gdl9yZXQ7CiAgfQoKICAvKioKICAgKiBDaGVjayBpZiBhIFBsbUZpbGUgb24gdGhlIERJUiBleGlzdHMgd2hpY2ggaGFzIHRoZSBzYW1lIHJlbGF0aXZlIG5hbWUKICAgKiBhcyB0aGUgZmlsZSBwYXNzZWQgdG8gdGhlIG1ldGhvZCAod3NhcHBsIGRlcGVuZGFudCkKICAgKgogICAqIEBwYXJhbSAgICBmICAgICAgICAgICAgICAgICAgIGEgIEZpbGUKICAgKiBAcGFyYW0gICAgd3NhcHBsICAgICAgICAgICAgICBhICBTdHJpbmcKICAgKgogICAqIEByZXR1cm4gICBhIGJvb2xlYW4KICAgKgogICAqLwogIHB1YmxpYyBib29sZWFuIGZpbGVFeGlzdHMoRmlsZSBmLCBTdHJpbmcgd3NhcHBsKQogIHsKICAgIFZlY3RvcjxQbG1GaWxlPiB2X2YgPSB0aGlzLmdldEZpbGVzKHdzYXBwbCk7CiAgICBpZiAodl9mICE9IG51bGwgJiYgIXZfZi5pc0VtcHR5KCkpCiAgICB7CiAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdl9mLnNpemUoKTsgaSsrKQogICAgICB7CiAgICAgICAgUGxtRmlsZSBwZiA9IHZfZi5nZXQoaSk7CiAgICAgICAgU3RyaW5nIHNhcF9mbmFtZSA9IHBmLmdldEZpbGVOYW1lKCk7CiAgICAgICAgU3RyaW5nIGRpc2tfZm5hbWUgPSBmLmdldE5hbWUoKTsKCiAgICAgICAgaWYgKGRpc2tfZm5hbWUuZXF1YWxzSWdub3JlQ2FzZShzYXBfZm5hbWUpKQogICAgICAgIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgLyoqCiAgICogTWV0aG9kIGdldEZpbGVzCiAgICogcmV0dXJucyB0aGUgT3JpZ2luYWxzIG9mIHRoaXMgUGxtRG9jdW1lbnQKICAgKiBAcmV0dXJuIGEgVmVjdG9yIG9mIFBsbUZpbGVzCiAgICoKICAgKi8KICBwdWJsaWMgT2JqZWN0VmVjdG9yPFBsbUZpbGU+IGdldEZpbGVzKCkKICB7CiAgICBpZiAob3ZQbG1GaWxlcyA9PSBudWxsKQogICAgICBvdlBsbUZpbGVzID0gbmV3IE9iamVjdFZlY3RvcjxQbG1GaWxlPih0aGlzLCBQbG1GaWxlLmNsYXNzKTsKICAgIHJldHVybiBvdlBsbUZpbGVzOwogIH0KCiAgLyoqCiAgICogR2V0IGFsbCBQbG1GaWxlcyB3aXRoIHRoZSBzcGVjaWZpZWQgd29ya3N0YXRpb24gYXBwbGljYXRpb24KICAgKi8KICBwdWJsaWMgVmVjdG9yPFBsbUZpbGU+IGdldEZpbGVzKFN0cmluZyB3c2FwcCkKICB7CiAgICBpZiAod3NhcHAgPT0gbnVsbCkKICAgICAgcmV0dXJuIG51bGw7CgogICAgVmVjdG9yPFBsbUZpbGU+IHJlc3VsdCA9IG5ldyBWZWN0b3I8UGxtRmlsZT4oKTsKCiAgICBJdGVyYXRvcjxQbG1GaWxlPiBpdGVyID0gZ2V0RmlsZXMoKS5nZXRQbG1PYmplY3RzKCkuaXRlcmF0b3IoKTsKICAgIHdoaWxlIChpdGVyLmhhc05leHQoKSkKICAgIHsKICAgICAgUGxtRmlsZSBmaWxlID0gaXRlci5uZXh0KCk7CiAgICAgIGlmIChmaWxlICE9IG51bGwgJiYgd3NhcHAuZXF1YWxzKGZpbGUuZ2V0V29ya3N0YXRpb25BcHBsaWNhdGlvbigpKSkKICAgICAgICByZXN1bHQuYWRkKGZpbGUpOwogICAgfQoKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBHZXQgYWxsIFBsbUZpbGVzIHdoaWNoIGFyZSB2YWxpZCBmb3IgUHJldmlldyBpbiBhIHZlY3RvciBvciBhbiBlbXB0eSB2ZWN0b3IKICAgKiBpZiBubyBmaWxlcyBhcmUgdmFsaWQgZm9yIHByZXZpZXcKICAgKi8KICBwdWJsaWMgVmVjdG9yPFBsbUZpbGU+IGdldFByZXZpZXdGaWxlcygpCiAgewogICAgVmVjdG9yPFBsbUZpbGU+IHJlc3VsdCA9IG5ldyBWZWN0b3I8UGxtRmlsZT4oKTsKCiAgICBJdGVyYXRvcjxQbG1GaWxlPiBpdGVyID0gZ2V0RmlsZXMoKS5nZXRQbG1PYmplY3RzKCkuaXRlcmF0b3IoKTsKICAgIHdoaWxlIChpdGVyLmhhc05leHQoKSkKICAgIHsKICAgICAgUGxtRmlsZSBmaWxlID0gaXRlci5uZXh0KCk7CiAgICAgIGlmIChmaWxlLmlzUHJldmlld1BpY3R1cmUoKSkKICAgICAgICByZXN1bHQuYWRkKGZpbGUpOwogICAgfQoKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICAvKioKICAgKiBHZXQgdGhlIFBsbUZpbGUgd2l0aCB0aGUgc3BlY2lmaWVkIGFwcGxpY2F0aW9uIElECiAgICovCiAgcHVibGljIFBsbUZpbGUgZ2V0RmlsZShTdHJpbmcgaWQpCiAgewogICAgSXRlcmF0b3I8UGxtRmlsZT4gaXRlciA9IGdldEZpbGVzKCkuZ2V0UGxtT2JqZWN0cygpLml0ZXJhdG9yKCk7CiAgICB3aGlsZSAoaXRlci5oYXNOZXh0KCkpCiAgICB7CiAgICAgIFBsbUZpbGUgZmlsZSA9IGl0ZXIubmV4dCgpOwogICAgICBpZiAoaWQuZXF1YWxzKGZpbGUuZ2V0QXBwbGljYXRpb25JZCgpKSkKICAgICAgICByZXR1cm4gZmlsZTsKICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KCiAgLyoqCiAgICogR2V0IHRoZSBQbG1GaWxlIHdpdGggdGhlIHJlbGF0aXZlIG5hbWUgb2YgdGhlIGZpbGUuCiAgICovCiAgcHVibGljIFBsbUZpbGUgZ2V0RmlsZShGaWxlIGZpbGUpCiAgewogICAgcmV0dXJuIGdldEZpbGUoZmlsZSwgZmFsc2UpOwogIH0KCiAgLyoqCiAgICogR2V0IHRoZSBQbG1GaWxlIHdpdGggdGhlIHJlbGF0aXZlIG5hbWUgb2YgdGhlIGZpbGUuCiAgICovCiAgcHVibGljIFBsbUZpbGUgZ2V0RmlsZShGaWxlIGZpbGUsIGJvb2xlYW4gaWdub3JlQ2FzZSkKICB7CiAgICBpZiAoZmlsZSAhPSBudWxsKQogICAgewogICAgICBTdHJpbmcgcmVsX25hbWUgPSBmaWxlLmdldE5hbWUoKTsKCiAgICAgIEl0ZXJhdG9yPFBsbUZpbGU+IGl0ZXIgPSBnZXRGaWxlcygpLmdldFBsbU9iamVjdHMoKS5pdGVyYXRvcigpOwogICAgICB3aGlsZSAoaXRlci5oYXNOZXh0KCkpCiAgICAgIHsKICAgICAgICBQbG1GaWxlIHBmaWxlID0gaXRlci5uZXh0KCk7CiAgICAgICAgU3RyaW5nIHJlbF9wZmlsZSA9IHBmaWxlLmdldEZpbGVOYW1lKCk7CgogICAgICAgIGlmIChpZ25vcmVDYXNlKQogICAgICAgIHsKICAgICAgICAgIGlmIChyZWxfcGZpbGUuZXF1YWxzSWdub3JlQ2FzZShyZWxfbmFtZSkpCiAgICAgICAgICAgIHJldHVybiBwZmlsZTsKICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgIHsKICAgICAgICAgIGlmIChyZWxfcGZpbGUuZXF1YWxzKHJlbF9uYW1lKSkKICAgICAgICAgICAgcmV0dXJuIHBmaWxlOwogICAgICAgIH0KCiAgICAgIH0KICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KCiAgLyoqCiAgICogQ3JlYXRlcyBhIG5ldyBEb2NzdHJ1Y3R1cmUgZm9yIHRoaXMgZG9jdW1lbnQsIGlmIG5vIG9uZSBleGlzdHMhIEFuZCByZXR1cm5zCiAgICogaXQKICAgKi8KICBwdWJsaWMgUGxtRG9jU3RydWN0dXJlIGNyZWF0ZURvY1N0cnVjdHVyZSgpCiAgewogICAgaWYgKHBsbURvY1N0cnVjdHVyZSA9PSBudWxsKQogICAgICBwbG1Eb2NTdHJ1Y3R1cmUgPSBuZXcgUGxtRG9jU3RydWN0dXJlKHRoaXMpOwogICAgcmV0dXJuIHBsbURvY1N0cnVjdHVyZTsKICB9CgogIC8qKgogICAqIE1ldGhvZCBzZXREb2NTdHJ1Y3R1cmUgc2V0cyB0aGUgcGxtRG9jU3RydWN0dXJlIHRvIHRoZSBuZXcgb25lIGFuZCByZXR1cm5zCiAgICogdGhlIG9sZCBvbmUuCiAgICoKICAgKiBAcGFyYW0gbmV3X3N0cnVjdHVyZQogICAqICAgICAgICAgIGEgUGxtRG9jU3RydWN0dXJlCiAgICoKICAgKiBAcmV0dXJuIGEgUGxtRG9jU3RydWN0dXJlCiAgICoKICAgKi8KICBwdWJsaWMgUGxtRG9jU3RydWN0dXJlIHNldERvY1N0cnVjdHVyZShQbG1Eb2NTdHJ1Y3R1cmUgbmV3X3N0cnVjdHVyZSkKICB7CiAgICBQbG1Eb2NTdHJ1Y3R1cmUgb2xkX3N0cnVjdHVyZSA9IHBsbURvY1N0cnVjdHVyZTsKICAgIHBsbURvY1N0cnVjdHVyZSA9IG5ld19zdHJ1Y3R1cmU7CiAgICByZXR1cm4gb2xkX3N0cnVjdHVyZTsKICB9CgogIC8qKgogICAqIEByZXR1cm4gUGxtRG9jdW1lbnQgd2hlcmUgb25seSB0aGUgcHJpbWFyeSBrZXkgaXMgc2V0CiAgICovCiAgcHVibGljIFBsbURvY3VtZW50IGNyZWF0ZUVtcHR5Q2xvbmUoKQogIHsKICAgIFBsbURvY3VtZW50IHJldCA9IG5ldyBQbG1Eb2N1bWVudCh0eXBlLCBudW1iZXIsIHZlcnNpb24sIHBhcnQpOwoKICAgIHJldHVybiByZXQ7CiAgfQoKICAvKioKICAgKiBNZXRob2QgZ2V0RG9jU3RydWN0dXJlCiAgICoKICAgKiBAcmV0dXJuIHRoZSBQbG1Eb2NTdHJ1Y3R1cmUgb2YgdGhlIERvY3VtZW50CiAgICoKICAgKi8KICBwdWJsaWMgUGxtRG9jU3RydWN0dXJlIGdldERvY1N0cnVjdHVyZSgpCiAgewogICAgcmV0dXJuIHBsbURvY1N0cnVjdHVyZTsKICB9CgogIHB1YmxpYyBDb2xsZWN0aW9uPFBsbU9iamVjdExpbms+IGdldFBsbU9iamVjdExpbmtzKCkKICB7CiAgICBDb2xsZWN0aW9uPFBsbU9iamVjdExpbms+IGxpbmtzID0gbnVsbDsKICAgIGlmIChvYmplY3RMaW5rcyAhPSBudWxsKQogICAgICBsaW5rcyA9IG9iamVjdExpbmtzLmdldFBsbU9iamVjdHMoKTsKICAgIGVsc2UKICAgICAgbGlua3MgPSBDb2xsZWN0aW9ucy5lbXB0eUxpc3QoKTsKICAgIHJldHVybiBsaW5rczsKICB9CgogIHB1YmxpYyB2b2lkIGFkZFBsbU9iamVjdExpbmsoUGxtT2JqZWN0TGluayBsaW5rKQogIHsKICAgIGlmIChvYmplY3RMaW5rcyA9PSBudWxsKQogICAgICBvYmplY3RMaW5rcyA9IG5ldyBQbG1PYmplY3RMaW5rQ29udGFpbmVyKCk7CiAgICBvYmplY3RMaW5rcy5hZGRQbG1PYmplY3QobGluayk7CiAgfQoKICAvKioKICAgKiBhZGRpZXJ0IGVpbiBGaWxlIHp1IGRlbiB2UGxtRmlsZXMKICAgKgogICAqIEBwYXJhbSBmaWxlbmFtZQogICAqIEBwYXJhbSBhcHBsVHlwZQogICAqLwogIHB1YmxpYyBQbG1GaWxlIGFkZEZpbGUoU3RyaW5nIGZpbGVuYW1lLCBTdHJpbmcgYXBwbFR5cGUpCiAgewogICAgdHJ5CiAgICB7CiAgICAgIFBsbUZpbGUgZmlsZSA9IG5ldyBQbG1GaWxlKHRoaXMsIGZpbGVuYW1lLCBhcHBsVHlwZSk7Cg==</text>
      </register>
      <register name="1" type="2">
        <text encoding="base64">ICAgICAgICAgIHBsbUFjY2Vzcy4K</text>
      </register>
      <register name="q" type="4">
        <text />
      </register>
      <register name="2" type="2">
        <text encoding="base64">ICAgICAgICAgIG5ldyBQbG1GaWxlKCkK</text>
      </register>
      <register name="3" type="2">
        <text encoding="base64">ICAgICAgICAgIFN0cmluZyBqdCA9IFdTQXBwbFRvb2wuZ2V0Rmlyc3RXU0FwcGxGb3JFeHRlbnNpb24oImp0Iik7CiAgICAgICAgICBuZXcgUGxtRmlsZSgpCg==</text>
      </register>
      <register name="4" type="2">
        <text encoding="base64">ICAgICAgICAgIHBsbUZpbGUuc2V0YXAK</text>
      </register>
      <register name="5" type="2">
        <text encoding="base64">ICAgICAgICAgIGRvY3VtZW50TWFzdGVyLmFkZAo=</text>
      </register>
      <register name="6" type="2">
        <text encoding="base64">ICAgIGRvY3VtZW50TWFzdGVyLnNldAo=</text>
      </register>
      <register name="7" type="2">
        <text encoding="base64">ICAgICAgU3RyaW5nIGRvY1R5cGUgPSBkVHlwZUNvbXBvbmVudERlcGVuZGVudC5nZXREb2NUeXBlKCk7CiAgICAgIFN0cmluZyBkb2NQYXJ0ID0gZFR5cGVDb21wb25lbnREZXBlbmRlbnQuZ2V0RG9jUGFydCgpOwogICAgICBTdHJpbmcgYXBwbFR5cGUgPSBkVHlwZUNvbXBvbmVudERlcGVuZGVudC5nZXRBcHBsVHlwZSgpOwo=</text>
      </register>
      <register name="8" type="2">
        <text encoding="base64">ICAgICAgZGVwZW5kZW50RG9jLnNldEtleShkb2NUeXBlLCBwcm9kdWN0SUQgKyBjb3VudGVyVGVzdGluZywgcmV2aXNpb24sIGRvY1BhcnQpOwo=</text>
      </register>
      <register name="9" type="2">
        <text encoding="base64">ICAgICAgU3RyaW5nIGRvY1R5cGUgPSBkVHlwZUNvbXBvbmVudERlcGVuZGVudC5nZXREb2NUeXBlKCk7CiAgICAgIFN0cmluZyBkb2NQYXJ0ID0gZFR5cGVDb21wb25lbnREZXBlbmRlbnQuZ2V0RG9jUGFydCgpOwogICAgICBTdHJpbmcgYXBwbFR5cGUgPSBkVHlwZUNvbXBvbmVudERlcGVuZGVudC5nZXRBcHBsVHlwZSgpOwo=</text>
      </register>
      <register name=":" type="4">
        <text>169</text>
      </register>
    </registers>
    <search>
      <last-search>setNu</last-search>
      <last-offset />
      <last-pattern>setNu</last-pattern>
      <last-dir>1</last-dir>
      <show-last>false</show-last>
    </search>
    <history>
      <history-search>
        <entry encoding="base64">XDx0YWJiZWRQYW5lXD4=</entry>
        <entry encoding="base64">XDxPVVRfQ1JFQVRFRF9GT0xERVJcPg==</entry>
        <entry encoding="base64">XDxQYXJlbnRDbGFzc2lmaWNhdGlvbkVycm9yXD4=</entry>
        <entry encoding="base64">XDxmaWxlQ2hvb3Nlclw+</entry>
        <entry encoding="base64">XDxjaGFyR3JvdXBBbGxvY2F0aW9uc1w+</entry>
        <entry encoding="base64">XDxkdHlwZXNcPg==</entry>
        <entry encoding="base64">XDxyZW5rQ3VzdG9tTWF0ZXJpYWxcPg==</entry>
        <entry>bla</entry>
        <entry encoding="base64">XDxtYXRUeXBlXD4=</entry>
        <entry encoding="base64">XDx0ZW1wbGF0ZVw+</entry>
        <entry encoding="base64">XDxpbkNsYXNzXD4=</entry>
        <entry encoding="base64">XDxtZW1iZXJSZWZzXD4=</entry>
        <entry encoding="base64">XDxyZXZpc2lvblw+</entry>
        <entry>setmaterial</entry>
        <entry encoding="base64">XDxzZXRNYXRlcmlhbFw+</entry>
        <entry encoding="base64">XDxkb2N1bWVudE1hc3Rlclw+</entry>
        <entry encoding="base64">XDxPVVRfRk9MX0VSUk9SXD4=</entry>
        <entry encoding="base64">XDxmb2xkZXJQZXJtaXNzaW9uRXJyb3JcPg==</entry>
        <entry encoding="base64">XDxudW1iZXJcPg==</entry>
        <entry>setNu</entry>
      </history-search>
      <history-cmd>
        <entry>168</entry>
        <entry>253</entry>
        <entry>291</entry>
        <entry>102</entry>
        <entry>217</entry>
        <entry>10</entry>
        <entry>50</entry>
        <entry>369</entry>
        <entry>169</entry>
      </history-cmd>
      <history-expr />
      <history-input />
    </history>
    <shortcut-conflicts>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed C</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed V</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed Y</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed E</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed R</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed S</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed N</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed A</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed H</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed Q</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed W</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed F</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed X</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed D</text>
      </shortcut-conflict>
      <shortcut-conflict owner="ide">
        <text>ctrl pressed G</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed I</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed T</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed U</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed P</text>
      </shortcut-conflict>
      <shortcut-conflict owner="vim">
        <text>ctrl pressed B</text>
      </shortcut-conflict>
    </shortcut-conflicts>
  </component>
</application>